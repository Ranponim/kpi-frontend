import{N as e,r as t,O as B}from"./vendor-Cw6wx6N3.js";import{c as te,t as Qe,C as le,b as me,d as xe,B as re,a as R,e as ne,L as he,I as ue,p as ts,T as as,q as ls,r as pe,s as Ne,S as ve,f as we,g as ye,h as be,i as V,u as ns,v as rs,w as _e,x as ee,y as is,z as se}from"./common-components-BsYW0TmQ.js";import{F as cs,G as os,H as ds,J as hs,K as ms,M as xs,N as us,Q as gs,U as js}from"./ui-vendor-FYf9CHse.js";import{a as De,D as fs,b as ps,c as Ns,d as vs}from"./dashboard-page-CxSfgQ35.js";import{F as Ae,X as ae,C as ke,b as ws,I as ys,J as bs,c as Se,E as Cs,M as Ds,h as ks,L as Re,d as Ie,R as Ss,g as Rs,x as Fe,K as Is,N as Fs,e as As,z as Le,l as zs,O as Te}from"./icon-vendor-1p3lj7wq.js";import{R as Ee,B as Me,C as Pe,X as $e,Y as Oe,T as Ke,L as He,a as Ce}from"./chart-vendor-C0DB73VJ.js";function Ve({...d}){return e.jsx(cs,{"data-slot":"alert-dialog",...d})}function Be({...d}){return e.jsx(os,{"data-slot":"alert-dialog-trigger",...d})}function _s({...d}){return e.jsx(gs,{"data-slot":"alert-dialog-portal",...d})}function Ls({className:d,...h}){return e.jsx(js,{"data-slot":"alert-dialog-overlay",className:te("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",d),...h})}function Ge({className:d,...h}){return e.jsxs(_s,{children:[e.jsx(Ls,{}),e.jsx(ds,{"data-slot":"alert-dialog-content",className:te("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",d),...h})]})}function Ue({className:d,...h}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:te("flex flex-col gap-2 text-center sm:text-left",d),...h})}function We({className:d,...h}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:te("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",d),...h})}function qe({className:d,...h}){return e.jsx(hs,{"data-slot":"alert-dialog-title",className:te("text-lg font-semibold",d),...h})}function Xe({className:d,...h}){return e.jsx(ms,{"data-slot":"alert-dialog-description",className:te("text-muted-foreground text-sm",d),...h})}function Je({className:d,...h}){return e.jsx(us,{className:te(Qe(),d),...h})}function Ye({className:d,...h}){return e.jsx(xs,{className:te(Qe({variant:"outline"}),d),...h})}const Ts=({initialLimit:d=20,autoFetch:h=!0,initialFilters:I={}}={})=>{const[F,K]=t.useState([]),[_,T]=t.useState(!1),[$,H]=t.useState(null),[L,G]=t.useState(!0),[P,k]=t.useState({limit:d,skip:0,total:0}),[j,A]=t.useState({neId:"ALL",cellId:"ALL",startDate:null,endDate:null,status:"",...I}),l=t.useCallback((v,g={})=>{console.log(`[useAnalysisResults] ${v}`,g)},[]),S=t.useCallback((v,g)=>{console.error(`[useAnalysisResults] ${v}`,g)},[]),w=t.useCallback(async({limit:v=P.limit,skip:g=0,append:q=!1,showToast:J=!0}={})=>{var E,X,ce,s,a,r,o,i,u,x,C;try{T(!0),H(null),l("분석 결과 조회 시작",{limit:v,skip:g,filters:j});const f={limit:v,skip:g};(E=j.neId)!=null&&E.trim()&&(f.ne_id=j.neId.trim()),(X=j.cellId)!=null&&X.trim()&&(f.cell_id=j.cellId.trim()),j.startDate&&(f.date_from=j.startDate),j.endDate&&(f.date_to=j.endDate),(ce=j.status)!=null&&ce.trim()&&(f.status=j.status.trim());const p=await De.get("/api/analysis/results",{params:f});l("분석 결과 조회 성공",{resultCount:((a=(s=p.data)==null?void 0:s.items)==null?void 0:a.length)||0,total:((r=p.data)==null?void 0:r.total)||0,totalRequested:v});const M=(((o=p.data)==null?void 0:o.items)||[]).filter(b=>((b==null?void 0:b.analysis_type)||(b==null?void 0:b.analysisType))==="llm_analysis");return K(q?b=>[...b,...M]:M),k(b=>{var Z;return{...b,skip:q?b.skip+M.length:g+M.length,total:((Z=p.data)==null?void 0:Z.total)||0}}),G(((i=p.data)==null?void 0:i.has_next)||!1),J&&!q&&B.success(`${M.length}개의 분석 결과를 불러왔습니다.`),M}catch(f){const p=((C=(x=(u=f==null?void 0:f.response)==null?void 0:u.data)==null?void 0:x.error)==null?void 0:C.message)||(f==null?void 0:f.message)||"분석 결과를 불러오는 중 오류가 발생했습니다.";return S("분석 결과 조회 실패",f),H(p),J&&B.error(`데이터 조회 실패: ${p}`),[]}finally{T(!1)}},[P.limit,j,l,S]),U=t.useCallback(v=>{l("필터 업데이트",{이전:j,새로운:v}),A(g=>({...g,...v})),k(g=>({...g,skip:0}))},[j,l]),W=t.useCallback(()=>{l("필터 초기화"),A({neId:"",cellId:"",startDate:null,endDate:null,status:""}),k(v=>({...v,skip:0}))},[l]),O=t.useCallback(async()=>{if(_||!L){l("추가 로딩 건너뜀",{loading:_,hasMore:L});return}l("추가 결과 로딩 시작"),await w({skip:P.skip,append:!0,showToast:!1})},[_,L,w,P.skip,l]),n=t.useCallback(async()=>{l("데이터 새로고침 시작"),k(v=>({...v,skip:0})),await w({skip:0,append:!1})},[w,l]),m=t.useCallback(async v=>{var g,q,J;try{l("분석 결과 삭제 시작",{resultId:v}),await De.delete(`/api/analysis/results/${v}`),K(E=>E.filter(X=>X.id!==v)),l("분석 결과 삭제 성공",{resultId:v}),B.success("분석 결과가 삭제되었습니다.")}catch(E){const X=((J=(q=(g=E==null?void 0:E.response)==null?void 0:g.data)==null?void 0:q.error)==null?void 0:J.message)||(E==null?void 0:E.message)||"분석 결과 삭제 중 오류가 발생했습니다.";S("분석 결과 삭제 실패",E),B.error(`삭제 실패: ${X}`)}},[l,S]);t.useEffect(()=>{h&&(l("컴포넌트 마운트 - 자동 데이터 조회 시작"),w({skip:0,append:!1,showToast:!1}))},[h]),t.useEffect(()=>{h&&(l("필터 변경 감지 - 데이터 재조회"),w({skip:0,append:!1,showToast:!1}))},[h,j,w,l]);const z=t.useMemo(()=>!_&&F.length===0,[_,F.length]),N=t.useMemo(()=>Object.values(j).some(v=>v!=null&&v!==""),[j]),Q=t.useMemo(()=>F.length,[F.length]),ie=t.useMemo(()=>({resultCount:Q,loading:_,hasMore:L,isEmpty:z,isFiltered:N,pagination:P,filters:j,error:$}),[Q,_,L,z,N,P,j,$]);return t.useEffect(()=>{},[ie]),{results:F,loading:_,error:$,isEmpty:z,hasMore:L,isFiltered:N,resultCount:Q,pagination:P,filters:j,updateFilters:U,clearFilters:W,fetchResults:w,refresh:n,loadMore:O,deleteResult:m,debugInfo:ie}},Es=({filters:d={},onFilterChange:h,onClearFilters:I,isCollapsed:F=!1,onToggleCollapse:K,showActiveCount:_=!0})=>{const T=t.useCallback((n,m={})=>{console.log(`[ResultFilter] ${n}`,m)},[]),{neId:$="",cellId:H="",startDate:L=null,endDate:G=null,status:P=""}=d,k={...$&&{"NE ID":$},...H&&{"Cell ID":H},...L&&{시작일:new Date(L).toLocaleDateString("ko-KR")},...G&&{종료일:new Date(G).toLocaleDateString("ko-KR")},...P&&{상태:P}},j=Object.keys(k).length,A=j>0,l=t.useCallback((n,m)=>{T("필터 변경",{key:n,value:m}),h&&h(n,m)},[h,T]),S=t.useCallback(n=>{T("개별 필터 초기화",{key:n}),l(n,n==="startDate"||n==="endDate"?null:"")},[l,T]),w=t.useCallback(()=>{T("전체 필터 초기화"),I&&I()},[I,T]),U=t.useCallback(n=>{if(!n)return"";try{return new Date(n).toISOString().split("T")[0]}catch{return""}},[]),W=t.useCallback(n=>{if(!n)return null;try{return new Date(n).toISOString()}catch{return null}},[]),O=t.useCallback(()=>{T("필터 패널 토글",{isCollapsed:!F}),K&&K()},[F,K,T]);return e.jsxs(le,{className:"w-full",children:[e.jsxs(me,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5"}),"필터"]}),_&&A&&e.jsxs(re,{variant:"secondary",className:"text-xs",children:[j,"개 활성"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[A&&e.jsxs(R,{variant:"ghost",size:"sm",onClick:w,className:"text-destructive hover:text-destructive",children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"전체 초기화"]}),e.jsx(R,{variant:"ghost",size:"sm",onClick:O,children:F?e.jsx(ke,{className:"h-4 w-4"}):e.jsx(ws,{className:"h-4 w-4"})})]})]}),A&&!F&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:Object.entries(k).map(([n,m])=>e.jsxs(re,{variant:"outline",className:"flex items-center gap-1 pr-1",children:[e.jsxs("span",{className:"text-xs",children:[n,": ",m]}),e.jsx(R,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-destructive hover:text-destructive-foreground",onClick:()=>{const N={"NE ID":"neId","Cell ID":"cellId",시작일:"startDate",종료일:"endDate",상태:"status"}[n];N&&S(N)},children:e.jsx(ae,{className:"h-3 w-3"})})]},n))})]}),!F&&e.jsxs(ne,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{htmlFor:"filter-ne",className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-4 w-4"}),"NE ID"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{id:"filter-ne",placeholder:"NE ID 검색...",value:$,onChange:n=>l("neId",n.target.value),className:"pr-8"}),$&&e.jsx(R,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0",onClick:()=>S("neId"),children:e.jsx(ae,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{htmlFor:"filter-cell",className:"flex items-center gap-2",children:[e.jsx(bs,{className:"h-4 w-4"}),"Cell ID"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{id:"filter-cell",placeholder:"Cell ID 검색...",value:H,onChange:n=>l("cellId",n.target.value),className:"pr-8"}),H&&e.jsx(R,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0",onClick:()=>S("cellId"),children:e.jsx(ae,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{htmlFor:"filter-start",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"시작 날짜"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{id:"filter-start",type:"date",value:U(L),onChange:n=>l("startDate",W(n.target.value)),className:"pr-8"}),L&&e.jsx(R,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0",onClick:()=>S("startDate"),children:e.jsx(ae,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{htmlFor:"filter-end",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"종료 날짜"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{id:"filter-end",type:"date",value:U(G),onChange:n=>l("endDate",W(n.target.value)),className:"pr-8"}),G&&e.jsx(R,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0",onClick:()=>S("endDate"),children:e.jsx(ae,{className:"h-3 w-3"})})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx(he,{className:"text-sm font-medium mb-3 block",children:"빠른 날짜 선택"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{label:"오늘",days:0},{label:"어제",days:1},{label:"최근 7일",days:7},{label:"최근 30일",days:30},{label:"최근 90일",days:90}].map(({label:n,days:m})=>e.jsx(R,{variant:"outline",size:"sm",onClick:()=>{const z=new Date,N=new Date;m===0?(N.setHours(0,0,0,0),z.setHours(23,59,59,999)):m===1?(N.setDate(N.getDate()-1),N.setHours(0,0,0,0),z.setDate(z.getDate()-1),z.setHours(23,59,59,999)):(N.setDate(N.getDate()-m),N.setHours(0,0,0,0),z.setHours(23,59,59,999)),l("startDate",N.toISOString()),l("endDate",z.toISOString()),T("빠른 날짜 선택",{label:n,startDate:N,endDate:z})},children:n},n))})]})]})]})},Ze=({isOpen:d,onClose:h,resultIds:I=[],mode:F="single"})=>{const[K,_]=t.useState([]),[T,$]=t.useState(!1),[H,L]=t.useState(null),[G,P]=t.useState("overview"),[k,j]=t.useState(!1);t.useEffect(()=>{const a=r=>{r.key==="F11"?(r.preventDefault(),j(o=>!o)):r.key==="Escape"&&k&&j(!1)};if(d)return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[d,k]);const[A,l]=t.useState(0),[S,w]=t.useState(10),[U,W]=t.useState(""),[O,n]=t.useState("all"),[m,z]=t.useState("all"),N=F==="compare"&&I.length>1;F==="single"&&I.length;const Q=async a=>{$(!0),L(null);try{console.log("📊 분석 결과 상세 정보 요청:",a);const r=a.map(async i=>{try{return{...(await De.get(`/api/analysis/results/${i}`)).data,id:i}}catch(u){return console.error(`❌ 결과 ${i} 로딩 실패:`,u),{id:i,error:u.message||"로딩 실패",analysisDate:new Date().toISOString(),neId:"-",cellId:"-",status:"error"}}}),o=await Promise.all(r);_(o),console.log("✅ 분석 결과 상세 정보 로딩 완료:",o)}catch(r){console.error("❌ 분석 결과 상세 정보 로딩 실패:",r),L(r.message||"데이터 로딩에 실패했습니다"),B.error("분석 결과를 불러오는데 실패했습니다")}finally{$(!1)}};t.useEffect(()=>{d&&I.length>0&&Q(I)},[d,I]);const ie=a=>{switch(a==null?void 0:a.toLowerCase()){case"success":return"default";case"error":case"failed":return"destructive";case"warning":return"secondary";case"pending":case"processing":return"outline";default:return"secondary"}},v=a=>{try{return new Date(a).toLocaleString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",weekday:"short"})}catch{return a||"-"}},g=t.useMemo(()=>K.filter(a=>!a.error),[K]),q=t.useMemo(()=>{var r,o;return N?(((o=(r=g[0])==null?void 0:r.kpiResults)==null?void 0:o.map(i=>i.name))||[]).map(i=>{const u={name:i};return g.forEach((x,C)=>{var p;const f=(p=x.kpiResults)==null?void 0:p.find(y=>y.name===i);u[`결과${C+1}`]=parseFloat((f==null?void 0:f.value)||0)}),u}):null},[g,N]),J=t.useMemo(()=>{var ze;if(N||!g.length||!g[0].stats)return{kpiResults:[],sortedKpiResults:[],filteredResults:[],dataWithTrends:[],trendFilteredResults:[],totalPages:0,paginatedResults:[],data:[],summaryStats:{improved:0,declined:0,stable:0,avgChange:0,weightedAvgChange:0}};const a=g[0],r=a.stats||[],o={};r.forEach(c=>{const D=c.kpi_name;o[D]||(o[D]={peg_name:D,weight:5}),c.period==="N-1"?o[D]["N-1"]=c.avg:c.period==="N"&&(o[D].N=c.avg)});const i=((ze=a.request_params)==null?void 0:ze.peg_definitions)||{};Object.keys(o).forEach(c=>{var D;(D=i[c])!=null&&D.weight&&(o[c].weight=i[c].weight)});const u=Object.values(o).filter(c=>c["N-1"]!==void 0&&c.N!==void 0),x=[...u].sort((c,D)=>(D.weight||0)-(c.weight||0)),C=x.filter(c=>{const D=!U||c.peg_name.toLowerCase().includes(U.toLowerCase()),de=c.weight||0;let Y=!0;return O==="high"?Y=de>=8:O==="medium"?Y=de>=6&&de<8:O==="low"&&(Y=de<6),D&&Y}),f=C.map(c=>{const D=c["N-1"]||0,Y=(c.N||0)-D,es=D!==0?Y/D*100:0,ss=Y>0?"up":Y<0?"down":"stable";return{...c,change:Y,changePercent:es,trend:ss}}),p=f.filter(c=>m==="all"?!0:c.trend===m),y=Math.ceil(p.length/S),M=p.slice(A*S,(A+1)*S),b=M.map(c=>({name:c.peg_name,"N-1":c["N-1"]||0,N:c.N||0,change:c.change,changePercent:c.changePercent,trend:c.trend,weight:c.weight,unit:"%",peg:c.weight||0})),Z=b.filter(c=>c.trend==="up").length,ge=b.filter(c=>c.trend==="down").length,je=b.filter(c=>c.trend==="stable").length,fe=b.length>0?b.reduce((c,D)=>c+D.change,0)/b.length:0,oe=b.length>0?b.reduce((c,D)=>c+D.change*D.weight,0)/b.reduce((c,D)=>c+D.weight,0):0;return{kpiResults:u,sortedKpiResults:x,filteredResults:C,dataWithTrends:f,trendFilteredResults:p,totalPages:y,paginatedResults:M,data:b,summaryStats:{improved:Z,declined:ge,stable:je,avgChange:fe,weightedAvgChange:oe}}},[N,g,U,O,m,A,S]),E=()=>{const{kpiResults:a,trendFilteredResults:r,totalPages:o,data:i,summaryStats:u}=J;return N?e.jsx(Ee,{width:"100%",height:400,children:e.jsxs(Me,{data:q,children:[e.jsx(Pe,{strokeDasharray:"3 3"}),e.jsx($e,{dataKey:"name"}),e.jsx(Oe,{}),e.jsx(Ke,{}),e.jsx(He,{}),g.map((x,C)=>e.jsx(Ce,{dataKey:`결과${C+1}`,fill:`hsl(${C*60}, 70%, 50%)`},`result${C+1}`))]})}):a.length?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:u.improved}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"개선 📈"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:u.declined}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"하락 📉"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-600",children:u.stable}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"안정 ➡️"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-lg font-bold ${u.avgChange>=0?"text-green-600":"text-red-600"}`,children:[u.avgChange>0?"+":"",u.avgChange.toFixed(2),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"평균 변화"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-lg font-bold ${u.weightedAvgChange>=0?"text-green-600":"text-red-600"}`,children:[u.weightedAvgChange>0?"+":"",u.weightedAvgChange.toFixed(2),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"가중 평균 변화"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"📊 PEG별 N-1/N 성능 비교 (가중치 높은 순)"}),e.jsxs(re,{variant:"outline",children:["전체 ",a.length,"개 중 ",r.length,"개 표시"]})]}),e.jsxs("div",{className:`grid gap-3 transition-all duration-300 ${k?"grid-cols-1 md:grid-cols-6 lg:grid-cols-8":"grid-cols-1 md:grid-cols-5"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ue,{placeholder:"PEG 이름 검색...",value:U,onChange:x=>{W(x.target.value),l(0)},className:"pl-8"})]}),e.jsxs(ve,{value:O,onValueChange:x=>{n(x),l(0)},children:[e.jsxs(we,{children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),e.jsx(ye,{placeholder:"가중치 필터"})]}),e.jsxs(be,{children:[e.jsx(V,{value:"all",children:"전체"}),e.jsx(V,{value:"high",children:"높음 (≥8)"}),e.jsx(V,{value:"medium",children:"중간 (6-7.9)"}),e.jsx(V,{value:"low",children:"낮음 (<6)"})]})]}),e.jsxs(ve,{value:m,onValueChange:x=>{z(x),l(0)},children:[e.jsx(we,{children:e.jsx(ye,{placeholder:"트렌드 필터"})}),e.jsxs(be,{children:[e.jsx(V,{value:"all",children:"전체 트렌드"}),e.jsx(V,{value:"up",children:"개선 📈"}),e.jsx(V,{value:"down",children:"하락 📉"}),e.jsx(V,{value:"stable",children:"안정 ➡️"})]})]}),e.jsxs(ve,{value:S.toString(),onValueChange:x=>{w(parseInt(x)),l(0)},children:[e.jsx(we,{children:e.jsx(ye,{placeholder:"표시 개수"})}),e.jsxs(be,{children:[e.jsx(V,{value:"5",children:"5개씩"}),e.jsx(V,{value:"10",children:"10개씩"}),e.jsx(V,{value:"20",children:"20개씩"}),e.jsx(V,{value:"50",children:"50개씩"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(R,{variant:"outline",size:"sm",onClick:()=>l(Math.max(0,A-1)),disabled:A===0,children:e.jsx(Is,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:[A+1," / ",o||1]}),e.jsx(R,{variant:"outline",size:"sm",onClick:()=>l(Math.min(o-1,A+1)),disabled:A>=o-1,children:e.jsx(Fs,{className:"h-4 w-4"})})]})]})]}),e.jsx(Ee,{width:"100%",height:k?Math.min(window.innerHeight*.55,900):Math.min(window.innerHeight*.4,500),className:"transition-all duration-300",children:e.jsxs(Me,{data:i,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Pe,{strokeDasharray:"3 3"}),e.jsx($e,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0,fontSize:10}),e.jsx(Oe,{}),e.jsx(Ke,{formatter:(x,C,f)=>[`${x==null?void 0:x.toFixed(2)} ${f.payload.unit}`,C],labelFormatter:x=>{const C=i.find(f=>f.name===x);return`${x} (가중치: ${(C==null?void 0:C.weight)||0})`},content:({active:x,payload:C,label:f})=>{var b,Z,ge,je,fe;if(!x||!(C!=null&&C.length))return null;const p=(b=C[0])==null?void 0:b.payload;if(!p)return null;const y=oe=>{switch(oe){case"up":return"📈";case"down":return"📉";default:return"➡️"}},M=oe=>{switch(oe){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-600"}};return e.jsxs("div",{className:"bg-white border rounded-lg shadow-lg p-3 min-w-[200px]",children:[e.jsx("div",{className:"font-semibold mb-2",children:f}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-orange-600",children:"N-1 기간:"}),e.jsxs("span",{className:"font-medium",children:[(Z=p["N-1"])==null?void 0:Z.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-600",children:"N 기간:"}),e.jsxs("span",{className:"font-medium",children:[(ge=p.N)==null?void 0:ge.toFixed(2),"%"]})]}),e.jsxs("div",{className:"border-t pt-1 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"성능 변화:"}),e.jsxs("div",{className:`flex items-center gap-1 font-medium ${M(p.trend)}`,children:[e.jsx("span",{children:y(p.trend)}),e.jsxs("span",{children:[p.change>0?"+":"",(je=p.change)==null?void 0:je.toFixed(2),"%"]}),e.jsxs("span",{className:"text-xs",children:["(",p.changePercent>0?"+":"",(fe=p.changePercent)==null?void 0:fe.toFixed(1),"%)"]})]})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-gray-600",children:"가중치:"}),e.jsxs("span",{className:"font-medium",children:[p.weight,"/10"]})]})]})]})]})}}),e.jsx(He,{}),e.jsx(Ce,{dataKey:"N-1",fill:"#ff7300",name:"N-1 기간"}),e.jsx(Ce,{dataKey:"N",fill:"#8884d8",name:"N 기간"})]})})]}):e.jsx("div",{className:"text-center text-muted-foreground",children:"PEG 비교 데이터가 없습니다."})},X=a=>{var p;const r=(a==null?void 0:a[0])||{},o=((p=r==null?void 0:r.data)==null?void 0:p.data)||(r==null?void 0:r.data)||r,i=(o==null?void 0:o.analysis)||{},u=i.executive_summary||i.overall_summary||i.comprehensive_summary||"요약 정보가 없습니다.",x=Array.isArray(i.diagnostic_findings)&&i.diagnostic_findings.length?i.diagnostic_findings:Array.isArray(i.key_findings)?i.key_findings.map(y=>({primary_hypothesis:String(y)})):[],f=(Array.isArray(i.recommended_actions)?i.recommended_actions:[]).map(y=>y&&typeof y=="object"?y:{priority:"",action:String(y||""),details:""});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(le,{children:[e.jsx(me,{children:e.jsx(xe,{children:"종합 분석 요약"})}),e.jsx(ne,{children:e.jsx("div",{className:"text-sm text-muted-foreground whitespace-pre-line",children:u})})]}),x.length>0&&e.jsxs(le,{children:[e.jsx(me,{children:e.jsx(xe,{children:"핵심 관찰 사항"})}),e.jsx(ne,{children:e.jsx("div",{className:"space-y-3",children:x.map((y,M)=>e.jsxs("div",{className:"space-y-1",children:[y.primary_hypothesis&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-semibold",children:["가설 ",M+1,":"]})," ",y.primary_hypothesis]}),y.supporting_evidence&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["증거: ",y.supporting_evidence]}),y.confounding_factors_assessment&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["교란 변수 평가: ",y.confounding_factors_assessment]})]},M))})})]}),f.length>0&&e.jsxs(le,{children:[e.jsx(me,{children:e.jsx(xe,{children:"권장 조치"})}),e.jsx(ne,{children:e.jsx("div",{className:"space-y-3",children:f.map((y,M)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:e.jsx(As,{className:"h-5 w-5 text-green-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[y.priority&&e.jsx(re,{variant:"outline",children:y.priority}),e.jsx("div",{className:"text-sm font-medium",children:y.action||"-"})]}),y.details&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1 whitespace-pre-line",children:y.details})]})]},M))})})]})]})},ce=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[g.length,"개 결과 비교"]}),e.jsx("div",{className:"flex gap-2",children:g.map((a,r)=>e.jsxs(re,{variant:"outline",className:"gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${r*60}, 70%, 50%)`}}),"결과 ",r+1]},a.id))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.map((a,r)=>e.jsx(le,{className:"border-l-4",style:{borderLeftColor:`hsl(${r*60}, 70%, 50%)`},children:e.jsx(ne,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:["결과 ",r+1]}),e.jsx(re,{variant:ie(a.status),children:a.status})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:v(a.analysisDate)}),e.jsxs("div",{className:"text-sm",children:["NE: ",a.neId," | Cell: ",a.cellId]})]})})},a.id))})]}),s=()=>T?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 불러오는 중..."})]})}):H?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ie,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"데이터 로딩 오류"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:H}),e.jsxs(R,{onClick:()=>Q(I),variant:"outline",children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"다시 시도"]})]})}):g.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ie,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 찾을 수 없습니다."})]})}):e.jsxs(as,{value:G,onValueChange:P,className:"w-full",children:[e.jsxs(ls,{className:"grid w-full grid-cols-3",children:[e.jsx(pe,{value:"overview",children:"개요"}),e.jsx(pe,{value:"kpi",children:"PEG 비교 결과"}),e.jsx(pe,{value:"recommendations",children:"LLM 분석 리포트"})]}),e.jsx(Ne,{value:"overview",className:"space-y-4 mt-6",children:N?ce():renderSingleOverview(g[0])}),e.jsx(Ne,{value:"kpi",className:"space-y-4 mt-6",children:e.jsxs(le,{children:[e.jsx(me,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-5 w-5"}),N?"PEG 성능 비교 차트":"PEG 비교 결과 (N-1 vs N)"]})}),e.jsx(ne,{children:E()})]})}),e.jsx(Ne,{value:"recommendations",className:"space-y-4 mt-6",children:X(g)})]});return e.jsx(fs,{open:d,onOpenChange:h,children:e.jsxs(ps,{className:`transition-all duration-500 ease-in-out transform ${k?"max-w-[99vw] h-[98vh] w-[99vw] scale-100":"max-w-6xl max-h-[85vh] w-[90vw] scale-100"}`,children:[e.jsx(Ns,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(vs,{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"h-5 w-5"}),N?"분석 결과 비교":"분석 결과 상세"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>j(!k),className:"transition-all duration-200 hover:scale-110 hover:bg-accent",title:k?"원래 크기로 (ESC)":"최대화 (F11)",children:k?e.jsx(Ds,{className:"h-4 w-4"}):e.jsx(ks,{className:"h-4 w-4"})})})]})}),e.jsx(ts,{className:`transition-all duration-300 ${k?"h-[85vh]":"max-h-[70vh]"}`,children:e.jsx("div",{className:"px-1",children:s()})})]})})},Gs=Object.freeze(Object.defineProperty({__proto__:null,default:Ze},Symbol.toStringTag,{value:"Module"})),Ms=()=>{const{results:d,loading:h,error:I,isEmpty:F,hasMore:K,isFiltered:_,resultCount:T,filters:$,updateFilters:H,clearFilters:L,refresh:G,loadMore:P,deleteResult:k}=Ts({initialLimit:20,autoFetch:!0}),[j,A]=t.useState(!1),[l,S]=t.useState(new Set),[w,U]=t.useState({key:"analysisDate",direction:"desc"}),[W,O]=t.useState({isOpen:!1,resultIds:[],mode:"single"}),n=t.useCallback((s,a={})=>{console.log(`[ResultsList] ${s}`,a)},[]),m=t.useMemo(()=>d!=null&&d.length?[...d].sort((a,r)=>{const o=a[w.key],i=r[w.key];if(o==null)return 1;if(i==null)return-1;if(w.key==="analysisDate"){const u=new Date(o),x=new Date(i);return w.direction==="asc"?u-x:x-u}if(typeof o=="string"&&typeof i=="string"){const u=o.localeCompare(i);return w.direction==="asc"?u:-u}return typeof o=="number"&&typeof i=="number"?w.direction==="asc"?o-i:i-o:0}):[],[d,w]),z=t.useCallback(s=>{U(a=>{const r=a.key===s&&a.direction==="asc"?"desc":"asc";return n("정렬 변경",{key:s,direction:r}),{key:s,direction:r}})},[n]),N=t.useCallback(s=>{S(a=>{const r=new Set(a);return r.has(s)?r.delete(s):r.add(s),r})},[]),Q=t.useCallback(()=>{l.size===m.length?S(new Set):S(new Set(m.map(s=>s.id)))},[l.size,m]),ie=t.useCallback(async s=>{try{n("분석 결과 삭제 시작",{resultId:s}),await k(s),S(a=>{const r=new Set(a);return r.delete(s),r})}catch(a){n("분석 결과 삭제 실패",{resultId:s,error:a})}},[k,n]),v=t.useCallback(async()=>{if(l.size!==0)try{n("벌크 삭제 시작",{count:l.size});const s=Array.from(l).map(a=>k(a));await Promise.all(s),S(new Set),B.success(`${l.size}개의 결과가 삭제되었습니다.`)}catch(s){n("벌크 삭제 실패",{error:s}),B.error("일부 결과 삭제에 실패했습니다.")}},[l,k,n]),g=t.useCallback(s=>{n("상세 보기 요청",{resultId:s}),O({isOpen:!0,resultIds:[s],mode:"single"})},[n]),q=t.useCallback(()=>{if(l.size<2){B.error("비교할 결과를 2개 이상 선택해주세요");return}if(l.size>5){B.error("최대 5개까지만 비교할 수 있습니다");return}const s=Array.from(l);n("비교 보기 요청",{resultIds:s,count:s.length}),O({isOpen:!0,resultIds:s,mode:"compare"})},[l,n]),J=t.useCallback(()=>{O({isOpen:!1,resultIds:[],mode:"single"})},[]),E=t.useCallback(()=>{if(!(m!=null&&m.length)){B.error("내보낼 데이터가 없습니다.");return}try{n("데이터 내보내기 시작",{count:m.length});const s=m.map(i=>{var u,x;return{"분석 날짜":new Date(i.analysisDate).toLocaleString("ko-KR"),"NE ID":i.neId,"Cell ID":i.cellId,상태:i.status,"결과 수":((u=i.results)==null?void 0:u.length)||0,"통계 수":((x=i.stats)==null?void 0:x.length)||0}}),a=[Object.keys(s[0]).join(","),...s.map(i=>Object.values(i).join(","))].join(`
`),r=new Blob([a],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(r),o.download=`analysis_results_${new Date().toISOString().split("T")[0]}.csv`,o.click(),B.success("데이터가 내보내기 되었습니다."),n("데이터 내보내기 완료")}catch(s){n("데이터 내보내기 실패",{error:s}),B.error("데이터 내보내기에 실패했습니다.")}},[m,n]),X=t.useCallback(s=>{switch(s==null?void 0:s.toLowerCase()){case"success":return"default";case"error":case"failed":return"destructive";case"warning":return"secondary";case"pending":case"processing":return"outline";default:return"secondary"}},[]),ce=t.useCallback(s=>{try{return new Date(s).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s||"-"}},[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"LLM 분석 결과"}),e.jsxs("p",{className:"text-muted-foreground",children:["총 ",T,"개의 분석 결과",_&&" (필터 적용됨)"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[l.size>0&&e.jsxs(e.Fragment,{children:[l.size>=2&&e.jsxs(R,{variant:"default",size:"sm",onClick:q,children:[e.jsx(BarChart3,{className:"h-4 w-4 mr-2"}),"비교하기 (",l.size,")"]}),e.jsxs(Ve,{children:[e.jsx(Be,{asChild:!0,children:e.jsxs(R,{variant:"destructive",size:"sm",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"선택 삭제 (",l.size,")"]})}),e.jsxs(Ge,{children:[e.jsxs(Ue,{children:[e.jsx(qe,{children:"선택된 결과 삭제"}),e.jsxs(Xe,{children:["선택된 ",l.size,"개의 분석 결과를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(We,{children:[e.jsx(Ye,{children:"취소"}),e.jsx(Je,{onClick:v,children:"삭제"})]})]})]})]}),e.jsxs(R,{variant:"outline",size:"sm",onClick:E,disabled:!(m!=null&&m.length),children:[e.jsx(zs,{className:"h-4 w-4 mr-2"}),"내보내기"]}),e.jsxs(R,{variant:"outline",size:"sm",onClick:()=>A(!j),children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"필터",e.jsx(ke,{className:`h-4 w-4 ml-2 transition-transform ${j?"rotate-180":""}`})]}),e.jsxs(R,{variant:"outline",size:"sm",onClick:G,disabled:h,children:[e.jsx(Te,{className:`h-4 w-4 mr-2 ${h?"animate-spin":""}`}),"새로고침"]})]})]}),j&&e.jsx(Es,{filters:$,onFilterChange:(s,a)=>H({[s]:a}),onClearFilters:L,isCollapsed:!1,onToggleCollapse:()=>A(!1),showActiveCount:!0}),e.jsx(le,{children:e.jsxs(ne,{className:"p-0",children:[I&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(Ie,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"데이터 로딩 오류"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:I}),e.jsxs(R,{onClick:G,variant:"outline",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"다시 시도"]})]}),h&&F&&e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"분석 결과를 불러오는 중..."})]}),!h&&F&&!I&&e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(Fe,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:_?"검색 결과가 없습니다":"분석 결과가 없습니다"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:_?"다른 조건으로 검색해보세요.":"아직 생성된 분석 결과가 없습니다."}),_&&e.jsxs(R,{onClick:L,variant:"outline",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"필터 초기화"]})]}),!F&&!I&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ns,{children:[e.jsx(rs,{children:e.jsxs(_e,{children:[e.jsx(ee,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:l.size===m.length&&m.length>0,onChange:Q,className:"rounded border-gray-300"})}),e.jsxs(ee,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>z("analysisDate"),children:["분석 날짜",w.key==="analysisDate"&&e.jsx("span",{className:"ml-2",children:w.direction==="asc"?"↑":"↓"})]}),e.jsxs(ee,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>z("neId"),children:["NE ID",w.key==="neId"&&e.jsx("span",{className:"ml-2",children:w.direction==="asc"?"↑":"↓"})]}),e.jsxs(ee,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>z("cellId"),children:["Cell ID",w.key==="cellId"&&e.jsx("span",{className:"ml-2",children:w.direction==="asc"?"↑":"↓"})]}),e.jsx(ee,{children:"상태"}),e.jsx(ee,{className:"text-center",children:"결과 수"}),e.jsx(ee,{className:"text-center",children:"통계 수"}),e.jsx(ee,{className:"w-20",children:"작업"})]})}),e.jsx(is,{children:m.map(s=>{var a,r;return e.jsxs(_e,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>g(s.id),children:[e.jsx(se,{onClick:o=>o.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:l.has(s.id),onChange:()=>N(s.id),className:"rounded border-gray-300"})}),e.jsx(se,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4 text-muted-foreground"}),ce(s.analysisDate)]})}),e.jsx(se,{className:"font-medium",children:s.neId||"-"}),e.jsx(se,{className:"font-medium",children:s.cellId||"-"}),e.jsx(se,{children:e.jsx(re,{variant:X(s.status),children:s.status||"unknown"})}),e.jsx(se,{className:"text-center",children:((a=s.results)==null?void 0:a.length)||0}),e.jsx(se,{className:"text-center",children:((r=s.stats)==null?void 0:r.length)||0}),e.jsx(se,{onClick:o=>o.stopPropagation(),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>g(s.id),title:"상세 보기",children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsxs(Ve,{children:[e.jsx(Be,{asChild:!0,children:e.jsx(R,{variant:"ghost",size:"sm",title:"삭제",children:e.jsx(Le,{className:"h-4 w-4 text-destructive"})})}),e.jsxs(Ge,{children:[e.jsxs(Ue,{children:[e.jsx(qe,{children:"분석 결과 삭제"}),e.jsx(Xe,{children:"이 분석 결과를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."})]}),e.jsxs(We,{children:[e.jsx(Ye,{children:"취소"}),e.jsx(Je,{onClick:()=>ie(s.id),children:"삭제"})]})]})]})]})})]},s.id)})})]})}),K&&!h&&!I&&e.jsx("div",{className:"p-6 text-center border-t",children:e.jsxs(R,{variant:"outline",onClick:P,disabled:h,children:[h?e.jsx(Re,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(ke,{className:"h-4 w-4 mr-2"}),"더 보기"]})})]})}),e.jsx(Ze,{isOpen:W.isOpen,onClose:J,resultIds:W.resultIds,mode:W.mode})]})},Us=Object.freeze(Object.defineProperty({__proto__:null,default:Ms},Symbol.toStringTag,{value:"Module"}));export{Gs as R,Us as a};
