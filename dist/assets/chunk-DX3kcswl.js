import{t as St,j as t,r as g,a as $t,b as Y,R as Ae,L as Nt,c as Ge,B as kt,d as qe,A as Et,e as Ke,C as _t,X as Dt,Y as Tt,T as Ct,f as Pt}from"./chunk-CTtn32jH.js";import{c as Ot,a as st}from"./chunk-BziMVLSE.js";import{S as rt,R as At,C as Lt,a as It,T as Rt,D as Mt,P as Ut,O as zt,b as Ft,c as Bt,I as Vt,V as Wt,d as Ht,e as Gt,f as qt,g as Kt,h as Jt,i as Zt,j as Yt,k as Xt,l as Qt,m as es,n as ts}from"./chunk-BBx_fWpL.js";import{X as Ue,C as ss,R as ze,a as at,b as ke,c as rs,d as as,e as Fe,f as ns,S as Je}from"./chunk-M6kWLAXF.js";function G(...s){return St(Ot(s))}const is=st("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function de({className:s,variant:e,size:r,asChild:a=!1,...o}){const x=a?rt:"button";return t.jsx(x,{"data-slot":"button",className:G(is({variant:e,size:r,className:s})),...o})}const l=(s,e,r=null)=>{const o=`[PreferenceUtils] ${new Date().toISOString()}`;switch(s){case"info":console.log(`${o} ℹ️ ${e}`,r);break;case"warn":console.warn(`${o} ⚠️ ${e}`,r);break;case"error":console.error(`${o} ❌ ${e}`,r);break;default:console.log(`${o} ${e}`,r)}},ls=()=>{try{if(l("info","런타임 설정 접근 시도"),typeof window<"u"&&window.__RUNTIME_CONFIG__){const s=window.__RUNTIME_CONFIG__;return l("info","런타임 설정 로드 성공",s),s}return l("warn","런타임 설정이 없음 - 기본값 사용"),{}}catch(s){return l("error","런타임 설정 접근 실패",s.message),{}}},nt=()=>{l("info","기본 설정값 생성 시작");const s=ls(),e={dashboardSettings:{selectedPegs:[],defaultNe:"",defaultCellId:"",autoRefreshInterval:30,chartStyle:"line",showLegend:!0,showGrid:!0,theme:"light",defaultTimeRange:30,timeUnit:"minutes",time1Start:null,time1End:null,time2Start:null,time2End:null,enableTimeComparison:!1},statisticsSettings:{defaultDateRange:7,comparisonEnabled:!0,showDelta:!0,showRsd:!0,defaultPegs:["availability","rrc"],chartType:"bar",decimalPlaces:2,autoAnalysis:!1},databaseSettings:{host:s.DB_HOST||"postgres",port:parseInt(s.DB_PORT,10)||5432,user:s.DB_USER||"postgres",password:s.DB_PASSWORD||"postgres",dbname:s.DB_NAME||"netperf",table:"summary"},notificationSettings:{enableToasts:!0,enableSounds:!1,saveNotification:!0,errorNotification:!0},generalSettings:{language:"ko",timezone:"Asia/Seoul",dateFormat:"YYYY-MM-DD",numberFormat:"comma"},pegConfigurations:[],statisticsConfigurations:[],derivedPegSettings:{formulas:[],settings:{autoValidate:!1,showInDashboard:!1,showInStatistics:!1,evaluationPrecision:4}}};return l("info","기본 설정값 생성 완료",{sections:Object.keys(e),runtimeConfigKeys:Object.keys(s)}),e},Le={dashboardSettings:{selectedPegs:{required:!1,type:"array",message:"selectedPegs는 배열이어야 합니다."},autoRefreshInterval:{required:!1,type:"number",min:5,max:300,message:"자동 새로고침 간격은 5초~300초 사이여야 합니다."},defaultNe:{type:"string",maxLength:50,message:"NE ID는 50자를 초과할 수 없습니다."},defaultCellId:{type:"string",maxLength:50,message:"Cell ID는 50자를 초과할 수 없습니다."}},statisticsSettings:{defaultDateRange:{required:!1,type:"number",min:1,max:365,message:"기본 날짜 범위는 1일~365일 사이여야 합니다."},decimalPlaces:{required:!1,type:"number",min:0,max:6,message:"소수점 자릿수는 0~6자리 사이여야 합니다."},defaultPegs:{required:!1,type:"array",message:"defaultPegs는 배열이어야 합니다."}}},os=(s,e=null)=>{l("info","설정 유효성 검증 시작",{section:e,hasSettings:!!s});const r={};if(!s||typeof s!="object")return l("error","설정 객체가 유효하지 않음"),{general:"설정 객체가 유효하지 않습니다."};if(e&&!Le[e])return l("warn","지정된 섹션에 대한 검증 규칙이 없음",e),r;const a=e?{[e]:Le[e]}:Le;Object.entries(a).forEach(([x,c])=>{if(!s[x]){l("info","섹션이 없음 - 검증 스킵",x);return}Object.entries(c).forEach(([d,m])=>{const h=s[x][d],S=`${x}.${d}`;if(m.required&&(h==null||h==="")){r[S]=m.message||`${d}는 필수 항목입니다.`,l("warn","필수 필드 누락",{fieldPath:S,value:h});return}if(h==null||h===""){l("info","필드 값이 없음 - 검증 스킵",S);return}if(m.type==="array"&&!Array.isArray(h)){r[S]=m.message||`${d}는 배열이어야 합니다.`,l("warn","타입 검증 실패 - 배열이 아님",{fieldPath:S,value:h,expectedType:"array"});return}if(m.type==="number"&&typeof h!="number"){r[S]=m.message||`${d}는 숫자여야 합니다.`,l("warn","타입 검증 실패 - 숫자가 아님",{fieldPath:S,value:h,expectedType:"number"});return}if(m.type==="string"&&typeof h!="string"){r[S]=m.message||`${d}는 문자열이어야 합니다.`,l("warn","타입 검증 실패 - 문자열이 아님",{fieldPath:S,value:h,expectedType:"string"});return}if(m.type==="number"){if(m.min!==void 0&&h<m.min){r[S]=m.message||`${d}는 ${m.min} 이상이어야 합니다.`,l("warn","숫자 범위 검증 실패 - 최소값 미달",{fieldPath:S,value:h,min:m.min});return}if(m.max!==void 0&&h>m.max){r[S]=m.message||`${d}는 ${m.max} 이하여야 합니다.`,l("warn","숫자 범위 검증 실패 - 최대값 초과",{fieldPath:S,value:h,max:m.max});return}}if(m.type==="array"){if(m.minLength!==void 0&&h.length<m.minLength){r[S]=m.message||`${d}는 최소 ${m.minLength}개 항목이 필요합니다.`,l("warn","배열 길이 검증 실패 - 최소 길이 미달",{fieldPath:S,length:h.length,minLength:m.minLength});return}if(m.maxLength!==void 0&&h.length>m.maxLength){r[S]=m.message||`${d}는 최대 ${m.maxLength}개 항목만 허용됩니다.`,l("warn","배열 길이 검증 실패 - 최대 길이 초과",{fieldPath:S,length:h.length,maxLength:m.maxLength});return}}if(m.type==="string"){if(m.minLength!==void 0&&h.length<m.minLength){r[S]=m.message||`${d}는 최소 ${m.minLength}자 이상이어야 합니다.`,l("warn","문자열 길이 검증 실패 - 최소 길이 미달",{fieldPath:S,length:h.length,minLength:m.minLength});return}if(m.maxLength!==void 0&&h.length>m.maxLength){r[S]=m.message||`${d}는 최대 ${m.maxLength}자까지 허용됩니다.`,l("warn","문자열 길이 검증 실패 - 최대 길이 초과",{fieldPath:S,length:h.length,maxLength:m.maxLength});return}}})});const o=Object.keys(r).length;return l("info","설정 유효성 검증 완료",{errorCount:o,hasErrors:o>0,errorFields:Object.keys(r)}),r},Ze=(s,e)=>{if(l("info","설정 병합 시작",{hasSavedSettings:!!s,hasDefaultSettings:!!e}),!s)return l("info","저장된 설정이 없음 - 기본값 반환"),e;try{const r={...e};return Object.keys(e).forEach(a=>{s[a]&&typeof s[a]=="object"?(r[a]={...e[a],...s[a]},l("info","섹션 병합 완료",{section:a,mergedKeys:Object.keys(r[a])})):l("info","섹션이 없거나 객체가 아님 - 기본값 사용",{section:a})}),l("info","설정 병합 완료",{mergedSections:Object.keys(r),totalSections:Object.keys(e).length}),r}catch(r){return l("error","설정 병합 실패",r.message),e}},De="kpi-dashboard-preferences",Te=()=>{try{const s="__localStorage_test__";return localStorage.setItem(s,s),localStorage.removeItem(s),!0}catch(s){return l("warn","localStorage 사용 불가",s.message),!1}},cs=s=>{if(l("info","localStorage 저장 시작",{hasSettings:!!s}),!Te()){const e="localStorage를 사용할 수 없습니다";throw l("error","localStorage 저장 실패",e),new Error(e)}try{const e={settings:s,lastSaved:new Date().toISOString(),version:1};return localStorage.setItem(De,JSON.stringify(e)),l("info","localStorage 저장 완료",{lastSaved:e.lastSaved,settingsKeys:Object.keys(s)}),{success:!0,lastSaved:e.lastSaved}}catch(e){throw l("error","localStorage 저장 실패",e.message),new Error(`설정 저장 실패: ${e.message}`)}},ds=()=>{if(l("info","localStorage 로드 시작"),!Te())return l("warn","localStorage 사용 불가 - null 반환"),null;try{const s=localStorage.getItem(De);if(!s)return l("info","localStorage에 저장된 설정 없음"),null;const e=JSON.parse(s);return l("info","localStorage 로드 완료",{lastSaved:e.lastSaved,version:e.version,settingsKeys:Object.keys(e.settings||{})}),e.settings}catch(s){l("error","localStorage 로드 실패",s.message);try{localStorage.removeItem(De),l("info","손상된 데이터 제거 완료")}catch(e){l("error","손상된 데이터 제거 실패",e.message)}throw new Error(`설정 로드 실패: ${s.message}`)}},us=()=>{if(l("info","localStorage 삭제 시작"),!Te()){const s="localStorage를 사용할 수 없습니다";return l("error","localStorage 삭제 실패",s),{success:!1,error:s}}try{return localStorage.removeItem(De),l("info","localStorage 삭제 완료"),{success:!0}}catch(s){return l("error","localStorage 삭제 실패",s.message),{success:!1,error:s.message}}},ms=()=>{const[s,e]=g.useState(!1),[r,a]=g.useState(null),[o,x]=g.useState(null);g.useEffect(()=>{l("info","localStorage 사용 가능 여부 확인 시작");const N=Te();e(N),l("info","localStorage 사용 가능 여부 확인 완료",{available:N})},[]);const c=g.useCallback(async N=>{l("info","설정 저장 시작",{hasSettings:!!N}),x(null);try{const f=cs(N);return a(f.lastSaved),l("info","설정 저장 완료",f),{success:!0,lastSaved:f.lastSaved}}catch(f){const w=f.message;return x(w),l("error","설정 저장 실패",w),{success:!1,error:w}}},[]),d=g.useCallback(async()=>{l("info","설정 로드 시작"),x(null);try{const N=ds();return l("info","설정 로드 완료",{hasSettings:!!N}),{success:!0,settings:N}}catch(N){const f=N.message;return x(f),l("error","설정 로드 실패",f),{success:!1,error:f,settings:null}}},[]),m=g.useCallback(async()=>{l("info","설정 삭제 시작"),x(null);try{const N=us();return N.success?(a(null),l("info","설정 삭제 완료")):(x(N.error),l("error","설정 삭제 실패",N.error)),N}catch(N){const f=N.message;return x(f),l("error","설정 삭제 실패",f),{success:!1,error:f}}},[]),h=g.useCallback(async(N,f=null)=>{l("info","설정 백업 시작",{hasSettings:!!N}),x(null);try{const w={settings:N,metadata:{exportedAt:new Date().toISOString(),version:"1.0.0",type:"backup"}},i=JSON.stringify(w,null,2),k=new Blob([i],{type:"application/json"}),n=document.createElement("a");return n.href=URL.createObjectURL(k),n.download=f||`preference-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(n.href),l("info","설정 백업 완료",{filename:n.download}),{success:!0,filename:n.download}}catch(w){const i=w.message;return x(i),l("error","설정 백업 실패",i),{success:!1,error:i}}},[]),S=g.useCallback(async N=>(l("info","설정 복원 시작",{fileName:N==null?void 0:N.name}),x(null),new Promise((f,w)=>{const i=new FileReader;i.onload=k=>{try{const n=JSON.parse(k.target.result);if(!n.settings)throw new Error("유효하지 않은 백업 파일입니다.");l("info","설정 복원 완료",{fileName:N.name,settingsKeys:Object.keys(n.settings)}),f({success:!0,settings:n.settings,metadata:n.metadata})}catch(n){const u=n.message;x(u),l("error","설정 복원 실패",u),w(n)}},i.onerror=()=>{const k=new Error("파일 읽기 실패");x(k.message),l("error","설정 복원 실패",k.message),w(k)},i.readAsText(N)})),[]),P=g.useCallback(()=>{if(l("info","동기화 상태 확인 시작"),!s)return l("warn","localStorage 사용 불가 - 동기화 불가"),{synced:!1,reason:"localStorage_unavailable"};try{const N=localStorage.getItem(De);if(!N)return l("info","저장된 설정 없음 - 동기화 불필요"),{synced:!0,reason:"no_data"};const f=JSON.parse(N),w=!!f.settings;return l("info","동기화 상태 확인 완료",{synced:w,lastSaved:f.lastSaved,hasData:w}),{synced:w,lastSaved:f.lastSaved,reason:w?"synced":"no_data"}}catch(N){return l("error","동기화 상태 확인 실패",N.message),{synced:!1,reason:"error",error:N.message}}},[s]);return{isAvailable:s,lastSaved:r,error:o,saveSettings:c,loadSettings:d,clearSettings:m,backupSettings:h,restoreSettings:S,checkSyncStatus:P,isLocalStorageAvailable:Te}},D=(s,e,r=null)=>{const o=`[ApiClient:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${o} ${e}`,r);break;case"error":console.error(`${o} ${e}`,r);break;case"warn":console.warn(`${o} ${e}`,r);break;case"debug":console.debug(`${o} ${e}`,r);break;default:console.log(`${o} ${e}`,r)}},fs=()=>{try{let s=null;if(s="http://localhost:8000",D("info","Vite 환경변수에서 URL 사용 (최고 우선순위)",s),!s){const e=typeof window<"u"?window.__RUNTIME_CONFIG__||{}:{};e.VITE_API_BASE_URL&&String(e.VITE_API_BASE_URL).trim()?(s=String(e.VITE_API_BASE_URL).trim(),D("info","런타임 설정에서 VITE_API_BASE_URL 사용",s)):e.BACKEND_BASE_URL&&String(e.BACKEND_BASE_URL).trim()&&(s=String(e.BACKEND_BASE_URL).trim(),D("info","런타임 설정에서 BACKEND_BASE_URL 사용",s))}if(!s){const e=typeof window<"u"?window.location.hostname:"localhost";e!=="localhost"&&e!=="127.0.0.1"?(s="http://165.213.69.30:8000",D("info","외부 호스트 감지, 외부 백엔드 URL 사용",s)):(s="http://165.213.69.30:8000",D("info","개발 환경에서도 외부 백엔드 우선 사용",s))}return s&&s.includes("/api")?D("info","baseURL에 /api가 이미 포함되어 있음",s):s&&!s.endsWith("/api")&&(s=s.endsWith("/")?`${s}api`:`${s}/api`),D("info","최종 API URL 결정",{baseURL:s,runtimeCfg:Object.keys(runtimeCfg),currentHost:typeof window<"u"?window.location.hostname:"unknown",isDockerEnv:typeof window<"u"&&window.location.hostname!=="localhost"}),s}catch(s){D("error","API 기본 URL 설정 오류",s);const e=typeof window<"u"&&window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1";return"http://165.213.69.30:8000"}},be=s=>{var e,r;try{return(r=(e=s==null?void 0:s.response)==null?void 0:e.data)!=null&&r.detail?s.response.data.detail:s!=null&&s.message?s.message:"알 수 없는 오류가 발생했습니다."}catch(a){return D("error","에러 메시지 추출 실패",a),"알 수 없는 오류가 발생했습니다."}},it=fs(),re=$t.create({baseURL:it,timeout:15e3,withCredentials:!1});D("info","API 클라이언트 초기화 완료",{baseURL:it,timeout:15e3});re.interceptors.request.use(s=>{var e;return D("debug","API 요청 시작",{method:(e=s.method)==null?void 0:e.toUpperCase(),url:s.url,baseURL:s.baseURL,hasData:!!s.data,hasParams:!!s.params}),s},s=>(D("error","API 요청 인터셉터 오류",s),Promise.reject(s)));re.interceptors.response.use(s=>{var e;return D("debug","API 응답 성공",{status:s.status,url:s.config.url,method:(e=s.config.method)==null?void 0:e.toUpperCase()}),s},s=>{var r,a,o,x;const e=be(s);return D("error","API 응답 오류",{status:(r=s==null?void 0:s.response)==null?void 0:r.status,url:(a=s==null?void 0:s.config)==null?void 0:a.url,method:(x=(o=s==null?void 0:s.config)==null?void 0:o.method)==null?void 0:x.toUpperCase(),message:e}),Y.error(`요청 실패: ${e}`),Promise.reject(s)});const Bs=async s=>{var e,r,a,o;D("info","상세 분석 결과 조회 시작",{resultId:s});try{if(!s||typeof s!="string"||s.trim().length===0)throw new Error("유효하지 않은 분석 결과 ID입니다.");const x=await re.get(`/api/results/${s}/detailed`);if(!x.data)throw new Error("분석 결과 데이터가 없습니다.");const c=x.data;return c.id||(D("warn","응답에 ID가 없어 요청 ID로 설정",{requestId:s}),c.id=s),c.timestamp||(D("warn","응답에 timestamp가 없어 현재 시간으로 설정"),c.timestamp=new Date().toISOString()),c.llmAnalysis&&D("debug","LLM 분석 데이터 확인됨"),c.choiAnalysis&&D("debug","Choi 알고리즘 분석 데이터 확인됨"),c.mahalanobisAnalysis&&D("debug","마할라노비스 분석 데이터 확인됨"),c.pegAnalysis&&D("debug","PEG 분석 데이터 확인됨"),D("info","상세 분석 결과 조회 성공",{resultId:s,hasLlm:!!c.llmAnalysis,hasChoi:!!c.choiAnalysis,hasMahalanobis:!!c.mahalanobisAnalysis,hasPeg:!!c.pegAnalysis}),c}catch(x){const c=be(x);throw D("error","상세 분석 결과 조회 실패",{resultId:s,error:c,status:(e=x==null?void 0:x.response)==null?void 0:e.status}),((r=x==null?void 0:x.response)==null?void 0:r.status)===404?new Error(`분석 결과를 찾을 수 없습니다. (ID: ${s})`):((a=x==null?void 0:x.response)==null?void 0:a.status)===403?new Error("분석 결과에 접근할 권한이 없습니다."):((o=x==null?void 0:x.response)==null?void 0:o.status)>=500?new Error("서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요."):x}},Ie=async(s="default")=>{var e;D("info","사용자 설정 조회",{userId:s});try{const r=await re.get("/api/preference/settings",{params:{user_id:s}});return D("info","사용자 설정 조회 성공",{userId:s}),{success:!0,data:r.data}}catch(r){return((e=r==null?void 0:r.response)==null?void 0:e.status)===404?(D("info","사용자 설정이 없음 (신규 사용자)",{userId:s}),{success:!0,data:null,isNew:!0}):(D("error","사용자 설정 조회 실패",{userId:s,error:r}),{success:!1,error:be(r)})}},Re=async(s="default",e)=>{D("info","사용자 설정 저장",{userId:s,hasData:!!e,dataKeys:e?Object.keys(e):[]});try{const r=await re.put("/api/preference/settings",e,{params:{user_id:s}});return D("info","사용자 설정 저장 성공",{userId:s}),{success:!0,data:r.data}}catch(r){return D("error","사용자 설정 저장 실패",{userId:s,error:r}),{success:!1,error:be(r)}}},Ye=async s=>{const e=s.user_id||s.userId;D("info","사용자 설정 생성",{userId:e});try{const r=await re.post("/api/preference/settings",s);return D("info","사용자 설정 생성 성공",{userId:e}),{success:!0,data:r.data}}catch(r){return D("error","사용자 설정 생성 실패",{userId:e,error:r}),{success:!1,error:be(r)}}},gs=async(s="default")=>{D("info","사용자 설정 삭제",{userId:s});try{return await re.delete("/api/preference/settings",{params:{user_id:s}}),D("info","사용자 설정 삭제 성공",{userId:s}),{success:!0}}catch(e){return D("error","사용자 설정 삭제 실패",{userId:s,error:e}),{success:!1,error:be(e)}}},hs=async(s="default")=>{D("info","사용자 설정 내보내기",{userId:s});try{const e=await re.get("/api/preference/export",{params:{user_id:s}});return D("info","사용자 설정 내보내기 성공",{userId:s}),{success:!0,data:e.data}}catch(e){return D("error","사용자 설정 내보내기 실패",{userId:s,error:e}),{success:!1,error:be(e)}}},xs=async(s="default",e,r=!1)=>{D("info","사용자 설정 가져오기",{userId:s,fileName:e==null?void 0:e.name,fileSize:e==null?void 0:e.size,overwrite:r});try{const a=new FormData;a.append("file",e);const o=await re.post("/api/preference/import",a,{params:{user_id:s,overwrite:r},headers:{"Content-Type":"multipart/form-data"}});return D("info","사용자 설정 가져오기 성공",{userId:s}),{success:!0,data:o.data}}catch(a){return D("error","사용자 설정 가져오기 실패",{userId:s,error:a}),{success:!1,error:be(a)}}},ps=()=>{const[s,e]=g.useState(!1),[r,a]=g.useState(null),[o,x]=g.useState(null),c=g.useCallback(async u=>{var p,v;l("info","API 작업 시작"),e(!0),a(null);try{const b=await u();return x(new Date),l("info","API 작업 완료",{success:!0}),b}catch(b){const y=((v=(p=b==null?void 0:b.response)==null?void 0:p.data)==null?void 0:v.detail)||(b==null?void 0:b.message)||"알 수 없는 오류가 발생했습니다.";throw a(y),l("error","API 작업 실패",y),b}finally{e(!1)}},[]),d=g.useCallback(async(u="default")=>(l("info","사용자 설정 조회 시작",{userId:u}),await c(async()=>{const p=await Ie(u);if(p.success)return l("info","사용자 설정 조회 성공",{hasData:!!p.data,isNew:p.isNew}),p;throw new Error(p.error||"설정 조회 실패")})),[c]),m=g.useCallback(async(u="default",p)=>(l("info","사용자 설정 저장 시작",{userId:u,hasData:!!p,dataKeys:p?Object.keys(p):[]}),await c(async()=>{const v=await Re(u,p);if(v.success)return l("info","사용자 설정 저장 성공"),Y.success("설정이 서버에 저장되었습니다"),v;throw new Error(v.error||"설정 저장 실패")})),[c]),h=g.useCallback(async u=>(l("info","사용자 설정 생성 시작",{userId:u.user_id||u.userId,hasData:!!u}),await c(async()=>{const p=await Ye(u);if(p.success)return l("info","사용자 설정 생성 성공"),Y.success("새로운 설정이 생성되었습니다"),p;throw new Error(p.error||"설정 생성 실패")})),[c]),S=g.useCallback(async(u="default")=>(l("info","사용자 설정 삭제 시작",{userId:u}),await c(async()=>{const p=await gs(u);if(p.success)return l("info","사용자 설정 삭제 성공"),Y.success("설정이 삭제되었습니다"),p;throw new Error(p.error||"설정 삭제 실패")})),[c]),P=g.useCallback(async(u="default")=>(l("info","설정 내보내기 시작",{userId:u}),await c(async()=>{const p=await hs(u);if(p.success){l("info","설정 내보내기 성공");const v=JSON.stringify(p.data,null,2),b=new Blob([v],{type:"application/json"}),y=document.createElement("a");return y.href=URL.createObjectURL(b),y.download=`preference-export-${u}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(y.href),Y.success("설정이 파일로 내보내졌습니다"),{...p,filename:y.download}}else throw new Error(p.error||"설정 내보내기 실패")})),[c]),N=g.useCallback(async(u="default",p,v=!1)=>(l("info","설정 가져오기 시작",{userId:u,fileName:p==null?void 0:p.name,overwrite:v}),await c(async()=>{const b=await xs(u,p,v);if(b.success)return l("info","설정 가져오기 성공"),Y.success("설정이 성공적으로 가져와졌습니다"),b;throw new Error(b.error||"설정 가져오기 실패")})),[c]),f=g.useCallback(async(u="default",p)=>(l("info","서버 동기화 시작",{userId:u,hasLocalSettings:!!p}),await c(async()=>{try{const v=await Ie(u);if(v.success&&v.data){const b=await Re(u,p);if(b.success)return l("info","서버 동기화 완료 - 업데이트"),Y.success("설정이 서버와 동기화되었습니다"),{success:!0,action:"updated"};throw new Error(b.error||"설정 업데이트 실패")}else{const b={user_id:u,...p},y=await Ye(b);if(y.success)return l("info","서버 동기화 완료 - 생성"),Y.success("새로운 설정이 서버에 생성되었습니다"),{success:!0,action:"created"};throw new Error(y.error||"설정 생성 실패")}}catch(v){throw l("error","서버 동기화 실패",v.message),v}})),[c]),w=g.useCallback(async(u="default")=>(l("info","서버에서 동기화 시작",{userId:u}),await c(async()=>{const p=await Ie(u);if(p.success)return l("info","서버에서 동기화 완료",{hasData:!!p.data,isNew:p.isNew}),p.data?Y.success("서버에서 설정을 가져왔습니다"):Y.info("서버에 저장된 설정이 없습니다"),p;throw new Error(p.error||"서버 동기화 실패")})),[c]),i=g.useCallback(async(u="default",p,v,b="local")=>(l("info","설정 충돌 해결 시작",{userId:u,strategy:b,hasLocalSettings:!!p,hasServerSettings:!!v}),await c(async()=>{let y=null;switch(b){case"local":y=p,l("info","로컬 설정으로 충돌 해결");break;case"server":y=v,l("info","서버 설정으로 충돌 해결");break;case"merge":y={...p,...v},l("info","설정 병합으로 충돌 해결");break;default:throw new Error("알 수 없는 충돌 해결 전략입니다")}const F=await Re(u,y);if(F.success)return l("info","충돌 해결 완료"),Y.success("설정 충돌이 해결되었습니다"),{success:!0,resolvedSettings:y,strategy:b};throw new Error(F.error||"충돌 해결 실패")})),[c]),k=g.useCallback(async()=>{l("info","네트워크 상태 확인 시작");try{const u=await re.get("/api/health",{timeout:5e3}),p=u.status===200;return l("info","네트워크 상태 확인 완료",{isOnline:p}),{isOnline:p,status:u.status}}catch(u){return l("warn","네트워크 상태 확인 실패",u.message),{isOnline:!1,error:u.message}}},[]),n=g.useCallback(()=>{l("info","에러 상태 초기화"),a(null)},[]);return{loading:s,error:r,lastSync:o,getUserPreferences:d,saveUserPreferences:m,createUserPreferences:h,deleteUserPreferences:S,exportUserPreferences:P,importUserPreferences:N,syncToServer:f,syncFromServer:w,resolveConflict:i,checkNetworkStatus:k,clearError:n}},lt=g.createContext(null),Vs=({children:s})=>{const e=g.useMemo(()=>nt(),[]),[r,a]=g.useState(e),[o,x]=g.useState(!1),[c,d]=g.useState(!1),[m,h]=g.useState(null),[S,P]=g.useState(!1),[N,f]=g.useState(!1),[w,i]=g.useState(null),k=g.useRef(!1),n=ms(),u=ps();g.useEffect(()=>(l("info","PreferenceProvider 초기화 시작"),k.current=!0,(async()=>{try{if(x(!0),h(null),await new Promise(_=>setTimeout(_,100)),!k.current)return;if(n.isAvailable)try{l("info","초기화 시 localStorage에서 설정 로드 시작");const _=await n.loadSettings();if(_.success&&_.settings){const V=Ze(_.settings,e);a(V),f(!1),l("info","초기화 시 설정 로드 완료",{settingsKeys:Object.keys(V)})}else l("info","저장된 설정 없음 - 기본값 사용"),a(e)}catch(_){l("warn","초기화 시 설정 로드 실패, 기본값 사용",_.message),a(e)}else l("warn","localStorage 사용 불가 - 기본값 사용"),a(e);P(!0),l("info","PreferenceProvider 초기화 완료")}catch(_){l("error","PreferenceProvider 초기화 오류",_.message),h(_.message),a(e),P(!0)}finally{x(!1)}})(),()=>{k.current=!1}),[n.isAvailable]);const p=g.useCallback((A,_,V)=>{l("info","설정 업데이트",{section:A,key:_,value:V}),a(le=>{const oe={...le,[A]:{...le[A],[_]:V}};return f(!0),i(new Date),l("info","설정 업데이트 완료",{section:A,key:_}),oe})},[]),v=g.useCallback(A=>{l("info","다중 설정 업데이트 시작",{newSettingsKeys:Object.keys(A)}),a(_=>{const V={..._};return Object.entries(A).forEach(([le,oe])=>{typeof oe=="object"&&(V[le]={...V[le],...oe})}),f(!0),i(new Date),l("info","다중 설정 업데이트 완료"),V})},[]),b=g.useCallback(async()=>{l("info","설정 저장 시작");try{d(!0),h(null);const A=await n.saveSettings(r);if(A.success)return f(!1),l("info","설정 저장 완료"),{success:!0};throw new Error(A.error)}catch(A){const _=A.message;return h(_),l("error","설정 저장 실패",_),{success:!1,error:_}}finally{d(!1)}},[r,n]),y=g.useCallback(async()=>{l("info","설정 로드 시작");try{x(!0),h(null);const A=await n.loadSettings();if(A.success){if(A.settings){const _=Ze(A.settings,e);a(_),f(!1),l("info","설정 로드 완료",{settingsKeys:Object.keys(_)})}else l("info","저장된 설정 없음");return{success:!0,settings:A.settings}}else throw new Error(A.error)}catch(A){const _=A.message;return h(_),l("error","설정 로드 실패",_),{success:!1,error:_}}finally{x(!1)}},[e,n]),F=g.useCallback(async(A=null)=>{l("info","설정 초기화 시작",{sections:A});try{x(!0),h(null);let _=e;return A&&Array.isArray(A)&&(_={...r},A.forEach(V=>{e[V]&&(_[V]={...e[V]})})),a(_),f(!0),i(new Date),A===null&&await n.clearSettings(),l("info","설정 초기화 완료"),{success:!0}}catch(_){const V=_.message;return h(V),l("error","설정 초기화 실패",V),{success:!1,error:V}}finally{x(!1)}},[e,r,n]),M=g.useCallback((A=null)=>{l("info","설정 유효성 검증 시작",{section:A});const _=os(r,A);return Object.keys(_).length>0?(l("warn","설정 유효성 검증 실패",_),h(`설정 오류: ${Object.values(_)[0]}`)):(l("info","설정 유효성 검증 통과"),h(null)),_},[r]),xe={state:{settings:r,loading:o||n.loading||u.loading,saving:c||n.saving||u.saving,error:m||n.error||u.error,initialized:S,hasUnsavedChanges:N,lastModified:w,lastSaved:n.lastSaved,lastSync:u.lastSync,localStorageAvailable:n.isAvailable},settings:r,dashboardSettings:r.dashboardSettings||{},statisticsSettings:r.statisticsSettings||{},databaseSettings:r.databaseSettings||{},notificationSettings:r.notificationSettings||{},generalSettings:r.generalSettings||{},updateSetting:p,updateSettings:v,saveSettings:b,loadSettings:y,resetSettings:F,validateCurrentSettings:M,storage:n,api:u};return t.jsx(lt.Provider,{value:xe,children:s})},bs=()=>{const s=g.useContext(lt);if(!s){l("warn","usePreference: PreferenceProvider 외부에서 사용됨 - 기본값 반환");const e=nt();return{state:{settings:e,loading:!1,saving:!1,error:null,initialized:!1,hasUnsavedChanges:!1,lastModified:null,lastSaved:null,lastSync:null,localStorageAvailable:!1},settings:e,dashboardSettings:e.dashboardSettings||{},statisticsSettings:e.statisticsSettings||{},databaseSettings:e.databaseSettings||{},notificationSettings:e.notificationSettings||{},generalSettings:e.generalSettings||{},updateSetting:()=>{},updateSettings:()=>{},saveSettings:()=>Promise.resolve({success:!1}),loadSettings:()=>Promise.resolve({success:!1}),resetSettings:()=>Promise.resolve({success:!1}),validateCurrentSettings:()=>({}),storage:{isAvailable:!1,saveSettings:()=>Promise.resolve({success:!1}),loadSettings:()=>Promise.resolve({success:!1}),clearSettings:()=>Promise.resolve({success:!1}),error:null},api:{loading:!1,error:null,getUserPreferences:()=>Promise.resolve({success:!1}),saveUserPreferences:()=>Promise.resolve({success:!1}),clearError:()=>{}}}}return s};function Ee({className:s,...e}){return t.jsx("div",{"data-slot":"card",className:G("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...e})}function ot({className:s,...e}){return t.jsx("div",{"data-slot":"card-header",className:G("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...e})}function ct({className:s,...e}){return t.jsx("div",{"data-slot":"card-title",className:G("leading-none font-semibold",s),...e})}function Ws({className:s,...e}){return t.jsx("div",{"data-slot":"card-description",className:G("text-muted-foreground text-sm",s),...e})}function Hs({className:s,...e}){return t.jsx("div",{"data-slot":"card-action",className:G("col-start-2 row-span-2 row-start-1 self-start justify-self-end",s),...e})}function _e({className:s,...e}){return t.jsx("div",{"data-slot":"card-content",className:G("px-6",s),...e})}const ys=st("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function ie({className:s,variant:e,asChild:r=!1,...a}){const o=r?rt:"span";return t.jsx(o,{"data-slot":"badge",className:G(ys({variant:e}),s),...a})}function js({...s}){return t.jsx(At,{"data-slot":"dialog",...s})}function vs({...s}){return t.jsx(Ut,{"data-slot":"dialog-portal",...s})}function ws({className:s,...e}){return t.jsx(zt,{"data-slot":"dialog-overlay",className:G("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...e})}function Ss({className:s,children:e,...r}){return t.jsxs(vs,{"data-slot":"dialog-portal",children:[t.jsx(ws,{}),t.jsxs(Lt,{"data-slot":"dialog-content",className:G("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...r,children:[e,t.jsxs(It,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[t.jsx(Ue,{}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function $s({className:s,...e}){return t.jsx("div",{"data-slot":"dialog-header",className:G("flex flex-col gap-2 text-center sm:text-left",s),...e})}function Ns({className:s,...e}){return t.jsx(Rt,{"data-slot":"dialog-title",className:G("text-lg leading-none font-semibold",s),...e})}function Gs({className:s,...e}){return t.jsx(Mt,{"data-slot":"dialog-description",className:G("text-muted-foreground text-sm",s),...e})}const E=(s,e,r=null)=>{const o=`[usePreference:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${o} ${e}`,r);break;case"error":console.error(`${o} ${e}`,r);break;case"warn":console.warn(`${o} ${e}`,r);break;case"debug":console.debug(`${o} ${e}`,r);break;default:console.log(`${o} ${e}`,r)}},Me={dashboardSettings:{selectedPegs:{required:!0,type:"array",minLength:1,message:"최소 하나의 PEG를 선택해야 합니다."},autoRefreshInterval:{required:!0,type:"number",min:5,max:300,message:"자동 새로고침 간격은 5초~300초 사이여야 합니다."},defaultNe:{type:"string",maxLength:50,message:"NE ID는 50자를 초과할 수 없습니다."},defaultCellId:{type:"string",maxLength:50,message:"Cell ID는 50자를 초과할 수 없습니다."}},statisticsSettings:{defaultDateRange:{required:!0,type:"number",min:1,max:365,message:"기본 날짜 범위는 1일~365일 사이여야 합니다."},decimalPlaces:{required:!0,type:"number",min:0,max:6,message:"소수점 자릿수는 0~6자리 사이여야 합니다."},defaultPegs:{required:!0,type:"array",minLength:1,message:"최소 하나의 기본 PEG를 선택해야 합니다."}}},Xe=(s,e=null)=>{E("debug","설정 유효성 검증 시작",{section:e,settings:s});const r={};if(e&&!Me[e])return E("warn",`검증 규칙이 없는 섹션: ${e}`),r;const a=e?{[e]:Me[e]}:Me;return Object.entries(a).forEach(([o,x])=>{if(!s[o]){E("debug",`섹션 ${o}가 설정에 없음`);return}Object.entries(x).forEach(([c,d])=>{const m=s[o][c],h=`${o}.${c}`;if(d.required&&(m==null||m==="")){r[h]=d.message||`${c}는 필수 항목입니다.`,E("error",`필수 필드 누락: ${h}`);return}if(m==null||m===""){E("debug",`필드 ${h} 값이 없어 검증 스킵`);return}if(d.type==="array"&&!Array.isArray(m)){r[h]=d.message||`${c}는 배열이어야 합니다.`,E("error",`타입 오류: ${h}는 배열이어야 함`);return}if(d.type==="number"&&typeof m!="number"){r[h]=d.message||`${c}는 숫자여야 합니다.`,E("error",`타입 오류: ${h}는 숫자여야 함`);return}if(d.type==="string"&&typeof m!="string"){r[h]=d.message||`${c}는 문자열이어야 합니다.`,E("error",`타입 오류: ${h}는 문자열이어야 함`);return}if(d.type==="number"){if(d.min!==void 0&&m<d.min){r[h]=d.message||`${c}는 ${d.min} 이상이어야 합니다.`,E("error",`범위 오류: ${h}는 ${d.min} 이상이어야 함`);return}if(d.max!==void 0&&m>d.max){r[h]=d.message||`${c}는 ${d.max} 이하여야 합니다.`,E("error",`범위 오류: ${h}는 ${d.max} 이하여야 함`);return}}if(d.type==="array"){if(d.minLength!==void 0&&m.length<d.minLength){r[h]=d.message||`${c}는 최소 ${d.minLength}개 항목이 필요합니다.`,E("error",`배열 길이 오류: ${h}는 최소 ${d.minLength}개 필요`);return}if(d.maxLength!==void 0&&m.length>d.maxLength){r[h]=d.message||`${c}는 최대 ${d.maxLength}개 항목만 허용됩니다.`,E("error",`배열 길이 오류: ${h}는 최대 ${d.maxLength}개만 허용`);return}}if(d.type==="string"){if(d.minLength!==void 0&&m.length<d.minLength){r[h]=d.message||`${c}는 최소 ${d.minLength}자 이상이어야 합니다.`,E("error",`문자열 길이 오류: ${h}는 최소 ${d.minLength}자 필요`);return}if(d.maxLength!==void 0&&m.length>d.maxLength){r[h]=d.message||`${c}는 최대 ${d.maxLength}자까지 허용됩니다.`,E("error",`문자열 길이 오류: ${h}는 최대 ${d.maxLength}자만 허용`);return}}})}),E("debug","설정 유효성 검증 완료",{errors:r}),r},dt=()=>{const s=g.useRef(!1);s.current||(E("debug","usePreference 훅 초기화"),s.current=!0);const e=bs(),[r,a]=g.useState({}),o=g.useMemo(()=>{const f=(e==null?void 0:e.settings)||{};return E("debug","설정 접근",{hasSettings:!!f}),f},[e==null?void 0:e.settings]),x=g.useCallback(f=>{E("info","설정 업데이트 시작",{newSettings:f}),e!=null&&e.updateSetting?(Object.entries(f).forEach(([w,i])=>{typeof i=="object"&&Object.entries(i).forEach(([k,n])=>{E("debug",`설정 업데이트: ${w}.${k}`,{value:n}),e.updateSetting(w,k,n)})}),E("info","설정 업데이트 완료")):E("error","updateSetting 함수를 사용할 수 없음")},[e==null?void 0:e.updateSetting]),c=g.useCallback(async()=>{if(E("info","설정 저장 시작"),e!=null&&e.saveSettings)try{const f=await e.saveSettings();return E("info","설정 저장 완료",{result:f}),f}catch(f){throw E("error","설정 저장 실패",f),f}else return E("error","saveSettings 함수를 사용할 수 없음"),!1},[e==null?void 0:e.saveSettings]),d=g.useCallback(async()=>{if(E("info","설정 로드 시작"),e!=null&&e.loadSettings)try{const f=await e.loadSettings();return E("info","설정 로드 완료",{result:f}),f}catch(f){throw E("error","설정 로드 실패",f),f}else return E("error","loadSettings 함수를 사용할 수 없음"),!1},[e==null?void 0:e.loadSettings]),m=g.useCallback(async f=>{if(E("info","설정 리셋 시작",{sections:f}),e!=null&&e.resetSettings)try{const w=await e.resetSettings(f);return E("info","설정 리셋 완료",{result:w}),w}catch(w){return E("error","설정 리셋 실패",w),{success:!1,error:w.message}}else return E("error","resetSettings 함수를 사용할 수 없음"),{success:!1,error:"resetSettings 함수를 사용할 수 없습니다"}},[e==null?void 0:e.resetSettings]),h=g.useCallback((f,w=null)=>{var n;E("info","설정 업데이트 및 검증 시작",{newSettings:f,section:w});const i=w?{...o,[w]:{...o[w],...f[w]}}:{...o,...f},k=Xe(i,w);if(a(k),Object.keys(k).length>0){E("error","설정 유효성 검증 실패",k);const u=Object.values(k)[0];return(n=o.notificationSettings)!=null&&n.errorNotification&&Y.error(`설정 오류: ${u}`),!1}return x(f),E("info","설정 업데이트 완료"),!0},[o,x]),S=g.useCallback((f=null,w=null)=>{var i,k;E("info","설정 내보내기 시작",{filename:f,partial:w});try{const n={settings:w&&Object.keys(w).length>0?{...o,...w}:o,metadata:{exportedAt:new Date().toISOString(),version:"1.0.0",userId:(e==null?void 0:e.userId)||"default"}},u=JSON.stringify(n,null,2),p=new Blob([u],{type:"application/json"}),v=document.createElement("a");return v.href=URL.createObjectURL(p),v.download=f||`preference-settings-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(v.href),E("info","설정 내보내기 완료",{filename:v.download}),(i=o.notificationSettings)!=null&&i.enableToasts&&Y.success("설정이 파일로 내보내졌습니다"),!0}catch(n){return E("error","설정 내보내기 실패",n),(k=o.notificationSettings)!=null&&k.errorNotification&&Y.error("설정 내보내기 실패: "+n.message),!1}},[o,e==null?void 0:e.userId]),P=g.useCallback(f=>(E("info","설정 가져오기 시작",{filename:f.name}),new Promise((w,i)=>{const k=new FileReader;k.onload=n=>{var u,p;try{const v=JSON.parse(n.target.result);if(!v.settings)throw new Error("유효하지 않은 설정 파일입니다.");x(v.settings),E("info","설정 가져오기 완료",{filename:f.name}),(u=o.notificationSettings)!=null&&u.enableToasts&&Y.success("설정이 성공적으로 가져와졌습니다"),w(v)}catch(v){E("error","설정 가져오기 실패",v),(p=o.notificationSettings)!=null&&p.errorNotification&&Y.error("설정 가져오기 실패: "+v.message),i(v)}},k.onerror=()=>{const n=new Error("파일 읽기 실패");E("error","설정 가져오기 실패",n),i(n)},k.readAsText(f)})),[o,x]),N={settings:o,dashboardSettings:o.dashboardSettings||{},statisticsSettings:o.statisticsSettings||{},databaseSettings:o.databaseSettings||{},notificationSettings:o.notificationSettings||{},generalSettings:o.generalSettings||{},loading:(e==null?void 0:e.loading)||!1,saving:(e==null?void 0:e.saving)||!1,error:(e==null?void 0:e.error)||null,initialized:(e==null?void 0:e.initialized)||!1,updateSettings:x,updateSettingsWithValidation:h,saveSettings:c,loadSettings:d,exportSettings:S,importSettings:P,resetSettings:m,validationErrors:r,validateSettings:(f,w)=>Xe(f,w),logInfo:(f,w)=>E("info",f,w),logError:(f,w)=>E("error",f,w)};return E("debug","usePreference 훅 반환값 생성 완료"),N},ks=()=>{const s=g.useRef(!1);s.current||(E("debug","useDashboardSettings 훅 초기화"),s.current=!0);const{dashboardSettings:e,updateSettings:r,saving:a,error:o,validationErrors:x,logInfo:c}=dt(),d=g.useMemo(()=>{const S={selectedPegs:[],defaultNe:"",defaultCellId:"",autoRefreshInterval:0,chartStyle:"line",showLegend:!0,showGrid:!0},P={...S,...e};return Array.isArray(e==null?void 0:e.selectedPegs)&&e.selectedPegs.length>0?P.selectedPegs=e.selectedPegs:P.selectedPegs=S.selectedPegs,E("debug","Dashboard 설정 처리 완료",{settings:P}),P},[e]),m=g.useCallback(S=>(c("Dashboard 설정 업데이트",S),r({dashboardSettings:S})),[r,c]),h=g.useMemo(()=>Object.fromEntries(Object.entries(x).filter(([S])=>S.startsWith("dashboardSettings."))),[x]);return{settings:d,updateSettings:m,saving:a,error:o,validationErrors:h,hasErrors:Object.keys(h).length>0}};function Es(s=[]){const e=s.filter(c=>c.active),r=[],a=new Set,o=new Set;function x(c){if(o.has(c.id))throw new Error(`Circular dependency detected: ${c.name}`);if(a.has(c.id))return;o.add(c.id);const d=c.derivedDependencies||[];for(const m of d){const h=e.find(S=>S.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()===m);h&&x(h)}o.delete(c.id),a.add(c.id),r.push(c)}for(const c of e)a.has(c.id)||x(c);return r}function _s(s,e={},r=4){try{let a=s;const o=Object.keys(e).sort((d,m)=>m.length-d.length);for(const d of o){const m=e[d];if(typeof m=="number"&&!isNaN(m)){const h=d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),S=new RegExp(`\\$\\{${h}\\}`,"g");a=a.replace(S,m.toString())}}const x=Object.keys(e).filter(d=>/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(d)).sort((d,m)=>m.length-d.length);for(const d of x){const m=e[d];if(typeof m=="number"&&!isNaN(m)){const h=new RegExp(`\\b${d}\\b`,"g");a=a.replace(h,m.toString())}}a=a.replace(/sqrt\(([^)]+)\)/g,"Math.sqrt($1)"),a=a.replace(/log\(([^)]+)\)/g,"Math.log($1)"),a=a.replace(/abs\(([^)]+)\)/g,"Math.abs($1)"),a=a.replace(/min\(([^)]+)\)/g,"Math.min($1)"),a=a.replace(/max\(([^)]+)\)/g,"Math.max($1)"),a=a.replace(/\^/g,"**");const c=Function(`"use strict"; return (${a})`)();return typeof c=="number"&&!isNaN(c)?Number(c.toFixed(r)):null}catch(a){return console.error("Derived PEG 수식 평가 오류:",a,"Formula:",s),null}}function Ds(s=[],e={},r=4){try{const a=Es(s),o={},x={...e};for(const c of a){const d=c.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),m=_s(c.formula,x,r);m!==null&&(o[d]=m,x[d]=m,x[c.name]=m)}return o}catch(a){return console.error("Derived PEG 일괄 계산 오류:",a),{}}}function qs(s=[]){return s.map(e=>({value:e.value,label:e.label,type:e.type,color:e.type==="derived"?"#3b82f6":"#6b7280",isDerived:e.type==="derived",description:e.description,formula:e.formula}))}const Ts=(s,e,r=null)=>{const o=`[DashboardHeader:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${o} ${e}`,r);break;case"error":console.error(`${o} ${e}`,r);break;case"warn":console.warn(`${o} ${e}`,r);break;case"debug":console.debug(`${o} ${e}`,r);break;default:console.log(`${o} ${e}`,r)}},Qe=({loading:s,saving:e,settingsError:r,selectedPegs:a,chartStyle:o,enableTimeComparison:x,defaultNe:c,defaultCellId:d,lastRefresh:m,onManualRefresh:h})=>(Ts("debug","DashboardHeader 렌더링",{loading:s,saving:e,settingsError:r,selectedPegsCount:a==null?void 0:a.length,chartStyle:o,enableTimeComparison:x,defaultNe:c,defaultCellId:d,lastRefresh:m}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-3xl font-bold",children:"Dashboard"}),t.jsxs("p",{className:"text-muted-foreground",children:[(a==null?void 0:a.length)||0,"개 PEG 항목 • 차트 스타일: ",o,x&&" • Time1/Time2 비교 모드",c&&` • NE: ${c}`,d&&` • Cell: ${d}`]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[e&&t.jsxs(ie,{variant:"secondary",className:"text-xs",children:[t.jsx(ss,{className:"h-3 w-3 mr-1"}),"설정 저장 중"]}),r&&t.jsx(ie,{variant:"destructive",className:"text-xs",children:"설정 오류"}),x&&t.jsx(ie,{variant:"default",className:"text-xs bg-blue-100 text-blue-800",children:"Time1/Time2 비교"}),m&&t.jsxs(ie,{variant:"secondary",className:"text-xs",children:["마지막 업데이트: ",m.toLocaleTimeString()]}),t.jsxs(de,{variant:"outline",size:"sm",onClick:h,disabled:s,children:[t.jsx(ze,{className:`h-4 w-4 mr-2 ${s?"animate-spin":""}`}),"새로고침"]})]})]}));function ue({...s}){return t.jsx(Ft,{"data-slot":"select",...s})}function me({...s}){return t.jsx(Wt,{"data-slot":"select-value",...s})}function fe({className:s,size:e="default",children:r,...a}){return t.jsxs(Bt,{"data-slot":"select-trigger","data-size":e,className:G("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...a,children:[r,t.jsx(Vt,{asChild:!0,children:t.jsx(at,{className:"size-4 opacity-50"})})]})}function ge({className:s,children:e,position:r="popper",...a}){return t.jsx(Ht,{children:t.jsxs(Gt,{"data-slot":"select-content",className:G("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...a,children:[t.jsx(Cs,{}),t.jsx(qt,{className:G("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:e}),t.jsx(Ps,{})]})})}function z({className:s,children:e,...r}){return t.jsxs(Kt,{"data-slot":"select-item",className:G("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...r,children:[t.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:t.jsx(Jt,{children:t.jsx(ke,{className:"size-4"})})}),t.jsx(Zt,{children:e})]})}function Cs({className:s,...e}){return t.jsx(Yt,{"data-slot":"select-scroll-up-button",className:G("flex cursor-default items-center justify-center py-1",s),...e,children:t.jsx(rs,{className:"size-4"})})}function Ps({className:s,...e}){return t.jsx(Xt,{"data-slot":"select-scroll-down-button",className:G("flex cursor-default items-center justify-center py-1",s),...e,children:t.jsx(at,{className:"size-4"})})}function Os({className:s,...e}){return t.jsx(Qt,{"data-slot":"switch",className:G("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...e,children:t.jsx(es,{"data-slot":"switch-thumb",className:G("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}function J({className:s,...e}){return t.jsx(ts,{"data-slot":"label",className:G("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...e})}const As=(s,e,r=null)=>{const o=`[DashboardSettings:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${o} ${e}`,r);break;case"error":console.error(`${o} ${e}`,r);break;case"warn":console.warn(`${o} ${e}`,r);break;case"debug":console.debug(`${o} ${e}`,r);break;default:console.log(`${o} ${e}`,r)}},Ls=({defaultTimeRange:s,enableTimeComparison:e,tempTimeSettings:r,inputCompleted:a,loading:o,onUpdateDefaultTimeRange:x,onUpdateEnableTimeComparison:c,onUpdateTempTimeSetting:d,onApplyTime1Settings:m,onApplyTime2Settings:h,onToggleTime1Settings:S,onToggleTime2Settings:P,onManualRefresh:N})=>{var f,w,i,k,n,u,p,v;return As("debug","DashboardSettings 렌더링",{defaultTimeRange:s,enableTimeComparison:e,tempTimeSettings:r,inputCompleted:a,onToggleTime1Settings:!!S,onToggleTime2Settings:!!P,loading:o}),t.jsxs(Ee,{children:[t.jsx(ot,{children:t.jsxs(ct,{className:"flex items-center gap-2",children:[t.jsx(as,{className:"h-5 w-5"}),"기본시간 설정"]})}),t.jsxs(_e,{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(J,{htmlFor:"defaultTimeRange",className:"text-sm font-medium",children:"기본 시간 범위"}),t.jsxs(ue,{value:s.toString(),onValueChange:x,children:[t.jsx(fe,{children:t.jsx(me,{placeholder:"시간 범위 선택"})}),t.jsxs(ge,{children:[t.jsx(z,{value:"5",children:"5분"}),t.jsx(z,{value:"15",children:"15분"}),t.jsx(z,{value:"30",children:"30분"}),t.jsx(z,{value:"60",children:"1시간"}),t.jsx(z,{value:"120",children:"2시간"}),t.jsx(z,{value:"360",children:"6시간"}),t.jsx(z,{value:"720",children:"12시간"})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Os,{id:"enableTimeComparison",checked:e,onCheckedChange:c}),t.jsx(J,{htmlFor:"enableTimeComparison",className:"text-sm font-medium",children:"Time1/Time2 비교 활성화"})]}),e&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"text-sm font-medium text-blue-600",children:"Time1 설정"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{children:[t.jsx(J,{className:"text-xs text-muted-foreground",children:"시작 시간"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx(J,{htmlFor:"time1StartDate",className:"text-xs",children:"날짜"}),t.jsx("input",{type:"date",id:"time1StartDate",className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",value:r.time1Start?r.time1Start.split("T")[0]:"",onChange:b=>{const y=r.time1Start?r.time1Start.split("T")[1]:"00:00";d("time1","Start",`${b.target.value}T${y}`)}})]}),t.jsxs("div",{children:[t.jsx(J,{htmlFor:"time1StartHour",className:"text-xs",children:"시간"}),t.jsxs(ue,{value:r.time1Start&&((f=r.time1Start.split("T")[1])==null?void 0:f.split(":")[0])||"00",onValueChange:b=>{var M;const y=r.time1Start?r.time1Start.split("T")[0]:new Date().toISOString().split("T")[0],F=r.time1Start&&((M=r.time1Start.split("T")[1])==null?void 0:M.split(":")[1])||"00";d("time1","Start",`${y}T${b}:${F}`)},children:[t.jsx(fe,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(me,{})}),t.jsx(ge,{children:Array.from({length:24},(b,y)=>t.jsx(z,{value:y.toString().padStart(2,"0"),children:y.toString().padStart(2,"0")},y))})]})]}),t.jsxs("div",{children:[t.jsx(J,{htmlFor:"time1StartMinute",className:"text-xs",children:"분"}),t.jsxs(ue,{value:r.time1Start&&((w=r.time1Start.split("T")[1])==null?void 0:w.split(":")[1])||"00",onValueChange:b=>{var M;const y=r.time1Start?r.time1Start.split("T")[0]:new Date().toISOString().split("T")[0],F=r.time1Start&&((M=r.time1Start.split("T")[1])==null?void 0:M.split(":")[0])||"00";d("time1","Start",`${y}T${F}:${b}`)},children:[t.jsx(fe,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(me,{})}),t.jsxs(ge,{children:[t.jsx(z,{value:"00",children:"00"}),t.jsx(z,{value:"15",children:"15"}),t.jsx(z,{value:"30",children:"30"}),t.jsx(z,{value:"45",children:"45"})]})]})]})]})]}),t.jsxs("div",{children:[t.jsx(J,{className:"text-xs text-muted-foreground",children:"끝 시간"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx(J,{htmlFor:"time1EndDate",className:"text-xs",children:"날짜"}),t.jsx("input",{type:"date",id:"time1EndDate",className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",value:r.time1End?r.time1End.split("T")[0]:"",onChange:b=>{const y=r.time1End?r.time1End.split("T")[1]:"00:00";d("time1","End",`${b.target.value}T${y}`)}})]}),t.jsxs("div",{children:[t.jsx(J,{htmlFor:"time1EndHour",className:"text-xs",children:"시간"}),t.jsxs(ue,{value:r.time1End&&((i=r.time1End.split("T")[1])==null?void 0:i.split(":")[0])||"00",onValueChange:b=>{var M;const y=r.time1End?r.time1End.split("T")[0]:new Date().toISOString().split("T")[0],F=r.time1End&&((M=r.time1End.split("T")[1])==null?void 0:M.split(":")[1])||"00";d("time1","End",`${y}T${b}:${F}`)},children:[t.jsx(fe,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(me,{})}),t.jsx(ge,{children:Array.from({length:24},(b,y)=>t.jsx(z,{value:y.toString().padStart(2,"0"),children:y.toString().padStart(2,"0")},y))})]})]}),t.jsxs("div",{children:[t.jsx(J,{htmlFor:"time1EndMinute",className:"text-xs",children:"분"}),t.jsxs(ue,{value:r.time1End&&((k=r.time1End.split("T")[1])==null?void 0:k.split(":")[1])||"00",onValueChange:b=>{var M;const y=r.time1End?r.time1End.split("T")[0]:new Date().toISOString().split("T")[0],F=r.time1End&&((M=r.time1End.split("T")[1])==null?void 0:M.split(":")[0])||"00";d("time1","End",`${y}T${F}:${b}`)},children:[t.jsx(fe,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(me,{})}),t.jsxs(ge,{children:[t.jsx(z,{value:"00",children:"00"}),t.jsx(z,{value:"15",children:"15"}),t.jsx(z,{value:"30",children:"30"}),t.jsx(z,{value:"45",children:"45"})]})]})]})]})]}),t.jsx(de,{onClick:m,disabled:!r.time1Start||!r.time1End||a.time1,size:"sm",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:a.time1?t.jsxs(t.Fragment,{children:[t.jsx(ke,{className:"h-4 w-4 mr-2"}),"Time1 설정 완료"]}):"Time1 설정 입력"})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"text-sm font-medium text-green-600",children:"Time2 설정"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{children:[t.jsx(J,{className:"text-xs text-muted-foreground",children:"시작 시간"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx(J,{htmlFor:"time2StartDate",className:"text-xs",children:"날짜"}),t.jsx("input",{type:"date",id:"time2StartDate",className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",value:r.time2Start?r.time2Start.split("T")[0]:"",onChange:b=>{const y=r.time2Start?r.time2Start.split("T")[1]:"00:00";d("time2","Start",`${b.target.value}T${y}`)}})]}),t.jsxs("div",{children:[t.jsx(J,{htmlFor:"time2StartHour",className:"text-xs",children:"시간"}),t.jsxs(ue,{value:r.time2Start&&((n=r.time2Start.split("T")[1])==null?void 0:n.split(":")[0])||"00",onValueChange:b=>{var M;const y=r.time2Start?r.time2Start.split("T")[0]:new Date().toISOString().split("T")[0],F=r.time2Start&&((M=r.time2Start.split("T")[1])==null?void 0:M.split(":")[1])||"00";d("time2","Start",`${y}T${b}:${F}`)},children:[t.jsx(fe,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(me,{})}),t.jsx(ge,{children:Array.from({length:24},(b,y)=>t.jsx(z,{value:y.toString().padStart(2,"0"),children:y.toString().padStart(2,"0")},y))})]})]}),t.jsxs("div",{children:[t.jsx(J,{htmlFor:"time2StartMinute",className:"text-xs",children:"분"}),t.jsxs(ue,{value:r.time2Start&&((u=r.time2Start.split("T")[1])==null?void 0:u.split(":")[1])||"00",onValueChange:b=>{var M;const y=r.time2Start?r.time2Start.split("T")[0]:new Date().toISOString().split("T")[0],F=r.time2Start&&((M=r.time2Start.split("T")[1])==null?void 0:M.split(":")[0])||"00";d("time2","Start",`${y}T${F}:${b}`)},children:[t.jsx(fe,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(me,{})}),t.jsxs(ge,{children:[t.jsx(z,{value:"00",children:"00"}),t.jsx(z,{value:"15",children:"15"}),t.jsx(z,{value:"30",children:"30"}),t.jsx(z,{value:"45",children:"45"})]})]})]})]})]}),t.jsxs("div",{children:[t.jsx(J,{className:"text-xs text-muted-foreground",children:"끝 시간"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx(J,{htmlFor:"time2EndDate",className:"text-xs",children:"날짜"}),t.jsx("input",{type:"date",id:"time2EndDate",className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",value:r.time2End?r.time2End.split("T")[0]:"",onChange:b=>{const y=r.time2End?r.time2End.split("T")[1]:"00:00";d("time2","End",`${b.target.value}T${y}`)}})]}),t.jsxs("div",{children:[t.jsx(J,{htmlFor:"time2EndHour",className:"text-xs",children:"시간"}),t.jsxs(ue,{value:r.time2End&&((p=r.time2End.split("T")[1])==null?void 0:p.split(":")[0])||"00",onValueChange:b=>{var M;const y=r.time2End?r.time2End.split("T")[0]:new Date().toISOString().split("T")[0],F=r.time2End&&((M=r.time2End.split("T")[1])==null?void 0:M.split(":")[1])||"00";d("time2","End",`${y}T${b}:${F}`)},children:[t.jsx(fe,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(me,{})}),t.jsx(ge,{children:Array.from({length:24},(b,y)=>t.jsx(z,{value:y.toString().padStart(2,"0"),children:y.toString().padStart(2,"0")},y))})]})]}),t.jsxs("div",{children:[t.jsx(J,{htmlFor:"time2EndMinute",className:"text-xs",children:"분"}),t.jsxs(ue,{value:r.time2End&&((v=r.time2End.split("T")[1])==null?void 0:v.split(":")[1])||"00",onValueChange:b=>{var M;const y=r.time2End?r.time2End.split("T")[0]:new Date().toISOString().split("T")[0],F=r.time2End&&((M=r.time2End.split("T")[1])==null?void 0:M.split(":")[0])||"00";d("time2","End",`${y}T${F}:${b}`)},children:[t.jsx(fe,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(me,{})}),t.jsxs(ge,{children:[t.jsx(z,{value:"00",children:"00"}),t.jsx(z,{value:"15",children:"15"}),t.jsx(z,{value:"30",children:"30"}),t.jsx(z,{value:"45",children:"45"})]})]})]})]})]}),t.jsx(de,{onClick:h,disabled:!r.time2Start||!r.time2End||a.time2,size:"sm",className:"w-full bg-green-600 hover:bg-green-700 text-white",children:a.time2?t.jsxs(t.Fragment,{children:[t.jsx(ke,{className:"h-4 w-4 mr-2"}),"Time2 설정 완료"]}):"Time2 설정 입력"})]})]})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(de,{onClick:N,disabled:o||!a.time1||!a.time2,className:"bg-purple-600 hover:bg-purple-700 text-white",children:o?"데이터 로딩 중...":"Time1/Time2 비교 데이터 로드"})}),t.jsxs("div",{className:"flex justify-center gap-6 text-xs",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:`flex items-center gap-1 ${a.time1?"text-green-600":"text-gray-500"}`,children:[a.time1?t.jsx(ke,{className:"h-3 w-3"}):t.jsx(Ue,{className:"h-3 w-3"}),"Time1 설정 ",a.time1?"완료":"대기"]}),t.jsx(de,{variant:"outline",size:"sm",onClick:S,className:"h-6 px-2 text-xs",disabled:!S,children:a.time1?"수정":"완료"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:`flex items-center gap-1 ${a.time2?"text-green-600":"text-gray-500"}`,children:[a.time2?t.jsx(ke,{className:"h-3 w-3"}):t.jsx(Ue,{className:"h-3 w-3"}),"Time2 설정 ",a.time2?"완료":"대기"]}),t.jsx(de,{variant:"outline",size:"sm",onClick:P,className:"h-6 px-2 text-xs",disabled:!P,children:a.time2?"수정":"완료"})]})]})]}),!e&&t.jsx(de,{onClick:N,disabled:o,className:"w-full",children:o?"데이터 로딩 중...":"데이터 새로고침"})]})]})]})},he=(s,e,r=null)=>{const o=`[DashboardChart:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${o} ${e}`,r);break;case"error":console.error(`${o} ${e}`,r);break;case"warn":console.warn(`${o} ${e}`,r);break;case"debug":console.debug(`${o} ${e}`,r);break;default:console.log(`${o} ${e}`,r)}},pe=s=>{const e=["#8884d8","#82ca9d","#ffc658","#ff7300","#8dd1e1","#d084d0"];return s<e.length?e[s]:`hsl(${s*47%360}, 70%, 50%)`},ut=({chartData:s,chartKey:e,idx:r,chartStyle:a,showGrid:o,showLegend:x,enableTimeComparison:c,loading:d=!1,onRefresh:m,error:h=null})=>{const[S,P]=g.useState(!1),N=g.useCallback(async()=>{if(m){P(!0),he("info","차트별 새로고침 시작",{chartKey:e});try{await m(),he("info","차트별 새로고침 완료",{chartKey:e})}catch(n){he("error","차트별 새로고침 실패",{chartKey:e,error:n.message})}finally{P(!1)}}},[m,e]);if(he("debug","DashboardChart 렌더링",{chartKey:e,chartStyle:a,dataLength:s==null?void 0:s.length,loading:d,chartLoading:S,hasError:!!h,showGrid:o,showLegend:x,enableTimeComparison:c,chartHeight:c?"h-80":"h-64",xAxisHeight:c?120:60}),d||S)return t.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[t.jsx("div",{className:"animate-pulse",children:t.jsx(Fe,{className:"h-12 w-12 text-muted-foreground mb-2"})}),t.jsx("p",{className:"text-sm text-muted-foreground",children:S?"차트 새로고침 중...":"데이터 로딩 중..."}),t.jsxs("div",{className:"flex space-x-1 mt-2",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]});if(h)return t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-destructive",children:[t.jsx(ns,{className:"h-12 w-12 mb-2"}),t.jsx("p",{className:"text-sm font-medium mb-1",children:"차트 로드 오류"}),t.jsx("p",{className:"text-xs text-muted-foreground mb-3 text-center max-w-32",children:h.message||"데이터를 불러올 수 없습니다"}),m&&t.jsxs(de,{variant:"outline",size:"sm",onClick:N,disabled:S,className:"text-xs",children:[t.jsx(ze,{className:`h-3 w-3 mr-1 ${S?"animate-spin":""}`}),"다시 시도"]})]});if(!s||s.length===0)return he("warn","차트 데이터가 없음",{chartKey:e}),t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-muted-foreground",children:[t.jsx(Fe,{className:"h-12 w-12 mb-2 opacity-50"}),t.jsx("p",{className:"text-sm font-medium mb-1",children:"데이터가 없습니다"}),t.jsx("p",{className:"text-xs text-center max-w-32 mb-3",children:"선택한 조건에 맞는 데이터가 존재하지 않습니다"}),m&&t.jsxs(de,{variant:"outline",size:"sm",onClick:N,disabled:S,className:"text-xs",children:[t.jsx(ze,{className:`h-3 w-3 mr-1 ${S?"animate-spin":""}`}),"새로고침"]})]});const f=s.length>0?Array.from(new Set(s.flatMap(n=>Object.keys(n).filter(u=>u!=="time"&&u!=="_originalTime"&&u!=="_isTime2")))):[];he("debug","차트 엔티티 정보",{chartKey:e,entities:f,entitiesCount:f.length,hasTimeComparison:c,time1Entities:f.filter(n=>n.includes("_Time1")),time2Entities:f.filter(n=>n.includes("_Time2")),chartDataLength:s.length,time1DataPoints:s.filter(n=>!n._isTime2).length,time2DataPoints:s.filter(n=>n._isTime2).length,sampleChartData:s.slice(0,3).map(n=>({time:n.time,_isTime2:n._isTime2,entityKeys:Object.keys(n).filter(u=>!u.startsWith("_")),allKeys:Object.keys(n),sampleValues:Object.keys(n).filter(u=>!u.startsWith("_")).slice(0,3).map(u=>({key:u,value:n[u]}))})),time2DetailedInfo:c?{time2EntitiesFound:f.filter(n=>n.includes("_Time2")).length,time2DataPoints:s.filter(n=>n._isTime2),time2SampleValues:s.filter(n=>n._isTime2).slice(0,2).map(n=>({time:n.time,entities:Object.keys(n).filter(u=>!u.startsWith("_")),values:Object.keys(n).filter(u=>!u.startsWith("_")).reduce((u,p)=>(u[p]=n[p],u),{})}))}:null});const w={data:s,className:c?"h-80":"h-64"},i=(n,u)=>{if(!c)return n;try{if(typeof n=="string"&&n.includes(" ")){const[p,v]=n.split(" ");return v?v.substring(0,5):n}return n}catch(p){return he("warn","X축 틱 포맷팅 오류",{value:n,error:p.message}),n}},k=[o&&t.jsx(_t,{strokeDasharray:"3 3"},"grid"),t.jsx(Dt,{dataKey:"time",tickFormatter:c?i:void 0,angle:c?-45:0,textAnchor:c?"end":"middle",height:c?120:60,interval:c?"preserveStartEnd":0,tick:{fontSize:12}},"xaxis"),t.jsx(Tt,{},"yaxis"),t.jsx(Ct,{labelFormatter:n=>`시간: ${n}`,formatter:(n,u)=>{if(c){const p=u.replace("_Time1","").replace("_Time2",""),v=u.includes("_Time1")?"Time1":u.includes("_Time2")?"Time2":"";return[n,`${p} (${v})`]}return[n,u]}},"tooltip"),x&&t.jsx(Pt,{verticalAlign:"bottom",align:"center",layout:"horizontal",wrapperStyle:{paddingTop:"30px",paddingBottom:"10px",fontSize:"12px"},formatter:(n,u,p)=>{if(c){const v=n.replace("_Time1","").replace("_Time2",""),b=n.includes("_Time1")?"Time1":n.includes("_Time2")?"Time2":"";return`${v} (${b})`}return n}},"legend")].filter(Boolean);try{switch(he("info","차트 렌더링 시작",{chartKey:e,chartStyle:a,enableTimeComparison:c,entitiesCount:f.length,chartDataLength:s.length,time1DataPoints:s.filter(n=>!n._isTime2).length,time2DataPoints:s.filter(n=>n._isTime2).length,entities:f,time1Entities:f.filter(n=>n.includes("_Time1")),time2Entities:f.filter(n=>n.includes("_Time2")),firstDataPoint:s.length>0?{time:s[0].time,_isTime2:s[0]._isTime2,allKeys:Object.keys(s[0]),entityKeys:Object.keys(s[0]).filter(n=>!n.startsWith("_")),entityValues:Object.keys(s[0]).filter(n=>!n.startsWith("_")).reduce((n,u)=>(n[u]=s[0][u],n),{})}:null}),a){case"area":return t.jsx(Ae,{width:"100%",height:"100%",children:t.jsxs(Et,{...w,children:[k,f.map((n,u)=>{if(c&&n.includes("_Time")){const p=n.replace("_Time1","").replace("_Time2",""),v=n.includes("_Time1");return t.jsx(Ke,{type:"monotone",dataKey:n,stroke:pe((r+u)%12),fill:pe((r+u)%12),fillOpacity:.3,strokeWidth:2,strokeDasharray:v?void 0:"5 5",name:`${p}_${v?"Time1":"Time2"}`},n)}else return t.jsx(Ke,{type:"monotone",dataKey:n,stroke:pe((r+u)%12),fill:pe((r+u)%12),fillOpacity:.3,strokeWidth:2},n)})]})});case"bar":return t.jsx(Ae,{width:"100%",height:"100%",children:t.jsxs(kt,{...w,children:[k,f.map((n,u)=>{if(c&&n.includes("_Time")){const p=n.replace("_Time1","").replace("_Time2",""),v=n.includes("_Time1");return t.jsx(qe,{dataKey:n,fill:pe((r+u)%12),name:`${p}_${v?"Time1":"Time2"}`},n)}else return t.jsx(qe,{dataKey:n,fill:pe((r+u)%12)},n)})]})});case"line":default:return t.jsx(Ae,{width:"100%",height:"100%",children:t.jsxs(Nt,{...w,children:[k,f.map((n,u)=>{if(c&&n.includes("_Time")){const p=n.replace("_Time1","").replace("_Time2",""),v=n.includes("_Time1");return t.jsx(Ge,{type:"monotone",dataKey:n,stroke:pe((r+u)%12),strokeWidth:2,strokeDasharray:v?void 0:"5 5",name:`${p}_${v?"Time1":"Time2"}`},n)}else return t.jsx(Ge,{type:"monotone",dataKey:n,stroke:pe((r+u)%12),strokeWidth:2},n)})]})})}}catch(n){return he("error","차트 렌더링 오류",{key,error:n}),t.jsx("div",{className:"h-full flex items-center justify-center text-red-500",children:"차트 렌더링 오류"})}},Is=(s,e,r=null)=>{const o=`[DashboardCard:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${o} ${e}`,r);break;case"error":console.error(`${o} ${e}`,r);break;case"warn":console.warn(`${o} ${e}`,r);break;case"debug":console.debug(`${o} ${e}`,r);break;default:console.log(`${o} ${e}`,r)}},et=s=>s,tt=({chartKey:s,idx:e,title:r,chartData:a,chartStyle:o,chartLayout:x,enableTimeComparison:c,showGrid:d,showLegend:m,onZoom:h,loading:S=!1,onRefresh:P,error:N=null})=>{Is("debug","DashboardCard 렌더링",{chartKey:s,idx:e,title:r,chartStyle:o,chartLayout:x,dataLength:a==null?void 0:a.length,loading:S,hasError:!!N,enableTimeComparison:c,chartDataType:Array.isArray(a)?"array":typeof a,chartDataSample:(a==null?void 0:a.length)>0?{firstItem:{time:a[0].time,_isTime2:a[0]._isTime2,entityCount:Object.keys(a[0]).filter(i=>!i.startsWith("_")).length,entities:Object.keys(a[0]).filter(i=>!i.startsWith("_")),allKeys:Object.keys(a[0])},totalItems:a.length,time1DataPoints:a.filter(i=>!i._isTime2).length,time2DataPoints:a.filter(i=>i._isTime2).length,time2SampleData:a.filter(i=>i._isTime2).slice(0,2).map(i=>({time:i.time,_isTime2:i._isTime2,entities:Object.keys(i).filter(k=>!k.startsWith("_")),sampleValues:Object.keys(i).filter(k=>!k.startsWith("_")).slice(0,3).map(k=>({key:k,value:i[k]}))}))}:null});const f=(a==null?void 0:a.length)>0?Array.from(new Set(a.flatMap(i=>Object.keys(i).filter(k=>k!=="time"&&k!=="_originalTime"&&k!=="_isTime2")))):[],w=`w-full ${N?"border-destructive":""} ${S?"opacity-75":""}`;return t.jsxs(Ee,{className:w,children:[t.jsx(ot,{children:t.jsxs(ct,{className:"flex items-center justify-between",children:[et(r),t.jsxs("div",{className:"flex items-center gap-2",children:[c&&t.jsx(ie,{variant:"default",className:"text-xs bg-blue-100 text-blue-800",children:"Time1/Time2 비교"}),t.jsxs(ie,{variant:"outline",className:"text-xs",children:[f.length,"개 시리즈"]}),t.jsxs(ie,{variant:"secondary",className:"text-xs",children:[(a==null?void 0:a.length)||0,"개 데이터포인트"]})]})]})}),t.jsx(_e,{children:t.jsx("div",{className:"h-64 cursor-zoom-in",onClick:()=>h({open:!0,title:et(r),data:a}),children:t.jsx(ut,{chartData:a,chartKey:s,idx:e,chartStyle:o,showGrid:d,showLegend:m,enableTimeComparison:c,loading:S,onRefresh:P,error:N})})})]},`${s}-${e}`)},C=(s,e,r=null)=>{const o=`[Dashboard:${new Date().toISOString()}]`;switch(s){case"info":console.log(`${o} ${e}`,r);break;case"error":console.error(`${o} ${e}`,r);break;case"warn":console.warn(`${o} ${e}`,r);break;case"debug":console.debug(`${o} ${e}`,r);break;default:console.log(`${o} ${e}`,r)}},Rs=()=>{const s=g.useRef(!1);s.current||(C("debug","Dashboard 컴포넌트 초기화"),s.current=!0);const[e,r]=g.useState({}),[a,o]=g.useState(null),[x,c]=g.useState(!1),[d,m]=g.useState(null),[h,S]=g.useState({open:!1,title:"",data:[]}),[P,N]=g.useState({time1Start:"",time1End:"",time2Start:"",time2End:""}),[f,w]=g.useState({time1:!1,time2:!1}),{settings:i={},saving:k=!1,error:n=null,updateSettings:u=()=>{}}=ks(),{settings:p={}}=dt(),v=(p==null?void 0:p.derivedPegSettings)||{},b=g.useMemo(()=>Array.isArray(i==null?void 0:i.selectedPegs)?i.selectedPegs:[],[i==null?void 0:i.selectedPegs]),y=g.useMemo(()=>(p==null?void 0:p.statisticsSettings)||{},[p==null?void 0:p.statisticsSettings]),F=g.useMemo(()=>Array.isArray(y.selectedNEs)?y.selectedNEs:[],[y.selectedNEs]),M=g.useMemo(()=>Array.isArray(y.selectedCellIds)?y.selectedCellIds:[],[y.selectedCellIds]),xe=g.useMemo(()=>(i==null?void 0:i.chartStyle)||"line",[i==null?void 0:i.chartStyle]),A=g.useMemo(()=>(i==null?void 0:i.chartLayout)||"byPeg",[i==null?void 0:i.chartLayout]),_=g.useMemo(()=>(i==null?void 0:i.showLegend)!==!1,[i==null?void 0:i.showLegend]),V=g.useMemo(()=>(i==null?void 0:i.showGrid)!==!1,[i==null?void 0:i.showGrid]),le=g.useMemo(()=>(i==null?void 0:i.defaultNe)||"",[i==null?void 0:i.defaultNe]),oe=g.useMemo(()=>(i==null?void 0:i.defaultCellId)||"",[i==null?void 0:i.defaultCellId]),mt=g.useMemo(()=>(i==null?void 0:i.defaultTimeRange)||30,[i==null?void 0:i.defaultTimeRange]),ee=g.useMemo(()=>(i==null?void 0:i.time1Start)||"",[i==null?void 0:i.time1Start]),X=g.useMemo(()=>(i==null?void 0:i.time1End)||"",[i==null?void 0:i.time1End]),Q=g.useMemo(()=>(i==null?void 0:i.time2Start)||"",[i==null?void 0:i.time2Start]),te=g.useMemo(()=>(i==null?void 0:i.time2End)||"",[i==null?void 0:i.time2End]),q=g.useMemo(()=>(i==null?void 0:i.enableTimeComparison)||!1,[i==null?void 0:i.enableTimeComparison]),ft=g.useCallback(j=>{C("info","기본시간범위 업데이트",{value:j}),u({defaultTimeRange:parseInt(j)})},[u]),gt=g.useCallback(j=>{C("info","토글 상태 변경",{checked:j}),u({enableTimeComparison:j})},[u]),ht=g.useCallback((j,B,I)=>{C("debug","임시 시간 설정 업데이트",{type:j,field:B,value:I}),N(O=>({...O,[`${j}${B}`]:I}))},[]),xt=g.useCallback(()=>{P.time1Start&&P.time1End&&(C("info","Time1 설정 적용",{start:P.time1Start,end:P.time1End}),u({time1Start:P.time1Start,time1End:P.time1End}),w(j=>({...j,time1:!0})))},[P.time1Start,P.time1End,u]),pt=g.useCallback(()=>{P.time2Start&&P.time2End&&(C("info","Time2 설정 적용",{start:P.time2Start,end:P.time2End}),u({time2Start:P.time2Start,time2End:P.time2End}),w(j=>({...j,time2:!0})))},[P.time2Start,P.time2End,u]),bt=g.useCallback(()=>{C("info","Time1 설정 토글",{currentState:f.time1,newState:!f.time1}),f.time1&&N(j=>({...j,time1Start:ee,time1End:X})),w(j=>({...j,time1:!j.time1}))},[f.time1,ee,X]),yt=g.useCallback(()=>{C("info","Time2 설정 토글",{currentState:f.time2,newState:!f.time2}),f.time2&&N(j=>({...j,time2Start:Q,time2End:te})),w(j=>({...j,time2:!j.time2}))},[f.time2,Q,te]),Pe=g.useCallback(async()=>{var O,ae,R,K;C("info","데이터 fetching 시작");const j=b.length>0?b:["randomaccessproblem"],B=F.length>0?F:["NVGNB#101086"],I=M.length>0?M.map(U=>parseInt(U)):[8418];if(C("debug","데이터 fetching 파라미터",{selectedPegs:b,safeSelectedPegs:j,selectedNEs:F,safeSelectedNEs:B,selectedCellIds:M,safeSelectedCellIds:I,defaultNe:le,defaultCellId:oe,enableTimeComparison:q,time1Start:ee,time1End:X,time2Start:Q,time2End:te}),j.length===0){C("warn","선택된 PEG가 없음 - 데이터 fetching 중단"),r({}),o(null),c(!1);return}try{if(c(!0),q&&ee&&X&&Q&&te){C("info","Time1/Time2 비교 모드로 데이터 fetching");const U={start_date:ee,end_date:X,kpi_types:j,ne:B,cellid:I};C("info","Time1 API 파라미터 상세",{...U,time1StartParsed:new Date(ee).toISOString(),time1EndParsed:new Date(X).toISOString(),time1DurationMinutes:`${Math.abs(new Date(X)-new Date(ee))/(1e3*60)}분`,safeSelectedPegs:j,safeSelectedNEs:B,safeSelectedCellIds:I});const $=await re.post("/api/kpi/query",U),L={start_date:Q,end_date:te,kpi_types:j,ne:B,cellid:I};C("info","Time2 API 파라미터 상세",{...L,time2StartParsed:new Date(Q).toISOString(),time2EndParsed:new Date(te).toISOString(),time2DurationMinutes:`${Math.abs(new Date(te)-new Date(Q))/(1e3*60)}분`,timeComparison:{time1Start:ee,time1End:X,time2Start:Q,time2End:te,time1Duration:`${Math.abs(new Date(X)-new Date(ee))/(1e3*60)}분`,time2Duration:`${Math.abs(new Date(te)-new Date(Q))/(1e3*60)}분`,timeOverlap:new Date(X)>new Date(Q)?"시간대 겹침":"시간대 분리"}}),C("debug","설정된 시간 범위",{time1Start:ee,time1End:X,time2Start:Q,time2End:te,time1Duration:`${Math.abs(new Date(X)-new Date(ee))/(1e3*60)}분`,time2Duration:`${Math.abs(new Date(te)-new Date(Q))/(1e3*60)}분`}),C("info","Time2 API 호출 전 파라미터",L);const T=await re.post("/api/kpi/query",L);C("info","Time2 API 호출 후 응답 상태",{status:T==null?void 0:T.status,statusText:T==null?void 0:T.statusText,hasData:!!(T!=null&&T.data),dataKeys:T!=null&&T.data?Object.keys(T.data):[]});let W=((O=$==null?void 0:$.data)==null?void 0:O.data)||{},H=((ae=T==null?void 0:T.data)==null?void 0:ae.data)||{};const je=(Z,se)=>{if(!v.formulas||v.formulas.length===0)return Z;const ce=j.filter(Ce=>v.formulas.some(ve=>ve.active&&ve.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()===Ce));if(ce.length===0)return Z;console.log(`[Dashboard] ${se} Derived PEG 계산 시작`,{activeDerivedPegs:ce,availableBaseData:Object.keys(Z)});const Ne={},Oe=Object.keys(Z)[0];Oe&&Z[Oe]&&Z[Oe].forEach((Ce,ve)=>{var He;const vt=Ce.timestamp,Ve=Ce.entity_id,We={};Object.keys(Z).forEach(we=>{const Se=Z[we];Se&&Se[ve]&&Se[ve].entity_id===Ve&&(We[we]=Se[ve].value)});const wt=Ds(v.formulas,We,((He=v.settings)==null?void 0:He.evaluationPrecision)||4);Object.entries(wt).forEach(([we,Se])=>{Ne[we]||(Ne[we]=[]),Ne[we].push({timestamp:vt,entity_id:Ve,value:Se})})});const Be={...Z,...Ne};return console.log(`[Dashboard] ${se} Derived PEG 계산 완료`,{addedDerivedPegs:Object.keys(Ne),totalKpiCount:Object.keys(Be).length}),Be};W=je(W,"Time1"),H=je(H,"Time2");const ye=j[0]||"randomaccessproblem",ne=H[ye];C("info","Time2 데이터 상세 분석",{time2ResponseStatus:T==null?void 0:T.status,time2ResponseHasData:!!(T!=null&&T.data),time2ResponseDataKeys:T!=null&&T.data?Object.keys(T.data):[],time2RawDataKeys:Object.keys(H),time2DataStructure:Object.keys(H).reduce((Z,se)=>{const ce=H[se];return Z[se]={type:Array.isArray(ce)?"array":typeof ce,length:Array.isArray(ce)?ce.length:"N/A",sample:Array.isArray(ce)&&ce.length>0?ce.slice(0,1):null},Z},{}),targetKpiKey:ye,targetKpiInTime2Data:H.hasOwnProperty(ye),targetKpiDataLength:Array.isArray(ne)?ne.length:"N/A",targetKpiDataSample:Array.isArray(ne)&&ne.length>0?ne.slice(0,3):[],comparison:{time1DataLength:Array.isArray(W[ye])?W[ye].length:"N/A",time2DataLength:Array.isArray(ne)?ne.length:"N/A",difference:(Array.isArray(W[ye])?W[ye].length:0)-(Array.isArray(ne)?ne.length:0)}}),Array.isArray(ne)&&ne.length<=1&&C("warn","Time2 데이터가 1개 이하입니다 - 상세 분석",{time2Params:L,time2KpiData:ne,time2FullResponse:T==null?void 0:T.data,possibleIssues:["Time2 기간에 실제 데이터가 부족함","API 파라미터가 잘못됨","데이터베이스에 해당 시간대의 데이터가 없음","API 응답 구조가 예상과 다름"]}),r(W),o(H),C("debug","데이터 저장 후 상태",{kpiDataKeys:Object.keys(W),time2DataKeys:Object.keys(H),time2DataSample:Object.keys(H).length>0?{firstKey:Object.keys(H)[0],firstKeyDataLength:((R=H[Object.keys(H)[0]])==null?void 0:R.length)||0}:null}),C("info","Time1/Time2 데이터 fetching 완료",{time1KpiCount:Object.keys(W).length,time1TotalRows:Object.values(W).reduce((Z,se)=>Z+((se==null?void 0:se.length)||0),0),time2KpiCount:Object.keys(H).length,time2TotalRows:Object.values(H).reduce((Z,se)=>Z+((se==null?void 0:se.length)||0),0),time1DataKeys:Object.keys(W),time2DataKeys:Object.keys(H)})}else{C("info","일반 모드로 데이터 fetching");const U=new Date,$=new Date(U.getTime()-((i==null?void 0:i.defaultHours)||1)*60*60*1e3),L={kpi_types:j,ne:B,cellid:I,start:$.toISOString(),end:U.toISOString()};C("debug","일반 모드 API 파라미터",L);const T=await re.post("/api/kpi/timeseries",L);let W=((K=T==null?void 0:T.data)==null?void 0:K.data)||{};W=calculateDerivedPegsForDataset(W,"일반 모드"),r(W),o(null),C("info","일반 모드 데이터 fetching 완료",{kpiCount:Object.keys(W).length,totalRows:Object.values(W).reduce((H,je)=>H+((je==null?void 0:je.length)||0),0),dataKeys:Object.keys(W)})}m(new Date)}catch(U){C("error","데이터 fetching 오류",U),r({}),o(null)}finally{c(!1)}},[b,F,M,i==null?void 0:i.defaultHours,le,oe,q,ee,X,Q,te]);g.useEffect(()=>{const j=setTimeout(()=>{C("info","설정 변경으로 인한 데이터 로드 시작"),Pe()},500);return()=>clearTimeout(j)},[b,F,M,i==null?void 0:i.defaultHours,le,oe,q,ee,X,Q,te]);const $e=g.useCallback(()=>{C("info","수동 새로고침 실행"),Pe()},[Pe]),jt=g.useCallback(j=>{C("debug","차트 데이터 구성",{kpiKey:j,chartLayout:A});const B=Array.isArray(e[j])?e[j]:[],I=q&&a?Array.isArray(a[j])?a[j]:[]:[];if(q&&C("debug","buildChartDataByLayout - Time2 데이터 분석",{kpiKey:j,enableTimeComparison:q,time2DataExists:!!a,time2DataType:typeof a,time2DataKeys:a?Object.keys(a):[],kpiKeyInTime2Data:a?a.hasOwnProperty(j):!1,time2DataForKpiKey:a==null?void 0:a[j],time2DataForKpiKeyType:typeof(a==null?void 0:a[j]),time2DataForKpiKeyIsArray:Array.isArray(a==null?void 0:a[j]),time2RowsLength:I.length,time2RowsSample:I.length>0?I.slice(0,2).map(O=>({entity_id:O.entity_id,timestamp:O.timestamp,value:O.value,hasTimestamp:!!O.timestamp,hasEntityId:!!O.entity_id,hasValue:O.hasOwnProperty("value")})):[]}),C("debug","차트 데이터 구성 - 데이터 상태 확인",{kpiKey:j,kpiDataExists:!!e,time2DataExists:!!a,kpiDataKeys:Object.keys(e||{}),time2DataKeys:Object.keys(a||{}),kpiDataHasKey:!!(e&&e[j]),time2DataHasKey:!!(a&&a[j]),flatRowsLength:B.length,time2RowsLength:I.length}),B.length===0&&I.length===0)return C("warn","차트 데이터 없음 - 데이터 구성 실패",{kpiKey:j,flatRowsLength:B.length,time2RowsLength:I.length}),[];if(A==="byPeg"){const O={};let ae=0;C("debug","차트 데이터 구성 시작",{kpiKey:j,time1RowsCount:B.length,time2RowsCount:I.length,enableTimeComparison:q,time2DataKeys:Object.keys(a||{}),time2DataHasKpiKey:!!(a&&a[j])}),B.forEach($=>{const L=new Date($.timestamp),T=`T1_${ae++}_${L.getTime()}`,W=L.toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/\./g,"/").replace(" "," ");O[T]||(O[T]={time:W,_originalTime:L});const H=q?`${$.entity_id}_Time1`:$.entity_id;O[T][H]=$.value}),q&&I.length>0?(C("debug","Time2 데이터 처리 시작",{time2RowsCount:I.length,time2RowsSample:I.slice(0,2).map($=>({entity_id:$.entity_id,timestamp:$.timestamp,value:$.value}))}),I.forEach($=>{const L=new Date($.timestamp),T=`T2_${ae++}_${L.getTime()}`,W=L.toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/\./g,"/").replace(" "," ");O[T]||(O[T]={time:W,_originalTime:L,_isTime2:!0});const H=`${$.entity_id}_Time2`;O[T][H]=$.value}),C("debug","Time2 데이터 처리 완료",{processedTime2Rows:I.length,groupedByTimeKeys:Object.keys(O).length,time2KeysInGrouped:Object.keys(O).filter($=>$.startsWith("T2_")).length})):C("debug","Time2 데이터 처리 건너뜀",{enableTimeComparison:q,time2RowsLength:I.length,reason:q?"Time2 데이터 없음":"비교 모드 비활성화"});const R=Object.values(O).sort(($,L)=>$._originalTime.getTime()-L._originalTime.getTime()),K=R.filter($=>!$._isTime2),U=R.filter($=>$._isTime2);return C("info","Time1/Time2 데이터 구성 완료",{kpiKey:j,time1Count:B.length,time2Count:I.length,totalDataPoints:R.length,time1DataPointsCount:K.length,time2DataPointsCount:U.length,timeRange:R.length>0?{first:R[0].time,last:R[R.length-1].time}:null,sampleDataPoints:R.slice(0,3).map($=>({time:$.time,_isTime2:$._isTime2,entityCount:Object.keys($).filter(L=>!L.startsWith("_")).length,entities:Object.keys($).filter(L=>!L.startsWith("_")),allKeys:Object.keys($)})),time1Entities:B.length>0?Object.keys(B[0]).filter($=>$!=="timestamp"):[],time2Entities:I.length>0?Object.keys(I[0]).filter($=>$!=="timestamp"):[],time2EntityKeys:U.length>0?Object.keys(U[0]).filter($=>!$.startsWith("_")):[],time2SampleData:U.slice(0,2).map($=>({time:$.time,_isTime2:$._isTime2,entities:Object.keys($).filter(L=>!L.startsWith("_")),sampleValues:Object.keys($).filter(L=>!L.startsWith("_")).slice(0,3).map(L=>({key:L,value:$[L]}))}))}),C("debug","buildChartDataByLayout 최종 반환 데이터",{kpiKey:j,returnedDataLength:R.length,totalTime1Data:R.filter($=>!$._isTime2).length,totalTime2Data:R.filter($=>$._isTime2).length,returnedData:R.slice(0,3).map($=>({time:$.time,_isTime2:$._isTime2,entityCount:Object.keys($).filter(L=>!L.startsWith("_")).length,entities:Object.keys($).filter(L=>!L.startsWith("_")),sampleValues:Object.keys($).filter(L=>!L.startsWith("_")).slice(0,2).map(L=>({key:L,value:$[L]}))}))}),R}else{const O={};B.forEach(R=>{const K=new Date(R.timestamp).toLocaleString(),U=R.entity_id;O[U]=O[U]||{},O[U][K]=O[U][K]||{time:K},O[U][K][R.peg_name]=R.value}),q&&I.forEach(R=>{const K=new Date(R.timestamp).toLocaleString()+" (T2)",U=R.entity_id;O[U]=O[U]||{},O[U][K]=O[U][K]||{time:K},O[U][K][R.peg_name+"_Time2"]=R.value});const ae={};return Object.keys(O).forEach(R=>{ae[R]=Object.values(O[R]).sort((K,U)=>new Date(K.time.replace(" (T2)",""))-new Date(U.time.replace(" (T2)","")))}),ae}},[e,a,q,A]);return x?(C("debug","로딩 상태 렌더링"),t.jsxs("div",{className:"space-y-6",children:[t.jsx(Qe,{loading:x,saving:k,settingsError:n,selectedPegs:b,chartStyle:xe,enableTimeComparison:q,defaultNe:le,defaultCellId:oe,lastRefresh:d,onManualRefresh:$e}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:b.map(j=>t.jsx(Ee,{children:t.jsx(_e,{className:"pt-6",children:t.jsx("div",{className:"h-64 flex items-center justify-center",children:t.jsx("div",{className:"text-muted-foreground",children:"Loading..."})})})},j))})]})):(C("debug","Dashboard 메인 렌더링"),t.jsxs("div",{className:"space-y-6",children:[t.jsx(Ls,{defaultTimeRange:mt,enableTimeComparison:q,tempTimeSettings:P,inputCompleted:f,loading:x,onUpdateDefaultTimeRange:ft,onUpdateEnableTimeComparison:gt,onUpdateTempTimeSetting:ht,onApplyTime1Settings:xt,onApplyTime2Settings:pt,onToggleTime1Settings:bt,onToggleTime2Settings:yt,onManualRefresh:$e}),t.jsx(Qe,{loading:x,saving:k,settingsError:n,selectedPegs:b,chartStyle:xe,enableTimeComparison:q,defaultNe:le,defaultCellId:oe,lastRefresh:d,onManualRefresh:$e}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs(ie,{variant:"default",children:["선택된 PEG: ",b.join(", ")]}),q&&t.jsx(ie,{variant:"default",className:"bg-blue-100 text-blue-800",children:"Time1/Time2 비교 활성화"}),t.jsxs(ie,{variant:"outline",children:["차트 스타일: ",xe]}),!_&&t.jsx(ie,{variant:"secondary",children:"범례 숨김"}),!V&&t.jsx(ie,{variant:"secondary",children:"격자 숨김"})]}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:b.map((j,B)=>{C("debug","차트 렌더링 시작",{key:j,idx:B,selectedPegs:b,totalSelectedPegs:b.length});const I=jt(j);if(A==="byPeg"){const O=Array.isArray(I)?I:[];return C("debug","차트 데이터 생성 결과",{key:j,chartDataLength:O.length,builtType:Array.isArray(I)?"array":typeof I}),t.jsx(tt,{chartKey:j,idx:B,title:j,chartData:O,chartStyle:xe,chartLayout:A,enableTimeComparison:q,showGrid:V,showLegend:_,onZoom:S,loading:x,onRefresh:$e,error:null},`${j}-${B}`)}else{const O=I||{};return Object.keys(O).map((ae,R)=>{const K=O[ae];return t.jsx(tt,{idx:B+R,title:ae,chartData:K,chartStyle:xe,chartLayout:A,enableTimeComparison:q,showGrid:V,showLegend:_,onZoom:S,loading:x,onRefresh:$e,error:null},`${j}-${ae}-${R}`)})}})}),t.jsx(js,{open:h.open,onOpenChange:j=>S(B=>({...B,open:j})),children:t.jsxs(Ss,{className:"max-w-6xl",children:[t.jsx($s,{children:t.jsx(Ns,{children:h.title})}),t.jsx("div",{className:"h-[480px]",children:Array.isArray(h.data)&&h.data.length>0&&t.jsx(ut,{chartData:h.data,idx:0,chartStyle:xe,showGrid:V,showLegend:_,enableTimeComparison:q,loading:!1,onRefresh:null,error:null},"zoom")})]})}),b.length===0&&t.jsx(Ee,{children:t.jsx(_e,{className:"pt-6",children:t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Je,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"표시할 PEG가 선택되지 않았습니다"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Preference 메뉴에서 표시할 PEG 항목을 선택하세요."}),t.jsxs(de,{variant:"outline",onClick:()=>{console.log("Navigate to Preference menu")},children:[t.jsx(Je,{className:"h-4 w-4 mr-2"}),"Preference 설정"]})]})})}),x&&b.length>0&&t.jsx(Ee,{children:t.jsx(_e,{className:"pt-6",children:t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"animate-pulse",children:t.jsx(Fe,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"})}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"데이터 로딩 중..."}),t.jsx("p",{className:"text-muted-foreground",children:"선택한 PEG의 데이터를 불러오고 있습니다."}),t.jsxs("div",{className:"flex justify-center space-x-1 mt-4",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})})]}))},Ks=Object.freeze(Object.defineProperty({__proto__:null,default:Rs},Symbol.toStringTag,{value:"Module"}));export{ie as B,Ee as C,js as D,J as L,Vs as P,Os as S,ot as a,ct as b,G as c,Ws as d,_e as e,de as f,ue as g,fe as h,me as i,ge as j,z as k,bs as l,ks as m,re as n,qs as o,is as p,Hs as q,Ss as r,$s as s,Ns as t,dt as u,Gs as v,Bs as w,Ks as x};
