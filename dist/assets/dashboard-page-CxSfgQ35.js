import{r as d,P as it,O as J,N as t}from"./vendor-Cw6wx6N3.js";import{c as je,B as re,a as le,C as we,b as Ge,d as Ke,e as Se,L as q,S as oe,f as ce,g as ue,h as de,i as F}from"./common-components-BsYW0TmQ.js";import{x as lt,y as ot,z as ct,A as ut,B as dt,O as mt,D as ft,E as gt}from"./ui-vendor-FYf9CHse.js";import{X as De,f as ht,R as Pe,c as xt,a as ke,g as Le,d as yt,S as Re}from"./icon-vendor-1p3lj7wq.js";import{R as Ee,l as bt,d as Ie,B as jt,a as Me,A as pt,k as Ue,C as wt,X as St,Y as vt,T as $t,L as kt}from"./chart-vendor-C0DB73VJ.js";const l=(r,e,s=null)=>{const o=`[PreferenceUtils] ${new Date().toISOString()}`;switch(r){case"info":console.log(`${o} ℹ️ ${e}`,s);break;case"warn":console.warn(`${o} ⚠️ ${e}`,s);break;case"error":console.error(`${o} ❌ ${e}`,s);break;default:console.log(`${o} ${e}`,s)}},Nt=()=>{try{if(l("info","런타임 설정 접근 시도"),typeof window<"u"&&window.__RUNTIME_CONFIG__){const r=window.__RUNTIME_CONFIG__;return l("info","런타임 설정 로드 성공",r),r}return l("warn","런타임 설정이 없음 - 기본값 사용"),{}}catch(r){return l("error","런타임 설정 접근 실패",r.message),{}}},qe=()=>{l("info","기본 설정값 생성 시작");const r=Nt(),e={dashboardSettings:{selectedPegs:[],defaultNe:"",defaultCellId:"",autoRefreshInterval:30,chartStyle:"line",showLegend:!0,showGrid:!0,theme:"light",defaultTimeRange:30,timeUnit:"minutes",time1Start:null,time1End:null,time2Start:null,time2End:null,enableTimeComparison:!1},statisticsSettings:{defaultDateRange:7,comparisonEnabled:!0,showDelta:!0,showRsd:!0,defaultPegs:["availability","rrc"],chartType:"bar",decimalPlaces:2,autoAnalysis:!1},databaseSettings:{host:r.DB_HOST||"postgres",port:parseInt(r.DB_PORT,10)||5432,user:r.DB_USER||"postgres",password:r.DB_PASSWORD||"postgres",dbname:r.DB_NAME||"netperf",table:"summary"},notificationSettings:{enableToasts:!0,enableSounds:!1,saveNotification:!0,errorNotification:!0},generalSettings:{language:"ko",timezone:"Asia/Seoul",dateFormat:"YYYY-MM-DD",numberFormat:"comma"},pegConfigurations:[],statisticsConfigurations:[]};return l("info","기본 설정값 생성 완료",{sections:Object.keys(e),runtimeConfigKeys:Object.keys(r)}),e},Te={dashboardSettings:{selectedPegs:{required:!1,type:"array",message:"selectedPegs는 배열이어야 합니다."},autoRefreshInterval:{required:!1,type:"number",min:5,max:300,message:"자동 새로고침 간격은 5초~300초 사이여야 합니다."},defaultNe:{type:"string",maxLength:50,message:"NE ID는 50자를 초과할 수 없습니다."},defaultCellId:{type:"string",maxLength:50,message:"Cell ID는 50자를 초과할 수 없습니다."}},statisticsSettings:{defaultDateRange:{required:!1,type:"number",min:1,max:365,message:"기본 날짜 범위는 1일~365일 사이여야 합니다."},decimalPlaces:{required:!1,type:"number",min:0,max:6,message:"소수점 자릿수는 0~6자리 사이여야 합니다."},defaultPegs:{required:!1,type:"array",message:"defaultPegs는 배열이어야 합니다."}}},Et=(r,e=null)=>{l("info","설정 유효성 검증 시작",{section:e,hasSettings:!!r});const s={};if(!r||typeof r!="object")return l("error","설정 객체가 유효하지 않음"),{general:"설정 객체가 유효하지 않습니다."};if(e&&!Te[e])return l("warn","지정된 섹션에 대한 검증 규칙이 없음",e),s;const a=e?{[e]:Te[e]}:Te;Object.entries(a).forEach(([p,x])=>{if(!r[p]){l("info","섹션이 없음 - 검증 스킵",p);return}Object.entries(x).forEach(([m,g])=>{const f=r[p][m],v=`${p}.${m}`;if(g.required&&(f==null||f==="")){s[v]=g.message||`${m}는 필수 항목입니다.`,l("warn","필수 필드 누락",{fieldPath:v,value:f});return}if(f==null||f===""){l("info","필드 값이 없음 - 검증 스킵",v);return}if(g.type==="array"&&!Array.isArray(f)){s[v]=g.message||`${m}는 배열이어야 합니다.`,l("warn","타입 검증 실패 - 배열이 아님",{fieldPath:v,value:f,expectedType:"array"});return}if(g.type==="number"&&typeof f!="number"){s[v]=g.message||`${m}는 숫자여야 합니다.`,l("warn","타입 검증 실패 - 숫자가 아님",{fieldPath:v,value:f,expectedType:"number"});return}if(g.type==="string"&&typeof f!="string"){s[v]=g.message||`${m}는 문자열이어야 합니다.`,l("warn","타입 검증 실패 - 문자열이 아님",{fieldPath:v,value:f,expectedType:"string"});return}if(g.type==="number"){if(g.min!==void 0&&f<g.min){s[v]=g.message||`${m}는 ${g.min} 이상이어야 합니다.`,l("warn","숫자 범위 검증 실패 - 최소값 미달",{fieldPath:v,value:f,min:g.min});return}if(g.max!==void 0&&f>g.max){s[v]=g.message||`${m}는 ${g.max} 이하여야 합니다.`,l("warn","숫자 범위 검증 실패 - 최대값 초과",{fieldPath:v,value:f,max:g.max});return}}if(g.type==="array"){if(g.minLength!==void 0&&f.length<g.minLength){s[v]=g.message||`${m}는 최소 ${g.minLength}개 항목이 필요합니다.`,l("warn","배열 길이 검증 실패 - 최소 길이 미달",{fieldPath:v,length:f.length,minLength:g.minLength});return}if(g.maxLength!==void 0&&f.length>g.maxLength){s[v]=g.message||`${m}는 최대 ${g.maxLength}개 항목만 허용됩니다.`,l("warn","배열 길이 검증 실패 - 최대 길이 초과",{fieldPath:v,length:f.length,maxLength:g.maxLength});return}}if(g.type==="string"){if(g.minLength!==void 0&&f.length<g.minLength){s[v]=g.message||`${m}는 최소 ${g.minLength}자 이상이어야 합니다.`,l("warn","문자열 길이 검증 실패 - 최소 길이 미달",{fieldPath:v,length:f.length,minLength:g.minLength});return}if(g.maxLength!==void 0&&f.length>g.maxLength){s[v]=g.message||`${m}는 최대 ${g.maxLength}자까지 허용됩니다.`,l("warn","문자열 길이 검증 실패 - 최대 길이 초과",{fieldPath:v,length:f.length,maxLength:g.maxLength});return}}})});const o=Object.keys(s).length;return l("info","설정 유효성 검증 완료",{errorCount:o,hasErrors:o>0,errorFields:Object.keys(s)}),s},Fe=(r,e)=>{if(l("info","설정 병합 시작",{hasSavedSettings:!!r,hasDefaultSettings:!!e}),!r)return l("info","저장된 설정이 없음 - 기본값 반환"),e;try{const s={...e};return Object.keys(e).forEach(a=>{r[a]&&typeof r[a]=="object"?(s[a]={...e[a],...r[a]},l("info","섹션 병합 완료",{section:a,mergedKeys:Object.keys(s[a])})):l("info","섹션이 없거나 객체가 아님 - 기본값 사용",{section:a})}),l("info","설정 병합 완료",{mergedSections:Object.keys(s),totalSections:Object.keys(e).length}),s}catch(s){return l("error","설정 병합 실패",s.message),e}},ve="kpi-dashboard-preferences",$e=()=>{try{const r="__localStorage_test__";return localStorage.setItem(r,r),localStorage.removeItem(r),!0}catch(r){return l("warn","localStorage 사용 불가",r.message),!1}},Tt=r=>{if(l("info","localStorage 저장 시작",{hasSettings:!!r}),!$e()){const e="localStorage를 사용할 수 없습니다";throw l("error","localStorage 저장 실패",e),new Error(e)}try{const e={settings:r,lastSaved:new Date().toISOString(),version:1};return localStorage.setItem(ve,JSON.stringify(e)),l("info","localStorage 저장 완료",{lastSaved:e.lastSaved,settingsKeys:Object.keys(r)}),{success:!0,lastSaved:e.lastSaved}}catch(e){throw l("error","localStorage 저장 실패",e.message),new Error(`설정 저장 실패: ${e.message}`)}},_t=()=>{if(l("info","localStorage 로드 시작"),!$e())return l("warn","localStorage 사용 불가 - null 반환"),null;try{const r=localStorage.getItem(ve);if(!r)return l("info","localStorage에 저장된 설정 없음"),null;const e=JSON.parse(r);return l("info","localStorage 로드 완료",{lastSaved:e.lastSaved,version:e.version,settingsKeys:Object.keys(e.settings||{})}),e.settings}catch(r){l("error","localStorage 로드 실패",r.message);try{localStorage.removeItem(ve),l("info","손상된 데이터 제거 완료")}catch(e){l("error","손상된 데이터 제거 실패",e.message)}throw new Error(`설정 로드 실패: ${r.message}`)}},Ct=()=>{if(l("info","localStorage 삭제 시작"),!$e()){const r="localStorage를 사용할 수 없습니다";return l("error","localStorage 삭제 실패",r),{success:!1,error:r}}try{return localStorage.removeItem(ve),l("info","localStorage 삭제 완료"),{success:!0}}catch(r){return l("error","localStorage 삭제 실패",r.message),{success:!1,error:r.message}}},Ot=()=>{const[r,e]=d.useState(!1),[s,a]=d.useState(null),[o,p]=d.useState(null);d.useEffect(()=>{l("info","localStorage 사용 가능 여부 확인 시작");const k=$e();e(k),l("info","localStorage 사용 가능 여부 확인 완료",{available:k})},[]);const x=d.useCallback(async k=>{l("info","설정 저장 시작",{hasSettings:!!k}),p(null);try{const u=Tt(k);return a(u.lastSaved),l("info","설정 저장 완료",u),{success:!0,lastSaved:u.lastSaved}}catch(u){const w=u.message;return p(w),l("error","설정 저장 실패",w),{success:!1,error:w}}},[]),m=d.useCallback(async()=>{l("info","설정 로드 시작"),p(null);try{const k=_t();return l("info","설정 로드 완료",{hasSettings:!!k}),{success:!0,settings:k}}catch(k){const u=k.message;return p(u),l("error","설정 로드 실패",u),{success:!1,error:u,settings:null}}},[]),g=d.useCallback(async()=>{l("info","설정 삭제 시작"),p(null);try{const k=Ct();return k.success?(a(null),l("info","설정 삭제 완료")):(p(k.error),l("error","설정 삭제 실패",k.error)),k}catch(k){const u=k.message;return p(u),l("error","설정 삭제 실패",u),{success:!1,error:u}}},[]),f=d.useCallback(async(k,u=null)=>{l("info","설정 백업 시작",{hasSettings:!!k}),p(null);try{const w={settings:k,metadata:{exportedAt:new Date().toISOString(),version:"1.0.0",type:"backup"}},n=JSON.stringify(w,null,2),N=new Blob([n],{type:"application/json"}),i=document.createElement("a");return i.href=URL.createObjectURL(N),i.download=u||`preference-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(i.href),l("info","설정 백업 완료",{filename:i.download}),{success:!0,filename:i.download}}catch(w){const n=w.message;return p(n),l("error","설정 백업 실패",n),{success:!1,error:n}}},[]),v=d.useCallback(async k=>(l("info","설정 복원 시작",{fileName:k==null?void 0:k.name}),p(null),new Promise((u,w)=>{const n=new FileReader;n.onload=N=>{try{const i=JSON.parse(N.target.result);if(!i.settings)throw new Error("유효하지 않은 백업 파일입니다.");l("info","설정 복원 완료",{fileName:k.name,settingsKeys:Object.keys(i.settings)}),u({success:!0,settings:i.settings,metadata:i.metadata})}catch(i){const c=i.message;p(c),l("error","설정 복원 실패",c),w(i)}},n.onerror=()=>{const N=new Error("파일 읽기 실패");p(N.message),l("error","설정 복원 실패",N.message),w(N)},n.readAsText(k)})),[]),O=d.useCallback(()=>{if(l("info","동기화 상태 확인 시작"),!r)return l("warn","localStorage 사용 불가 - 동기화 불가"),{synced:!1,reason:"localStorage_unavailable"};try{const k=localStorage.getItem(ve);if(!k)return l("info","저장된 설정 없음 - 동기화 불필요"),{synced:!0,reason:"no_data"};const u=JSON.parse(k),w=!!u.settings;return l("info","동기화 상태 확인 완료",{synced:w,lastSaved:u.lastSaved,hasData:w}),{synced:w,lastSaved:u.lastSaved,reason:w?"synced":"no_data"}}catch(k){return l("error","동기화 상태 확인 실패",k.message),{synced:!1,reason:"error",error:k.message}}},[r]);return{isAvailable:r,lastSaved:s,error:o,saveSettings:x,loadSettings:m,clearSettings:g,backupSettings:f,restoreSettings:v,checkSyncStatus:O,isLocalStorageAvailable:$e}},A=(r,e,s=null)=>{const o=`[ApiClient:${new Date().toISOString()}]`;switch(r){case"info":console.log(`${o} ${e}`,s);break;case"error":console.error(`${o} ${e}`,s);break;case"warn":console.warn(`${o} ${e}`,s);break;case"debug":console.debug(`${o} ${e}`,s);break;default:console.log(`${o} ${e}`,s)}},Dt=()=>{try{const r=typeof window<"u"?window.__RUNTIME_CONFIG__||{}:{},e=r.BACKEND_BASE_URL||r.VITE_API_BASE_URL,s=e&&String(e).trim()||"http://localhost:8000";return A("info","API 기본 URL 설정",{baseURL:s,runtimeCfg:Object.keys(r)}),s}catch(r){return A("error","API 기본 URL 설정 오류",r),"http://localhost:8000"}},xe=r=>{var e,s;try{return(s=(e=r==null?void 0:r.response)==null?void 0:e.data)!=null&&s.detail?r.response.data.detail:r!=null&&r.message?r.message:"알 수 없는 오류가 발생했습니다."}catch(a){return A("error","에러 메시지 추출 실패",a),"알 수 없는 오류가 발생했습니다."}},Pt=(r,e=["password","token","secret"])=>{if(!r||typeof r!="object")return r;const s={...r};return e.forEach(a=>{s[a]&&(s[a]="[HIDDEN]")}),s},Je=Dt(),Z=it.create({baseURL:Je,timeout:15e3});A("info","API 클라이언트 초기화 완료",{baseURL:Je,timeout:15e3});Z.interceptors.request.use(r=>{var e;return A("debug","API 요청 시작",{method:(e=r.method)==null?void 0:e.toUpperCase(),url:r.url,baseURL:r.baseURL,hasData:!!r.data,hasParams:!!r.params}),r},r=>(A("error","API 요청 인터셉터 오류",r),Promise.reject(r)));Z.interceptors.response.use(r=>{var e;return A("debug","API 응답 성공",{status:r.status,url:r.config.url,method:(e=r.config.method)==null?void 0:e.toUpperCase()}),r},r=>{var s,a,o,p;const e=xe(r);return A("error","API 응답 오류",{status:(s=r==null?void 0:r.response)==null?void 0:s.status,url:(a=r==null?void 0:r.config)==null?void 0:a.url,method:(p=(o=r==null?void 0:r.config)==null?void 0:o.method)==null?void 0:p.toUpperCase(),message:e}),J.error(`요청 실패: ${e}`),Promise.reject(r)});const rs=async(r,e,s="default")=>{var a;A("info","LLM 분석 요청 시작",{dbConfig:Pt(r),analysisParams:e,userId:s});try{const o=await Z.post("/api/analysis/trigger-llm-analysis",{user_id:s,db_config:r,...e});return A("info","LLM 분석 트리거 성공",{analysisId:(a=o.data)==null?void 0:a.analysis_id}),o.data}catch(o){throw A("error","LLM 분석 트리거 실패",o),o}},as=async r=>{A("info","LLM 분석 결과 조회",{analysisId:r});try{const e=await Z.get(`/api/analysis/llm-analysis/${r}`);return A("info","LLM 분석 결과 조회 성공",{analysisId:r,hasData:!!e.data}),e.data}catch(e){throw A("error","LLM 분석 결과 조회 실패",{analysisId:r,error:e}),e}},_e=async(r="default")=>{var e;A("info","사용자 설정 조회",{userId:r});try{const s=await Z.get("/api/preference/settings",{params:{user_id:r}});return A("info","사용자 설정 조회 성공",{userId:r}),{success:!0,data:s.data}}catch(s){return((e=s==null?void 0:s.response)==null?void 0:e.status)===404?(A("info","사용자 설정이 없음 (신규 사용자)",{userId:r}),{success:!0,data:null,isNew:!0}):(A("error","사용자 설정 조회 실패",{userId:r,error:s}),{success:!1,error:xe(s)})}},Ce=async(r="default",e)=>{A("info","사용자 설정 저장",{userId:r,hasData:!!e,dataKeys:e?Object.keys(e):[]});try{const s=await Z.put("/api/preference/settings",e,{params:{user_id:r}});return A("info","사용자 설정 저장 성공",{userId:r}),{success:!0,data:s.data}}catch(s){return A("error","사용자 설정 저장 실패",{userId:r,error:s}),{success:!1,error:xe(s)}}},ze=async r=>{const e=r.user_id||r.userId;A("info","사용자 설정 생성",{userId:e});try{const s=await Z.post("/api/preference/settings",r);return A("info","사용자 설정 생성 성공",{userId:e}),{success:!0,data:s.data}}catch(s){return A("error","사용자 설정 생성 실패",{userId:e,error:s}),{success:!1,error:xe(s)}}},Lt=async(r="default")=>{A("info","사용자 설정 삭제",{userId:r});try{return await Z.delete("/api/preference/settings",{params:{user_id:r}}),A("info","사용자 설정 삭제 성공",{userId:r}),{success:!0}}catch(e){return A("error","사용자 설정 삭제 실패",{userId:r,error:e}),{success:!1,error:xe(e)}}},At=async(r="default")=>{A("info","사용자 설정 내보내기",{userId:r});try{const e=await Z.get("/api/preference/export",{params:{user_id:r}});return A("info","사용자 설정 내보내기 성공",{userId:r}),{success:!0,data:e.data}}catch(e){return A("error","사용자 설정 내보내기 실패",{userId:r,error:e}),{success:!1,error:xe(e)}}},Rt=async(r="default",e,s=!1)=>{A("info","사용자 설정 가져오기",{userId:r,fileName:e==null?void 0:e.name,fileSize:e==null?void 0:e.size,overwrite:s});try{const a=new FormData;a.append("file",e);const o=await Z.post("/api/preference/import",a,{params:{user_id:r,overwrite:s},headers:{"Content-Type":"multipart/form-data"}});return A("info","사용자 설정 가져오기 성공",{userId:r}),{success:!0,data:o.data}}catch(a){return A("error","사용자 설정 가져오기 실패",{userId:r,error:a}),{success:!1,error:xe(a)}}},It=()=>{const[r,e]=d.useState(!1),[s,a]=d.useState(null),[o,p]=d.useState(null),x=d.useCallback(async c=>{var h,b;l("info","API 작업 시작"),e(!0),a(null);try{const S=await c();return p(new Date),l("info","API 작업 완료",{success:!0}),S}catch(S){const y=((b=(h=S==null?void 0:S.response)==null?void 0:h.data)==null?void 0:b.detail)||(S==null?void 0:S.message)||"알 수 없는 오류가 발생했습니다.";throw a(y),l("error","API 작업 실패",y),S}finally{e(!1)}},[]),m=d.useCallback(async(c="default")=>(l("info","사용자 설정 조회 시작",{userId:c}),await x(async()=>{const h=await _e(c);if(h.success)return l("info","사용자 설정 조회 성공",{hasData:!!h.data,isNew:h.isNew}),h;throw new Error(h.error||"설정 조회 실패")})),[x]),g=d.useCallback(async(c="default",h)=>(l("info","사용자 설정 저장 시작",{userId:c,hasData:!!h,dataKeys:h?Object.keys(h):[]}),await x(async()=>{const b=await Ce(c,h);if(b.success)return l("info","사용자 설정 저장 성공"),J.success("설정이 서버에 저장되었습니다"),b;throw new Error(b.error||"설정 저장 실패")})),[x]),f=d.useCallback(async c=>(l("info","사용자 설정 생성 시작",{userId:c.user_id||c.userId,hasData:!!c}),await x(async()=>{const h=await ze(c);if(h.success)return l("info","사용자 설정 생성 성공"),J.success("새로운 설정이 생성되었습니다"),h;throw new Error(h.error||"설정 생성 실패")})),[x]),v=d.useCallback(async(c="default")=>(l("info","사용자 설정 삭제 시작",{userId:c}),await x(async()=>{const h=await Lt(c);if(h.success)return l("info","사용자 설정 삭제 성공"),J.success("설정이 삭제되었습니다"),h;throw new Error(h.error||"설정 삭제 실패")})),[x]),O=d.useCallback(async(c="default")=>(l("info","설정 내보내기 시작",{userId:c}),await x(async()=>{const h=await At(c);if(h.success){l("info","설정 내보내기 성공");const b=JSON.stringify(h.data,null,2),S=new Blob([b],{type:"application/json"}),y=document.createElement("a");return y.href=URL.createObjectURL(S),y.download=`preference-export-${c}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(y.href),J.success("설정이 파일로 내보내졌습니다"),{...h,filename:y.download}}else throw new Error(h.error||"설정 내보내기 실패")})),[x]),k=d.useCallback(async(c="default",h,b=!1)=>(l("info","설정 가져오기 시작",{userId:c,fileName:h==null?void 0:h.name,overwrite:b}),await x(async()=>{const S=await Rt(c,h,b);if(S.success)return l("info","설정 가져오기 성공"),J.success("설정이 성공적으로 가져와졌습니다"),S;throw new Error(S.error||"설정 가져오기 실패")})),[x]),u=d.useCallback(async(c="default",h)=>(l("info","서버 동기화 시작",{userId:c,hasLocalSettings:!!h}),await x(async()=>{try{const b=await _e(c);if(b.success&&b.data){const S=await Ce(c,h);if(S.success)return l("info","서버 동기화 완료 - 업데이트"),J.success("설정이 서버와 동기화되었습니다"),{success:!0,action:"updated"};throw new Error(S.error||"설정 업데이트 실패")}else{const S={user_id:c,...h},y=await ze(S);if(y.success)return l("info","서버 동기화 완료 - 생성"),J.success("새로운 설정이 서버에 생성되었습니다"),{success:!0,action:"created"};throw new Error(y.error||"설정 생성 실패")}}catch(b){throw l("error","서버 동기화 실패",b.message),b}})),[x]),w=d.useCallback(async(c="default")=>(l("info","서버에서 동기화 시작",{userId:c}),await x(async()=>{const h=await _e(c);if(h.success)return l("info","서버에서 동기화 완료",{hasData:!!h.data,isNew:h.isNew}),h.data?J.success("서버에서 설정을 가져왔습니다"):J.info("서버에 저장된 설정이 없습니다"),h;throw new Error(h.error||"서버 동기화 실패")})),[x]),n=d.useCallback(async(c="default",h,b,S="local")=>(l("info","설정 충돌 해결 시작",{userId:c,strategy:S,hasLocalSettings:!!h,hasServerSettings:!!b}),await x(async()=>{let y=null;switch(S){case"local":y=h,l("info","로컬 설정으로 충돌 해결");break;case"server":y=b,l("info","서버 설정으로 충돌 해결");break;case"merge":y={...h,...b},l("info","설정 병합으로 충돌 해결");break;default:throw new Error("알 수 없는 충돌 해결 전략입니다")}const z=await Ce(c,y);if(z.success)return l("info","충돌 해결 완료"),J.success("설정 충돌이 해결되었습니다"),{success:!0,resolvedSettings:y,strategy:S};throw new Error(z.error||"충돌 해결 실패")})),[x]),N=d.useCallback(async()=>{l("info","네트워크 상태 확인 시작");try{const c=await Z.get("/api/health",{timeout:5e3}),h=c.status===200;return l("info","네트워크 상태 확인 완료",{isOnline:h}),{isOnline:h,status:c.status}}catch(c){return l("warn","네트워크 상태 확인 실패",c.message),{isOnline:!1,error:c.message}}},[]),i=d.useCallback(()=>{l("info","에러 상태 초기화"),a(null)},[]);return{loading:r,error:s,lastSync:o,getUserPreferences:m,saveUserPreferences:g,createUserPreferences:f,deleteUserPreferences:v,exportUserPreferences:O,importUserPreferences:k,syncToServer:u,syncFromServer:w,resolveConflict:n,checkNetworkStatus:N,clearError:i}},Ye=d.createContext(null),ns=({children:r})=>{const e=d.useMemo(()=>qe(),[]),[s,a]=d.useState(e),[o,p]=d.useState(!1),[x,m]=d.useState(!1),[g,f]=d.useState(null),[v,O]=d.useState(!1),[k,u]=d.useState(!1),[w,n]=d.useState(null),N=d.useRef(!1),i=Ot(),c=It();d.useEffect(()=>(l("info","PreferenceProvider 초기화 시작"),N.current=!0,(async()=>{try{if(p(!0),f(null),await new Promise(T=>setTimeout(T,100)),!N.current)return;if(i.isAvailable)try{l("info","초기화 시 localStorage에서 설정 로드 시작");const T=await i.loadSettings();if(T.success&&T.settings){const W=Fe(T.settings,e);a(W),u(!1),l("info","초기화 시 설정 로드 완료",{settingsKeys:Object.keys(W)})}else l("info","저장된 설정 없음 - 기본값 사용"),a(e)}catch(T){l("warn","초기화 시 설정 로드 실패, 기본값 사용",T.message),a(e)}else l("warn","localStorage 사용 불가 - 기본값 사용"),a(e);O(!0),l("info","PreferenceProvider 초기화 완료")}catch(T){l("error","PreferenceProvider 초기화 오류",T.message),f(T.message),a(e),O(!0)}finally{p(!1)}})(),()=>{N.current=!1}),[i.isAvailable]);const h=d.useCallback((L,T,W)=>{l("info","설정 업데이트",{section:L,key:T,value:W}),a(ae=>{const ye={...ae,[L]:{...ae[L],[T]:W}};return u(!0),n(new Date),l("info","설정 업데이트 완료",{section:L,key:T}),ye})},[]),b=d.useCallback(L=>{l("info","다중 설정 업데이트 시작",{newSettingsKeys:Object.keys(L)}),a(T=>{const W={...T};return Object.entries(L).forEach(([ae,ye])=>{typeof ye=="object"&&(W[ae]={...W[ae],...ye})}),u(!0),n(new Date),l("info","다중 설정 업데이트 완료"),W})},[]),S=d.useCallback(async()=>{l("info","설정 저장 시작");try{m(!0),f(null);const L=await i.saveSettings(s);if(L.success)return u(!1),l("info","설정 저장 완료"),{success:!0};throw new Error(L.error)}catch(L){const T=L.message;return f(T),l("error","설정 저장 실패",T),{success:!1,error:T}}finally{m(!1)}},[s,i]),y=d.useCallback(async()=>{l("info","설정 로드 시작");try{p(!0),f(null);const L=await i.loadSettings();if(L.success){if(L.settings){const T=Fe(L.settings,e);a(T),u(!1),l("info","설정 로드 완료",{settingsKeys:Object.keys(T)})}else l("info","저장된 설정 없음");return{success:!0,settings:L.settings}}else throw new Error(L.error)}catch(L){const T=L.message;return f(T),l("error","설정 로드 실패",T),{success:!1,error:T}}finally{p(!1)}},[e,i]),z=d.useCallback(async(L=null)=>{l("info","설정 초기화 시작",{sections:L});try{p(!0),f(null);let T=e;return L&&Array.isArray(L)&&(T={...s},L.forEach(W=>{e[W]&&(T[W]={...e[W]})})),a(T),u(!0),n(new Date),L===null&&await i.clearSettings(),l("info","설정 초기화 완료"),{success:!0}}catch(T){const W=T.message;return f(W),l("error","설정 초기화 실패",W),{success:!1,error:W}}finally{p(!1)}},[e,s,i]),R=d.useCallback((L=null)=>{l("info","설정 유효성 검증 시작",{section:L});const T=Et(s,L);return Object.keys(T).length>0?(l("warn","설정 유효성 검증 실패",T),f(`설정 오류: ${Object.values(T)[0]}`)):(l("info","설정 유효성 검증 통과"),f(null)),T},[s]),me={state:{settings:s,loading:o||i.loading||c.loading,saving:x||i.saving||c.saving,error:g||i.error||c.error,initialized:v,hasUnsavedChanges:k,lastModified:w,lastSaved:i.lastSaved,lastSync:c.lastSync,localStorageAvailable:i.isAvailable},settings:s,dashboardSettings:s.dashboardSettings||{},statisticsSettings:s.statisticsSettings||{},databaseSettings:s.databaseSettings||{},notificationSettings:s.notificationSettings||{},generalSettings:s.generalSettings||{},updateSetting:h,updateSettings:b,saveSettings:S,loadSettings:y,resetSettings:z,validateCurrentSettings:R,storage:i,api:c};return t.jsx(Ye.Provider,{value:me,children:r})},Mt=()=>{const r=d.useContext(Ye);if(!r){l("warn","usePreference: PreferenceProvider 외부에서 사용됨 - 기본값 반환");const e=qe();return{state:{settings:e,loading:!1,saving:!1,error:null,initialized:!1,hasUnsavedChanges:!1,lastModified:null,lastSaved:null,lastSync:null,localStorageAvailable:!1},settings:e,dashboardSettings:e.dashboardSettings||{},statisticsSettings:e.statisticsSettings||{},databaseSettings:e.databaseSettings||{},notificationSettings:e.notificationSettings||{},generalSettings:e.generalSettings||{},updateSetting:()=>{},updateSettings:()=>{},saveSettings:()=>Promise.resolve({success:!1}),loadSettings:()=>Promise.resolve({success:!1}),resetSettings:()=>Promise.resolve({success:!1}),validateCurrentSettings:()=>({}),storage:{isAvailable:!1,saveSettings:()=>Promise.resolve({success:!1}),loadSettings:()=>Promise.resolve({success:!1}),clearSettings:()=>Promise.resolve({success:!1}),error:null},api:{loading:!1,error:null,getUserPreferences:()=>Promise.resolve({success:!1}),saveUserPreferences:()=>Promise.resolve({success:!1}),clearError:()=>{}}}}return r};function Ut({...r}){return t.jsx(lt,{"data-slot":"dialog",...r})}function Ft({...r}){return t.jsx(dt,{"data-slot":"dialog-portal",...r})}function zt({className:r,...e}){return t.jsx(mt,{"data-slot":"dialog-overlay",className:je("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",r),...e})}function Bt({className:r,children:e,...s}){return t.jsxs(Ft,{"data-slot":"dialog-portal",children:[t.jsx(zt,{}),t.jsxs(ot,{"data-slot":"dialog-content",className:je("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",r),...s,children:[e,t.jsxs(ct,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[t.jsx(De,{}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Wt({className:r,...e}){return t.jsx("div",{"data-slot":"dialog-header",className:je("flex flex-col gap-2 text-center sm:text-left",r),...e})}function Vt({className:r,...e}){return t.jsx(ut,{"data-slot":"dialog-title",className:je("text-lg leading-none font-semibold",r),...e})}const E=(r,e,s=null)=>{const o=`[usePreference:${new Date().toISOString()}]`;switch(r){case"info":console.log(`${o} ${e}`,s);break;case"error":console.error(`${o} ${e}`,s);break;case"warn":console.warn(`${o} ${e}`,s);break;case"debug":console.debug(`${o} ${e}`,s);break;default:console.log(`${o} ${e}`,s)}},Oe={dashboardSettings:{selectedPegs:{required:!0,type:"array",minLength:1,message:"최소 하나의 PEG를 선택해야 합니다."},autoRefreshInterval:{required:!0,type:"number",min:5,max:300,message:"자동 새로고침 간격은 5초~300초 사이여야 합니다."},defaultNe:{type:"string",maxLength:50,message:"NE ID는 50자를 초과할 수 없습니다."},defaultCellId:{type:"string",maxLength:50,message:"Cell ID는 50자를 초과할 수 없습니다."}},statisticsSettings:{defaultDateRange:{required:!0,type:"number",min:1,max:365,message:"기본 날짜 범위는 1일~365일 사이여야 합니다."},decimalPlaces:{required:!0,type:"number",min:0,max:6,message:"소수점 자릿수는 0~6자리 사이여야 합니다."},defaultPegs:{required:!0,type:"array",minLength:1,message:"최소 하나의 기본 PEG를 선택해야 합니다."}}},Be=(r,e=null)=>{E("debug","설정 유효성 검증 시작",{section:e,settings:r});const s={};if(e&&!Oe[e])return E("warn",`검증 규칙이 없는 섹션: ${e}`),s;const a=e?{[e]:Oe[e]}:Oe;return Object.entries(a).forEach(([o,p])=>{if(!r[o]){E("debug",`섹션 ${o}가 설정에 없음`);return}Object.entries(p).forEach(([x,m])=>{const g=r[o][x],f=`${o}.${x}`;if(m.required&&(g==null||g==="")){s[f]=m.message||`${x}는 필수 항목입니다.`,E("error",`필수 필드 누락: ${f}`);return}if(g==null||g===""){E("debug",`필드 ${f} 값이 없어 검증 스킵`);return}if(m.type==="array"&&!Array.isArray(g)){s[f]=m.message||`${x}는 배열이어야 합니다.`,E("error",`타입 오류: ${f}는 배열이어야 함`);return}if(m.type==="number"&&typeof g!="number"){s[f]=m.message||`${x}는 숫자여야 합니다.`,E("error",`타입 오류: ${f}는 숫자여야 함`);return}if(m.type==="string"&&typeof g!="string"){s[f]=m.message||`${x}는 문자열이어야 합니다.`,E("error",`타입 오류: ${f}는 문자열이어야 함`);return}if(m.type==="number"){if(m.min!==void 0&&g<m.min){s[f]=m.message||`${x}는 ${m.min} 이상이어야 합니다.`,E("error",`범위 오류: ${f}는 ${m.min} 이상이어야 함`);return}if(m.max!==void 0&&g>m.max){s[f]=m.message||`${x}는 ${m.max} 이하여야 합니다.`,E("error",`범위 오류: ${f}는 ${m.max} 이하여야 함`);return}}if(m.type==="array"){if(m.minLength!==void 0&&g.length<m.minLength){s[f]=m.message||`${x}는 최소 ${m.minLength}개 항목이 필요합니다.`,E("error",`배열 길이 오류: ${f}는 최소 ${m.minLength}개 필요`);return}if(m.maxLength!==void 0&&g.length>m.maxLength){s[f]=m.message||`${x}는 최대 ${m.maxLength}개 항목만 허용됩니다.`,E("error",`배열 길이 오류: ${f}는 최대 ${m.maxLength}개만 허용`);return}}if(m.type==="string"){if(m.minLength!==void 0&&g.length<m.minLength){s[f]=m.message||`${x}는 최소 ${m.minLength}자 이상이어야 합니다.`,E("error",`문자열 길이 오류: ${f}는 최소 ${m.minLength}자 필요`);return}if(m.maxLength!==void 0&&g.length>m.maxLength){s[f]=m.message||`${x}는 최대 ${m.maxLength}자까지 허용됩니다.`,E("error",`문자열 길이 오류: ${f}는 최대 ${m.maxLength}자만 허용`);return}}})}),E("debug","설정 유효성 검증 완료",{errors:s}),s},Ae=()=>{const r=d.useRef(!1);r.current||(E("debug","usePreference 훅 초기화"),r.current=!0);const e=Mt(),[s,a]=d.useState({}),o=d.useMemo(()=>{const u=(e==null?void 0:e.settings)||{};return E("debug","설정 접근",{hasSettings:!!u}),u},[e==null?void 0:e.settings]),p=d.useCallback(u=>{E("info","설정 업데이트 시작",{newSettings:u}),e!=null&&e.updateSetting?(Object.entries(u).forEach(([w,n])=>{typeof n=="object"&&Object.entries(n).forEach(([N,i])=>{E("debug",`설정 업데이트: ${w}.${N}`,{value:i}),e.updateSetting(w,N,i)})}),E("info","설정 업데이트 완료")):E("error","updateSetting 함수를 사용할 수 없음")},[e==null?void 0:e.updateSetting]),x=d.useCallback(async()=>{if(E("info","설정 저장 시작"),e!=null&&e.saveSettings)try{const u=await e.saveSettings();return E("info","설정 저장 완료",{result:u}),u}catch(u){throw E("error","설정 저장 실패",u),u}else return E("error","saveSettings 함수를 사용할 수 없음"),!1},[e==null?void 0:e.saveSettings]),m=d.useCallback(async()=>{if(E("info","설정 로드 시작"),e!=null&&e.loadSettings)try{const u=await e.loadSettings();return E("info","설정 로드 완료",{result:u}),u}catch(u){throw E("error","설정 로드 실패",u),u}else return E("error","loadSettings 함수를 사용할 수 없음"),!1},[e==null?void 0:e.loadSettings]),g=d.useCallback(async u=>{if(E("info","설정 리셋 시작",{sections:u}),e!=null&&e.resetSettings)try{const w=await e.resetSettings(u);return E("info","설정 리셋 완료",{result:w}),w}catch(w){return E("error","설정 리셋 실패",w),{success:!1,error:w.message}}else return E("error","resetSettings 함수를 사용할 수 없음"),{success:!1,error:"resetSettings 함수를 사용할 수 없습니다"}},[e==null?void 0:e.resetSettings]),f=d.useCallback((u,w=null)=>{var i;E("info","설정 업데이트 및 검증 시작",{newSettings:u,section:w});const n=w?{...o,[w]:{...o[w],...u[w]}}:{...o,...u},N=Be(n,w);if(a(N),Object.keys(N).length>0){E("error","설정 유효성 검증 실패",N);const c=Object.values(N)[0];return(i=o.notificationSettings)!=null&&i.errorNotification&&J.error(`설정 오류: ${c}`),!1}return p(u),E("info","설정 업데이트 완료"),!0},[o,p]),v=d.useCallback((u=null,w=null)=>{var n,N;E("info","설정 내보내기 시작",{filename:u,partial:w});try{const i={settings:w&&Object.keys(w).length>0?{...o,...w}:o,metadata:{exportedAt:new Date().toISOString(),version:"1.0.0",userId:(e==null?void 0:e.userId)||"default"}},c=JSON.stringify(i,null,2),h=new Blob([c],{type:"application/json"}),b=document.createElement("a");return b.href=URL.createObjectURL(h),b.download=u||`preference-settings-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(b.href),E("info","설정 내보내기 완료",{filename:b.download}),(n=o.notificationSettings)!=null&&n.enableToasts&&J.success("설정이 파일로 내보내졌습니다"),!0}catch(i){return E("error","설정 내보내기 실패",i),(N=o.notificationSettings)!=null&&N.errorNotification&&J.error("설정 내보내기 실패: "+i.message),!1}},[o,e==null?void 0:e.userId]),O=d.useCallback(u=>(E("info","설정 가져오기 시작",{filename:u.name}),new Promise((w,n)=>{const N=new FileReader;N.onload=i=>{var c,h;try{const b=JSON.parse(i.target.result);if(!b.settings)throw new Error("유효하지 않은 설정 파일입니다.");p(b.settings),E("info","설정 가져오기 완료",{filename:u.name}),(c=o.notificationSettings)!=null&&c.enableToasts&&J.success("설정이 성공적으로 가져와졌습니다"),w(b)}catch(b){E("error","설정 가져오기 실패",b),(h=o.notificationSettings)!=null&&h.errorNotification&&J.error("설정 가져오기 실패: "+b.message),n(b)}},N.onerror=()=>{const i=new Error("파일 읽기 실패");E("error","설정 가져오기 실패",i),n(i)},N.readAsText(u)})),[o,p]),k={settings:o,dashboardSettings:o.dashboardSettings||{},statisticsSettings:o.statisticsSettings||{},databaseSettings:o.databaseSettings||{},notificationSettings:o.notificationSettings||{},generalSettings:o.generalSettings||{},loading:(e==null?void 0:e.loading)||!1,saving:(e==null?void 0:e.saving)||!1,error:(e==null?void 0:e.error)||null,initialized:(e==null?void 0:e.initialized)||!1,updateSettings:p,updateSettingsWithValidation:f,saveSettings:x,loadSettings:m,exportSettings:v,importSettings:O,resetSettings:g,validationErrors:s,validateSettings:(u,w)=>Be(u,w),logInfo:(u,w)=>E("info",u,w),logError:(u,w)=>E("error",u,w)};return E("debug","usePreference 훅 반환값 생성 완료"),k},Ht=()=>{const r=d.useRef(!1);r.current||(E("debug","useDashboardSettings 훅 초기화"),r.current=!0);const{dashboardSettings:e,updateSettings:s,saving:a,error:o,validationErrors:p,logInfo:x}=Ae(),m=d.useMemo(()=>{const v={selectedPegs:[],defaultNe:"",defaultCellId:"",autoRefreshInterval:0,chartStyle:"line",showLegend:!0,showGrid:!0},O={...v,...e};return Array.isArray(e==null?void 0:e.selectedPegs)&&e.selectedPegs.length>0?O.selectedPegs=e.selectedPegs:O.selectedPegs=v.selectedPegs,E("debug","Dashboard 설정 처리 완료",{settings:O}),O},[e]),g=d.useCallback(v=>(x("Dashboard 설정 업데이트",v),s({dashboardSettings:v})),[s,x]),f=d.useMemo(()=>Object.fromEntries(Object.entries(p).filter(([v])=>v.startsWith("dashboardSettings."))),[p]);return{settings:m,updateSettings:g,saving:a,error:o,validationErrors:f,hasErrors:Object.keys(f).length>0}},is=()=>{const r=d.useRef(!1);r.current||(E("debug","useStatisticsSettings 훅 초기화"),r.current=!0);const{statisticsSettings:e,updateSettings:s,saving:a,error:o,validationErrors:p,logInfo:x}=Ae(),m=d.useCallback(f=>(x("Statistics 설정 업데이트",f),s({statisticsSettings:f})),[s,x]),g=d.useMemo(()=>Object.fromEntries(Object.entries(p).filter(([f])=>f.startsWith("statisticsSettings."))),[p]);return{settings:e,updateSettings:m,saving:a,error:o,validationErrors:g,hasErrors:Object.keys(g).length>0}},Gt=(r,e,s=null)=>{const o=`[DashboardHeader:${new Date().toISOString()}]`;switch(r){case"info":console.log(`${o} ${e}`,s);break;case"error":console.error(`${o} ${e}`,s);break;case"warn":console.warn(`${o} ${e}`,s);break;case"debug":console.debug(`${o} ${e}`,s);break;default:console.log(`${o} ${e}`,s)}},We=({loading:r,saving:e,settingsError:s,selectedPegs:a,chartStyle:o,enableTimeComparison:p,defaultNe:x,defaultCellId:m,lastRefresh:g,onManualRefresh:f})=>(Gt("debug","DashboardHeader 렌더링",{loading:r,saving:e,settingsError:s,selectedPegsCount:a==null?void 0:a.length,chartStyle:o,enableTimeComparison:p,defaultNe:x,defaultCellId:m,lastRefresh:g}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-3xl font-bold",children:"Dashboard"}),t.jsxs("p",{className:"text-muted-foreground",children:[(a==null?void 0:a.length)||0,"개 PEG 항목 • 차트 스타일: ",o,p&&" • Time1/Time2 비교 모드",x&&` • NE: ${x}`,m&&` • Cell: ${m}`]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[e&&t.jsxs(re,{variant:"secondary",className:"text-xs",children:[t.jsx(ht,{className:"h-3 w-3 mr-1"}),"설정 저장 중"]}),s&&t.jsx(re,{variant:"destructive",className:"text-xs",children:"설정 오류"}),p&&t.jsx(re,{variant:"default",className:"text-xs bg-blue-100 text-blue-800",children:"Time1/Time2 비교"}),g&&t.jsxs(re,{variant:"secondary",className:"text-xs",children:["마지막 업데이트: ",g.toLocaleTimeString()]}),t.jsxs(le,{variant:"outline",size:"sm",onClick:f,disabled:r,children:[t.jsx(Pe,{className:`h-4 w-4 mr-2 ${r?"animate-spin":""}`}),"새로고침"]})]})]}));function Kt({className:r,...e}){return t.jsx(ft,{"data-slot":"switch",className:je("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",r),...e,children:t.jsx(gt,{"data-slot":"switch-thumb",className:je("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const qt=(r,e,s=null)=>{const o=`[DashboardSettings:${new Date().toISOString()}]`;switch(r){case"info":console.log(`${o} ${e}`,s);break;case"error":console.error(`${o} ${e}`,s);break;case"warn":console.warn(`${o} ${e}`,s);break;case"debug":console.debug(`${o} ${e}`,s);break;default:console.log(`${o} ${e}`,s)}},Jt=({defaultTimeRange:r,enableTimeComparison:e,tempTimeSettings:s,inputCompleted:a,loading:o,onUpdateDefaultTimeRange:p,onUpdateEnableTimeComparison:x,onUpdateTempTimeSetting:m,onApplyTime1Settings:g,onApplyTime2Settings:f,onToggleTime1Settings:v,onToggleTime2Settings:O,onManualRefresh:k})=>{var u,w,n,N,i,c,h,b;return qt("debug","DashboardSettings 렌더링",{defaultTimeRange:r,enableTimeComparison:e,tempTimeSettings:s,inputCompleted:a,onToggleTime1Settings:!!v,onToggleTime2Settings:!!O,loading:o}),t.jsxs(we,{children:[t.jsx(Ge,{children:t.jsxs(Ke,{className:"flex items-center gap-2",children:[t.jsx(xt,{className:"h-5 w-5"}),"기본시간 설정"]})}),t.jsxs(Se,{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(q,{htmlFor:"defaultTimeRange",className:"text-sm font-medium",children:"기본 시간 범위"}),t.jsxs(oe,{value:r.toString(),onValueChange:p,children:[t.jsx(ce,{children:t.jsx(ue,{placeholder:"시간 범위 선택"})}),t.jsxs(de,{children:[t.jsx(F,{value:"5",children:"5분"}),t.jsx(F,{value:"15",children:"15분"}),t.jsx(F,{value:"30",children:"30분"}),t.jsx(F,{value:"60",children:"1시간"}),t.jsx(F,{value:"120",children:"2시간"}),t.jsx(F,{value:"360",children:"6시간"}),t.jsx(F,{value:"720",children:"12시간"})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Kt,{id:"enableTimeComparison",checked:e,onCheckedChange:x}),t.jsx(q,{htmlFor:"enableTimeComparison",className:"text-sm font-medium",children:"Time1/Time2 비교 활성화"})]}),e&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"text-sm font-medium text-blue-600",children:"Time1 설정"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{children:[t.jsx(q,{className:"text-xs text-muted-foreground",children:"시작 시간"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx(q,{htmlFor:"time1StartDate",className:"text-xs",children:"날짜"}),t.jsx("input",{type:"date",id:"time1StartDate",className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",value:s.time1Start?s.time1Start.split("T")[0]:"",onChange:S=>{const y=s.time1Start?s.time1Start.split("T")[1]:"00:00";m("time1","Start",`${S.target.value}T${y}`)}})]}),t.jsxs("div",{children:[t.jsx(q,{htmlFor:"time1StartHour",className:"text-xs",children:"시간"}),t.jsxs(oe,{value:s.time1Start&&((u=s.time1Start.split("T")[1])==null?void 0:u.split(":")[0])||"00",onValueChange:S=>{var R;const y=s.time1Start?s.time1Start.split("T")[0]:new Date().toISOString().split("T")[0],z=s.time1Start&&((R=s.time1Start.split("T")[1])==null?void 0:R.split(":")[1])||"00";m("time1","Start",`${y}T${S}:${z}`)},children:[t.jsx(ce,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(ue,{})}),t.jsx(de,{children:Array.from({length:24},(S,y)=>t.jsx(F,{value:y.toString().padStart(2,"0"),children:y.toString().padStart(2,"0")},y))})]})]}),t.jsxs("div",{children:[t.jsx(q,{htmlFor:"time1StartMinute",className:"text-xs",children:"분"}),t.jsxs(oe,{value:s.time1Start&&((w=s.time1Start.split("T")[1])==null?void 0:w.split(":")[1])||"00",onValueChange:S=>{var R;const y=s.time1Start?s.time1Start.split("T")[0]:new Date().toISOString().split("T")[0],z=s.time1Start&&((R=s.time1Start.split("T")[1])==null?void 0:R.split(":")[0])||"00";m("time1","Start",`${y}T${z}:${S}`)},children:[t.jsx(ce,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(ue,{})}),t.jsxs(de,{children:[t.jsx(F,{value:"00",children:"00"}),t.jsx(F,{value:"15",children:"15"}),t.jsx(F,{value:"30",children:"30"}),t.jsx(F,{value:"45",children:"45"})]})]})]})]})]}),t.jsxs("div",{children:[t.jsx(q,{className:"text-xs text-muted-foreground",children:"끝 시간"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx(q,{htmlFor:"time1EndDate",className:"text-xs",children:"날짜"}),t.jsx("input",{type:"date",id:"time1EndDate",className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",value:s.time1End?s.time1End.split("T")[0]:"",onChange:S=>{const y=s.time1End?s.time1End.split("T")[1]:"00:00";m("time1","End",`${S.target.value}T${y}`)}})]}),t.jsxs("div",{children:[t.jsx(q,{htmlFor:"time1EndHour",className:"text-xs",children:"시간"}),t.jsxs(oe,{value:s.time1End&&((n=s.time1End.split("T")[1])==null?void 0:n.split(":")[0])||"00",onValueChange:S=>{var R;const y=s.time1End?s.time1End.split("T")[0]:new Date().toISOString().split("T")[0],z=s.time1End&&((R=s.time1End.split("T")[1])==null?void 0:R.split(":")[1])||"00";m("time1","End",`${y}T${S}:${z}`)},children:[t.jsx(ce,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(ue,{})}),t.jsx(de,{children:Array.from({length:24},(S,y)=>t.jsx(F,{value:y.toString().padStart(2,"0"),children:y.toString().padStart(2,"0")},y))})]})]}),t.jsxs("div",{children:[t.jsx(q,{htmlFor:"time1EndMinute",className:"text-xs",children:"분"}),t.jsxs(oe,{value:s.time1End&&((N=s.time1End.split("T")[1])==null?void 0:N.split(":")[1])||"00",onValueChange:S=>{var R;const y=s.time1End?s.time1End.split("T")[0]:new Date().toISOString().split("T")[0],z=s.time1End&&((R=s.time1End.split("T")[1])==null?void 0:R.split(":")[0])||"00";m("time1","End",`${y}T${z}:${S}`)},children:[t.jsx(ce,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(ue,{})}),t.jsxs(de,{children:[t.jsx(F,{value:"00",children:"00"}),t.jsx(F,{value:"15",children:"15"}),t.jsx(F,{value:"30",children:"30"}),t.jsx(F,{value:"45",children:"45"})]})]})]})]})]}),t.jsx(le,{onClick:g,disabled:!s.time1Start||!s.time1End||a.time1,size:"sm",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:a.time1?t.jsxs(t.Fragment,{children:[t.jsx(ke,{className:"h-4 w-4 mr-2"}),"Time1 설정 완료"]}):"Time1 설정 입력"})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"text-sm font-medium text-green-600",children:"Time2 설정"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{children:[t.jsx(q,{className:"text-xs text-muted-foreground",children:"시작 시간"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx(q,{htmlFor:"time2StartDate",className:"text-xs",children:"날짜"}),t.jsx("input",{type:"date",id:"time2StartDate",className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",value:s.time2Start?s.time2Start.split("T")[0]:"",onChange:S=>{const y=s.time2Start?s.time2Start.split("T")[1]:"00:00";m("time2","Start",`${S.target.value}T${y}`)}})]}),t.jsxs("div",{children:[t.jsx(q,{htmlFor:"time2StartHour",className:"text-xs",children:"시간"}),t.jsxs(oe,{value:s.time2Start&&((i=s.time2Start.split("T")[1])==null?void 0:i.split(":")[0])||"00",onValueChange:S=>{var R;const y=s.time2Start?s.time2Start.split("T")[0]:new Date().toISOString().split("T")[0],z=s.time2Start&&((R=s.time2Start.split("T")[1])==null?void 0:R.split(":")[1])||"00";m("time2","Start",`${y}T${S}:${z}`)},children:[t.jsx(ce,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(ue,{})}),t.jsx(de,{children:Array.from({length:24},(S,y)=>t.jsx(F,{value:y.toString().padStart(2,"0"),children:y.toString().padStart(2,"0")},y))})]})]}),t.jsxs("div",{children:[t.jsx(q,{htmlFor:"time2StartMinute",className:"text-xs",children:"분"}),t.jsxs(oe,{value:s.time2Start&&((c=s.time2Start.split("T")[1])==null?void 0:c.split(":")[1])||"00",onValueChange:S=>{var R;const y=s.time2Start?s.time2Start.split("T")[0]:new Date().toISOString().split("T")[0],z=s.time2Start&&((R=s.time2Start.split("T")[1])==null?void 0:R.split(":")[0])||"00";m("time2","Start",`${y}T${z}:${S}`)},children:[t.jsx(ce,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(ue,{})}),t.jsxs(de,{children:[t.jsx(F,{value:"00",children:"00"}),t.jsx(F,{value:"15",children:"15"}),t.jsx(F,{value:"30",children:"30"}),t.jsx(F,{value:"45",children:"45"})]})]})]})]})]}),t.jsxs("div",{children:[t.jsx(q,{className:"text-xs text-muted-foreground",children:"끝 시간"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx(q,{htmlFor:"time2EndDate",className:"text-xs",children:"날짜"}),t.jsx("input",{type:"date",id:"time2EndDate",className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",value:s.time2End?s.time2End.split("T")[0]:"",onChange:S=>{const y=s.time2End?s.time2End.split("T")[1]:"00:00";m("time2","End",`${S.target.value}T${y}`)}})]}),t.jsxs("div",{children:[t.jsx(q,{htmlFor:"time2EndHour",className:"text-xs",children:"시간"}),t.jsxs(oe,{value:s.time2End&&((h=s.time2End.split("T")[1])==null?void 0:h.split(":")[0])||"00",onValueChange:S=>{var R;const y=s.time2End?s.time2End.split("T")[0]:new Date().toISOString().split("T")[0],z=s.time2End&&((R=s.time2End.split("T")[1])==null?void 0:R.split(":")[1])||"00";m("time2","End",`${y}T${S}:${z}`)},children:[t.jsx(ce,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(ue,{})}),t.jsx(de,{children:Array.from({length:24},(S,y)=>t.jsx(F,{value:y.toString().padStart(2,"0"),children:y.toString().padStart(2,"0")},y))})]})]}),t.jsxs("div",{children:[t.jsx(q,{htmlFor:"time2EndMinute",className:"text-xs",children:"분"}),t.jsxs(oe,{value:s.time2End&&((b=s.time2End.split("T")[1])==null?void 0:b.split(":")[1])||"00",onValueChange:S=>{var R;const y=s.time2End?s.time2End.split("T")[0]:new Date().toISOString().split("T")[0],z=s.time2End&&((R=s.time2End.split("T")[1])==null?void 0:R.split(":")[0])||"00";m("time2","End",`${y}T${z}:${S}`)},children:[t.jsx(ce,{className:"w-full h-8 px-3 py-1 border border-gray-300 rounded-md text-xs",children:t.jsx(ue,{})}),t.jsxs(de,{children:[t.jsx(F,{value:"00",children:"00"}),t.jsx(F,{value:"15",children:"15"}),t.jsx(F,{value:"30",children:"30"}),t.jsx(F,{value:"45",children:"45"})]})]})]})]})]}),t.jsx(le,{onClick:f,disabled:!s.time2Start||!s.time2End||a.time2,size:"sm",className:"w-full bg-green-600 hover:bg-green-700 text-white",children:a.time2?t.jsxs(t.Fragment,{children:[t.jsx(ke,{className:"h-4 w-4 mr-2"}),"Time2 설정 완료"]}):"Time2 설정 입력"})]})]})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(le,{onClick:k,disabled:o||!a.time1||!a.time2,className:"bg-purple-600 hover:bg-purple-700 text-white",children:o?"데이터 로딩 중...":"Time1/Time2 비교 데이터 로드"})}),t.jsxs("div",{className:"flex justify-center gap-6 text-xs",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:`flex items-center gap-1 ${a.time1?"text-green-600":"text-gray-500"}`,children:[a.time1?t.jsx(ke,{className:"h-3 w-3"}):t.jsx(De,{className:"h-3 w-3"}),"Time1 설정 ",a.time1?"완료":"대기"]}),t.jsx(le,{variant:"outline",size:"sm",onClick:v,className:"h-6 px-2 text-xs",disabled:!v,children:a.time1?"수정":"완료"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:`flex items-center gap-1 ${a.time2?"text-green-600":"text-gray-500"}`,children:[a.time2?t.jsx(ke,{className:"h-3 w-3"}):t.jsx(De,{className:"h-3 w-3"}),"Time2 설정 ",a.time2?"완료":"대기"]}),t.jsx(le,{variant:"outline",size:"sm",onClick:O,className:"h-6 px-2 text-xs",disabled:!O,children:a.time2?"수정":"완료"})]})]})]}),!e&&t.jsx(le,{onClick:k,disabled:o,className:"w-full",children:o?"데이터 로딩 중...":"데이터 새로고침"})]})]})]})},fe=(r,e,s=null)=>{const o=`[DashboardChart:${new Date().toISOString()}]`;switch(r){case"info":console.log(`${o} ${e}`,s);break;case"error":console.error(`${o} ${e}`,s);break;case"warn":console.warn(`${o} ${e}`,s);break;case"debug":console.debug(`${o} ${e}`,s);break;default:console.log(`${o} ${e}`,s)}},ge=r=>{const e=["#8884d8","#82ca9d","#ffc658","#ff7300","#8dd1e1","#d084d0"];return r<e.length?e[r]:`hsl(${r*47%360}, 70%, 50%)`},Xe=({chartData:r,chartKey:e,idx:s,chartStyle:a,showGrid:o,showLegend:p,enableTimeComparison:x,loading:m=!1,onRefresh:g,error:f=null})=>{const[v,O]=d.useState(!1),k=d.useCallback(async()=>{if(g){O(!0),fe("info","차트별 새로고침 시작",{chartKey:e});try{await g(),fe("info","차트별 새로고침 완료",{chartKey:e})}catch(i){fe("error","차트별 새로고침 실패",{chartKey:e,error:i.message})}finally{O(!1)}}},[g,e]);if(fe("debug","DashboardChart 렌더링",{chartKey:e,chartStyle:a,dataLength:r==null?void 0:r.length,loading:m,chartLoading:v,hasError:!!f,showGrid:o,showLegend:p,enableTimeComparison:x}),m||v)return t.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[t.jsx("div",{className:"animate-pulse",children:t.jsx(Le,{className:"h-12 w-12 text-muted-foreground mb-2"})}),t.jsx("p",{className:"text-sm text-muted-foreground",children:v?"차트 새로고침 중...":"데이터 로딩 중..."}),t.jsxs("div",{className:"flex space-x-1 mt-2",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]});if(f)return t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-destructive",children:[t.jsx(yt,{className:"h-12 w-12 mb-2"}),t.jsx("p",{className:"text-sm font-medium mb-1",children:"차트 로드 오류"}),t.jsx("p",{className:"text-xs text-muted-foreground mb-3 text-center max-w-32",children:f.message||"데이터를 불러올 수 없습니다"}),g&&t.jsxs(le,{variant:"outline",size:"sm",onClick:k,disabled:v,className:"text-xs",children:[t.jsx(Pe,{className:`h-3 w-3 mr-1 ${v?"animate-spin":""}`}),"다시 시도"]})]});if(!r||r.length===0)return fe("warn","차트 데이터가 없음",{chartKey:e}),t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-muted-foreground",children:[t.jsx(Le,{className:"h-12 w-12 mb-2 opacity-50"}),t.jsx("p",{className:"text-sm font-medium mb-1",children:"데이터가 없습니다"}),t.jsx("p",{className:"text-xs text-center max-w-32 mb-3",children:"선택한 조건에 맞는 데이터가 존재하지 않습니다"}),g&&t.jsxs(le,{variant:"outline",size:"sm",onClick:k,disabled:v,className:"text-xs",children:[t.jsx(Pe,{className:`h-3 w-3 mr-1 ${v?"animate-spin":""}`}),"새로고침"]})]});const u=r.length>0?Array.from(new Set(r.flatMap(i=>Object.keys(i).filter(c=>c!=="time"&&c!=="_originalTime"&&c!=="_isTime2")))):[];fe("debug","차트 엔티티 정보",{chartKey:e,entities:u,entitiesCount:u.length,hasTimeComparison:x,time1Entities:u.filter(i=>i.includes("_Time1")),time2Entities:u.filter(i=>i.includes("_Time2")),chartDataLength:r.length,time1DataPoints:r.filter(i=>!i._isTime2).length,time2DataPoints:r.filter(i=>i._isTime2).length,sampleChartData:r.slice(0,3).map(i=>({time:i.time,_isTime2:i._isTime2,entityKeys:Object.keys(i).filter(c=>!c.startsWith("_")),allKeys:Object.keys(i),sampleValues:Object.keys(i).filter(c=>!c.startsWith("_")).slice(0,3).map(c=>({key:c,value:i[c]}))})),time2DetailedInfo:x?{time2EntitiesFound:u.filter(i=>i.includes("_Time2")).length,time2DataPoints:r.filter(i=>i._isTime2),time2SampleValues:r.filter(i=>i._isTime2).slice(0,2).map(i=>({time:i.time,entities:Object.keys(i).filter(c=>!c.startsWith("_")),values:Object.keys(i).filter(c=>!c.startsWith("_")).reduce((c,h)=>(c[h]=i[h],c),{})}))}:null});const w={data:r,className:"h-64"},n=(i,c)=>i,N=[o&&t.jsx(wt,{strokeDasharray:"3 3"},"grid"),t.jsx(St,{dataKey:"time",tickFormatter:x?n:void 0,angle:x?-45:0,textAnchor:x?"end":"middle",height:x?80:60},"xaxis"),t.jsx(vt,{},"yaxis"),t.jsx($t,{labelFormatter:i=>`시간: ${i}`,formatter:(i,c)=>{if(x){const h=c.replace("_Time1","").replace("_Time2","");return[i,h]}return[i,c]}},"tooltip"),p&&t.jsx(kt,{verticalAlign:"bottom",align:"center",layout:"horizontal",wrapperStyle:{paddingTop:"20px",paddingBottom:"10px"},formatter:(i,c,h)=>x?i.replace("_Time1","").replace("_Time2",""):i},"legend")].filter(Boolean);try{switch(fe("info","차트 렌더링 시작",{chartKey:e,chartStyle:a,enableTimeComparison:x,entitiesCount:u.length,chartDataLength:r.length,time1DataPoints:r.filter(i=>!i._isTime2).length,time2DataPoints:r.filter(i=>i._isTime2).length,entities:u,time1Entities:u.filter(i=>i.includes("_Time1")),time2Entities:u.filter(i=>i.includes("_Time2")),firstDataPoint:r.length>0?{time:r[0].time,_isTime2:r[0]._isTime2,allKeys:Object.keys(r[0]),entityKeys:Object.keys(r[0]).filter(i=>!i.startsWith("_")),entityValues:Object.keys(r[0]).filter(i=>!i.startsWith("_")).reduce((i,c)=>(i[c]=r[0][c],i),{})}:null}),a){case"area":return t.jsx(Ee,{width:"100%",height:"100%",children:t.jsxs(pt,{...w,children:[N,u.map((i,c)=>{if(x&&i.includes("_Time")){const h=i.replace("_Time1","").replace("_Time2",""),b=i.includes("_Time1");return t.jsx(Ue,{type:"monotone",dataKey:i,stroke:ge((s+c)%12),fill:ge((s+c)%12),fillOpacity:.3,strokeWidth:2,strokeDasharray:b?void 0:"5 5",name:`${h} (${b?"Time1":"Time2"})`},i)}else return t.jsx(Ue,{type:"monotone",dataKey:i,stroke:ge((s+c)%12),fill:ge((s+c)%12),fillOpacity:.3,strokeWidth:2},i)})]})});case"bar":return t.jsx(Ee,{width:"100%",height:"100%",children:t.jsxs(jt,{...w,children:[N,u.map((i,c)=>{if(x&&i.includes("_Time")){const h=i.replace("_Time1","").replace("_Time2",""),b=i.includes("_Time1");return t.jsx(Me,{dataKey:i,fill:ge((s+c)%12),name:`${h} (${b?"Time1":"Time2"})`},i)}else return t.jsx(Me,{dataKey:i,fill:ge((s+c)%12)},i)})]})});case"line":default:return t.jsx(Ee,{width:"100%",height:"100%",children:t.jsxs(bt,{...w,children:[N,u.map((i,c)=>{if(x&&i.includes("_Time")){const h=i.replace("_Time1","").replace("_Time2",""),b=i.includes("_Time1");return t.jsx(Ie,{type:"monotone",dataKey:i,stroke:ge((s+c)%12),strokeWidth:2,strokeDasharray:b?void 0:"5 5",name:`${h} (${b?"Time1":"Time2"})`},i)}else return t.jsx(Ie,{type:"monotone",dataKey:i,stroke:ge((s+c)%12),strokeWidth:2},i)})]})})}}catch(i){return fe("error","차트 렌더링 오류",{key,error:i}),t.jsx("div",{className:"h-full flex items-center justify-center text-red-500",children:"차트 렌더링 오류"})}},Yt=(r,e,s=null)=>{const o=`[DashboardCard:${new Date().toISOString()}]`;switch(r){case"info":console.log(`${o} ${e}`,s);break;case"error":console.error(`${o} ${e}`,s);break;case"warn":console.warn(`${o} ${e}`,s);break;case"debug":console.debug(`${o} ${e}`,s);break;default:console.log(`${o} ${e}`,s)}},Ve=r=>r,He=({chartKey:r,idx:e,title:s,chartData:a,chartStyle:o,chartLayout:p,enableTimeComparison:x,showGrid:m,showLegend:g,onZoom:f,loading:v=!1,onRefresh:O,error:k=null})=>{Yt("debug","DashboardCard 렌더링",{chartKey:r,idx:e,title:s,chartStyle:o,chartLayout:p,dataLength:a==null?void 0:a.length,loading:v,hasError:!!k,enableTimeComparison:x,chartDataType:Array.isArray(a)?"array":typeof a,chartDataSample:(a==null?void 0:a.length)>0?{firstItem:{time:a[0].time,_isTime2:a[0]._isTime2,entityCount:Object.keys(a[0]).filter(n=>!n.startsWith("_")).length,entities:Object.keys(a[0]).filter(n=>!n.startsWith("_")),allKeys:Object.keys(a[0])},totalItems:a.length,time1DataPoints:a.filter(n=>!n._isTime2).length,time2DataPoints:a.filter(n=>n._isTime2).length,time2SampleData:a.filter(n=>n._isTime2).slice(0,2).map(n=>({time:n.time,_isTime2:n._isTime2,entities:Object.keys(n).filter(N=>!N.startsWith("_")),sampleValues:Object.keys(n).filter(N=>!N.startsWith("_")).slice(0,3).map(N=>({key:N,value:n[N]}))}))}:null});const u=(a==null?void 0:a.length)>0?Array.from(new Set(a.flatMap(n=>Object.keys(n).filter(N=>N!=="time"&&N!=="_originalTime"&&N!=="_isTime2")))):[],w=`w-full ${k?"border-destructive":""} ${v?"opacity-75":""}`;return t.jsxs(we,{className:w,children:[t.jsx(Ge,{children:t.jsxs(Ke,{className:"flex items-center justify-between",children:[Ve(s),t.jsxs("div",{className:"flex items-center gap-2",children:[x&&t.jsx(re,{variant:"default",className:"text-xs bg-blue-100 text-blue-800",children:"Time1/Time2 비교"}),t.jsxs(re,{variant:"outline",className:"text-xs",children:[u.length,"개 시리즈"]}),t.jsxs(re,{variant:"secondary",className:"text-xs",children:[(a==null?void 0:a.length)||0,"개 데이터포인트"]})]})]})}),t.jsx(Se,{children:t.jsx("div",{className:"h-64 cursor-zoom-in",onClick:()=>f({open:!0,title:Ve(s),data:a}),children:t.jsx(Xe,{chartData:a,chartKey:r,idx:e,chartStyle:o,showGrid:m,showLegend:g,enableTimeComparison:x,loading:v,onRefresh:O,error:k})})})]},`${r}-${e}`)},C=(r,e,s=null)=>{const o=`[Dashboard:${new Date().toISOString()}]`;switch(r){case"info":console.log(`${o} ${e}`,s);break;case"error":console.error(`${o} ${e}`,s);break;case"warn":console.warn(`${o} ${e}`,s);break;case"debug":console.debug(`${o} ${e}`,s);break;default:console.log(`${o} ${e}`,s)}},Xt=()=>{const r=d.useRef(!1);r.current||(C("debug","Dashboard 컴포넌트 초기화"),r.current=!0);const[e,s]=d.useState({}),[a,o]=d.useState(null),[p,x]=d.useState(!1),[m,g]=d.useState(null),[f,v]=d.useState({open:!1,title:"",data:[]}),[O,k]=d.useState({time1Start:"",time1End:"",time2Start:"",time2End:""}),[u,w]=d.useState({time1:!1,time2:!1}),{settings:n={},saving:N=!1,error:i=null,updateSettings:c=()=>{}}=Ht(),{settings:h={}}=Ae(),b=d.useMemo(()=>Array.isArray(n==null?void 0:n.selectedPegs)?n.selectedPegs:[],[n==null?void 0:n.selectedPegs]),S=d.useMemo(()=>(h==null?void 0:h.statisticsSettings)||{},[h==null?void 0:h.statisticsSettings]),y=d.useMemo(()=>Array.isArray(S.selectedNEs)?S.selectedNEs:[],[S.selectedNEs]),z=d.useMemo(()=>Array.isArray(S.selectedCellIds)?S.selectedCellIds:[],[S.selectedCellIds]),R=d.useMemo(()=>(n==null?void 0:n.chartStyle)||"line",[n==null?void 0:n.chartStyle]),me=d.useMemo(()=>(n==null?void 0:n.chartLayout)||"byPeg",[n==null?void 0:n.chartLayout]),L=d.useMemo(()=>(n==null?void 0:n.showLegend)!==!1,[n==null?void 0:n.showLegend]),T=d.useMemo(()=>(n==null?void 0:n.showGrid)!==!1,[n==null?void 0:n.showGrid]),W=d.useMemo(()=>(n==null?void 0:n.defaultNe)||"",[n==null?void 0:n.defaultNe]),ae=d.useMemo(()=>(n==null?void 0:n.defaultCellId)||"",[n==null?void 0:n.defaultCellId]),ye=d.useMemo(()=>(n==null?void 0:n.defaultTimeRange)||30,[n==null?void 0:n.defaultTimeRange]),Q=d.useMemo(()=>(n==null?void 0:n.time1Start)||"",[n==null?void 0:n.time1Start]),Y=d.useMemo(()=>(n==null?void 0:n.time1End)||"",[n==null?void 0:n.time1End]),X=d.useMemo(()=>(n==null?void 0:n.time2Start)||"",[n==null?void 0:n.time2Start]),ee=d.useMemo(()=>(n==null?void 0:n.time2End)||"",[n==null?void 0:n.time2End]),V=d.useMemo(()=>(n==null?void 0:n.enableTimeComparison)||!1,[n==null?void 0:n.enableTimeComparison]),Ze=d.useCallback(j=>{C("info","기본시간범위 업데이트",{value:j}),c({defaultTimeRange:parseInt(j)})},[c]),Qe=d.useCallback(j=>{C("info","토글 상태 변경",{checked:j}),c({enableTimeComparison:j})},[c]),et=d.useCallback((j,B,I)=>{C("debug","임시 시간 설정 업데이트",{type:j,field:B,value:I}),k(D=>({...D,[`${j}${B}`]:I}))},[]),tt=d.useCallback(()=>{O.time1Start&&O.time1End&&(C("info","Time1 설정 적용",{start:O.time1Start,end:O.time1End}),c({time1Start:O.time1Start,time1End:O.time1End}),w(j=>({...j,time1:!0})))},[O.time1Start,O.time1End,c]),st=d.useCallback(()=>{O.time2Start&&O.time2End&&(C("info","Time2 설정 적용",{start:O.time2Start,end:O.time2End}),c({time2Start:O.time2Start,time2End:O.time2End}),w(j=>({...j,time2:!0})))},[O.time2Start,O.time2End,c]),rt=d.useCallback(()=>{C("info","Time1 설정 토글",{currentState:u.time1,newState:!u.time1}),u.time1&&k(j=>({...j,time1Start:Q,time1End:Y})),w(j=>({...j,time1:!j.time1}))},[u.time1,Q,Y]),at=d.useCallback(()=>{C("info","Time2 설정 토글",{currentState:u.time2,newState:!u.time2}),u.time2&&k(j=>({...j,time2Start:X,time2End:ee})),w(j=>({...j,time2:!j.time2}))},[u.time2,X,ee]),Ne=d.useCallback(async()=>{var D,te,M,G;C("info","데이터 fetching 시작");const j=b.length>0?b:["randomaccessproblem"],B=y.length>0?y:["NVGNB#101086"],I=z.length>0?z.map(U=>parseInt(U)):[8418];if(C("debug","데이터 fetching 파라미터",{selectedPegs:b,safeSelectedPegs:j,selectedNEs:y,safeSelectedNEs:B,selectedCellIds:z,safeSelectedCellIds:I,defaultNe:W,defaultCellId:ae,enableTimeComparison:V,time1Start:Q,time1End:Y,time2Start:X,time2End:ee}),j.length===0){C("warn","선택된 PEG가 없음 - 데이터 fetching 중단"),s({}),o(null),x(!1);return}try{if(x(!0),V&&Q&&Y&&X&&ee){C("info","Time1/Time2 비교 모드로 데이터 fetching");const U={start_date:Q,end_date:Y,kpi_types:j,ne:B,cellid:I};C("info","Time1 API 파라미터 상세",{...U,time1StartParsed:new Date(Q).toISOString(),time1EndParsed:new Date(Y).toISOString(),time1DurationMinutes:`${Math.abs(new Date(Y)-new Date(Q))/(1e3*60)}분`,safeSelectedPegs:j,safeSelectedNEs:B,safeSelectedCellIds:I});const $=await Z.post("/api/kpi/query",U),P={start_date:X,end_date:ee,kpi_types:j,ne:B,cellid:I};C("info","Time2 API 파라미터 상세",{...P,time2StartParsed:new Date(X).toISOString(),time2EndParsed:new Date(ee).toISOString(),time2DurationMinutes:`${Math.abs(new Date(ee)-new Date(X))/(1e3*60)}분`,timeComparison:{time1Start:Q,time1End:Y,time2Start:X,time2End:ee,time1Duration:`${Math.abs(new Date(Y)-new Date(Q))/(1e3*60)}분`,time2Duration:`${Math.abs(new Date(ee)-new Date(X))/(1e3*60)}분`,timeOverlap:new Date(Y)>new Date(X)?"시간대 겹침":"시간대 분리"}}),C("debug","설정된 시간 범위",{time1Start:Q,time1End:Y,time2Start:X,time2End:ee,time1Duration:`${Math.abs(new Date(Y)-new Date(Q))/(1e3*60)}분`,time2Duration:`${Math.abs(new Date(ee)-new Date(X))/(1e3*60)}분`}),C("info","Time2 API 호출 전 파라미터",P);const _=await Z.post("/api/kpi/query",P);C("info","Time2 API 호출 후 응답 상태",{status:_==null?void 0:_.status,statusText:_==null?void 0:_.statusText,hasData:!!(_!=null&&_.data),dataKeys:_!=null&&_.data?Object.keys(_.data):[]});const K=((D=$==null?void 0:$.data)==null?void 0:D.data)||{},H=((te=_==null?void 0:_.data)==null?void 0:te.data)||{},ne=j[0]||"randomaccessproblem",se=H[ne];C("info","Time2 데이터 상세 분석",{time2ResponseStatus:_==null?void 0:_.status,time2ResponseHasData:!!(_!=null&&_.data),time2ResponseDataKeys:_!=null&&_.data?Object.keys(_.data):[],time2RawDataKeys:Object.keys(H),time2DataStructure:Object.keys(H).reduce((be,ie)=>{const he=H[ie];return be[ie]={type:Array.isArray(he)?"array":typeof he,length:Array.isArray(he)?he.length:"N/A",sample:Array.isArray(he)&&he.length>0?he.slice(0,1):null},be},{}),targetKpiKey:ne,targetKpiInTime2Data:H.hasOwnProperty(ne),targetKpiDataLength:Array.isArray(se)?se.length:"N/A",targetKpiDataSample:Array.isArray(se)&&se.length>0?se.slice(0,3):[],comparison:{time1DataLength:Array.isArray(K[ne])?K[ne].length:"N/A",time2DataLength:Array.isArray(se)?se.length:"N/A",difference:(Array.isArray(K[ne])?K[ne].length:0)-(Array.isArray(se)?se.length:0)}}),Array.isArray(se)&&se.length<=1&&C("warn","Time2 데이터가 1개 이하입니다 - 상세 분석",{time2Params:P,time2KpiData:se,time2FullResponse:_==null?void 0:_.data,possibleIssues:["Time2 기간에 실제 데이터가 부족함","API 파라미터가 잘못됨","데이터베이스에 해당 시간대의 데이터가 없음","API 응답 구조가 예상과 다름"]}),s(K),o(H),C("debug","데이터 저장 후 상태",{kpiDataKeys:Object.keys(K),time2DataKeys:Object.keys(H),time2DataSample:Object.keys(H).length>0?{firstKey:Object.keys(H)[0],firstKeyDataLength:((M=H[Object.keys(H)[0]])==null?void 0:M.length)||0}:null}),C("info","Time1/Time2 데이터 fetching 완료",{time1KpiCount:Object.keys(K).length,time1TotalRows:Object.values(K).reduce((be,ie)=>be+((ie==null?void 0:ie.length)||0),0),time2KpiCount:Object.keys(H).length,time2TotalRows:Object.values(H).reduce((be,ie)=>be+((ie==null?void 0:ie.length)||0),0),time1DataKeys:Object.keys(K),time2DataKeys:Object.keys(H)})}else{C("info","일반 모드로 데이터 fetching");const U=new Date,$=new Date(U.getTime()-((n==null?void 0:n.defaultHours)||1)*60*60*1e3),P={kpi_types:j,ne:B,cellid:I,start:$.toISOString(),end:U.toISOString()};C("debug","일반 모드 API 파라미터",P);const _=await Z.post("/api/kpi/timeseries",P),K=((G=_==null?void 0:_.data)==null?void 0:G.data)||{};s(K),o(null),C("info","일반 모드 데이터 fetching 완료",{kpiCount:Object.keys(K).length,totalRows:Object.values(K).reduce((H,ne)=>H+((ne==null?void 0:ne.length)||0),0),dataKeys:Object.keys(K)})}g(new Date)}catch(U){C("error","데이터 fetching 오류",U),s({}),o(null)}finally{x(!1)}},[b,y,z,n==null?void 0:n.defaultHours,W,ae,V,Q,Y,X,ee]);d.useEffect(()=>{const j=setTimeout(()=>{C("info","설정 변경으로 인한 데이터 로드 시작"),Ne()},500);return()=>clearTimeout(j)},[b,y,z,n==null?void 0:n.defaultHours,W,ae,V,Q,Y,X,ee]);const pe=d.useCallback(()=>{C("info","수동 새로고침 실행"),Ne()},[Ne]),nt=d.useCallback(j=>{C("debug","차트 데이터 구성",{kpiKey:j,chartLayout:me});const B=Array.isArray(e[j])?e[j]:[],I=V&&a?Array.isArray(a[j])?a[j]:[]:[];if(V&&C("debug","buildChartDataByLayout - Time2 데이터 분석",{kpiKey:j,enableTimeComparison:V,time2DataExists:!!a,time2DataType:typeof a,time2DataKeys:a?Object.keys(a):[],kpiKeyInTime2Data:a?a.hasOwnProperty(j):!1,time2DataForKpiKey:a==null?void 0:a[j],time2DataForKpiKeyType:typeof(a==null?void 0:a[j]),time2DataForKpiKeyIsArray:Array.isArray(a==null?void 0:a[j]),time2RowsLength:I.length,time2RowsSample:I.length>0?I.slice(0,2).map(D=>({entity_id:D.entity_id,timestamp:D.timestamp,value:D.value,hasTimestamp:!!D.timestamp,hasEntityId:!!D.entity_id,hasValue:D.hasOwnProperty("value")})):[]}),C("debug","차트 데이터 구성 - 데이터 상태 확인",{kpiKey:j,kpiDataExists:!!e,time2DataExists:!!a,kpiDataKeys:Object.keys(e||{}),time2DataKeys:Object.keys(a||{}),kpiDataHasKey:!!(e&&e[j]),time2DataHasKey:!!(a&&a[j]),flatRowsLength:B.length,time2RowsLength:I.length}),B.length===0&&I.length===0)return C("warn","차트 데이터 없음 - 데이터 구성 실패",{kpiKey:j,flatRowsLength:B.length,time2RowsLength:I.length}),[];if(me==="byPeg"){const D={};let te=0;C("debug","차트 데이터 구성 시작",{kpiKey:j,time1RowsCount:B.length,time2RowsCount:I.length,enableTimeComparison:V,time2DataKeys:Object.keys(a||{}),time2DataHasKpiKey:!!(a&&a[j])}),B.forEach($=>{const P=new Date($.timestamp),_=`T1_${te++}_${P.getTime()}`,K=P.toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/\./g,"/").replace(" "," ");D[_]||(D[_]={time:K,_originalTime:P});const H=V?`${$.entity_id}_Time1`:$.entity_id;D[_][H]=$.value}),V&&I.length>0?(C("debug","Time2 데이터 처리 시작",{time2RowsCount:I.length,time2RowsSample:I.slice(0,2).map($=>({entity_id:$.entity_id,timestamp:$.timestamp,value:$.value}))}),I.forEach($=>{const P=new Date($.timestamp),_=`T2_${te++}_${P.getTime()}`,K=P.toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/\./g,"/").replace(" "," ");D[_]||(D[_]={time:K,_originalTime:P,_isTime2:!0});const H=`${$.entity_id}_Time2`;D[_][H]=$.value}),C("debug","Time2 데이터 처리 완료",{processedTime2Rows:I.length,groupedByTimeKeys:Object.keys(D).length,time2KeysInGrouped:Object.keys(D).filter($=>$.startsWith("T2_")).length})):C("debug","Time2 데이터 처리 건너뜀",{enableTimeComparison:V,time2RowsLength:I.length,reason:V?"Time2 데이터 없음":"비교 모드 비활성화"});const M=Object.values(D).sort(($,P)=>$._originalTime.getTime()-P._originalTime.getTime()),G=M.filter($=>!$._isTime2),U=M.filter($=>$._isTime2);return C("info","Time1/Time2 데이터 구성 완료",{kpiKey:j,time1Count:B.length,time2Count:I.length,totalDataPoints:M.length,time1DataPointsCount:G.length,time2DataPointsCount:U.length,timeRange:M.length>0?{first:M[0].time,last:M[M.length-1].time}:null,sampleDataPoints:M.slice(0,3).map($=>({time:$.time,_isTime2:$._isTime2,entityCount:Object.keys($).filter(P=>!P.startsWith("_")).length,entities:Object.keys($).filter(P=>!P.startsWith("_")),allKeys:Object.keys($)})),time1Entities:B.length>0?Object.keys(B[0]).filter($=>$!=="timestamp"):[],time2Entities:I.length>0?Object.keys(I[0]).filter($=>$!=="timestamp"):[],time2EntityKeys:U.length>0?Object.keys(U[0]).filter($=>!$.startsWith("_")):[],time2SampleData:U.slice(0,2).map($=>({time:$.time,_isTime2:$._isTime2,entities:Object.keys($).filter(P=>!P.startsWith("_")),sampleValues:Object.keys($).filter(P=>!P.startsWith("_")).slice(0,3).map(P=>({key:P,value:$[P]}))}))}),C("debug","buildChartDataByLayout 최종 반환 데이터",{kpiKey:j,returnedDataLength:M.length,totalTime1Data:M.filter($=>!$._isTime2).length,totalTime2Data:M.filter($=>$._isTime2).length,returnedData:M.slice(0,3).map($=>({time:$.time,_isTime2:$._isTime2,entityCount:Object.keys($).filter(P=>!P.startsWith("_")).length,entities:Object.keys($).filter(P=>!P.startsWith("_")),sampleValues:Object.keys($).filter(P=>!P.startsWith("_")).slice(0,2).map(P=>({key:P,value:$[P]}))}))}),M}else{const D={};B.forEach(M=>{const G=new Date(M.timestamp).toLocaleString(),U=M.entity_id;D[U]=D[U]||{},D[U][G]=D[U][G]||{time:G},D[U][G][M.peg_name]=M.value}),V&&I.forEach(M=>{const G=new Date(M.timestamp).toLocaleString()+" (T2)",U=M.entity_id;D[U]=D[U]||{},D[U][G]=D[U][G]||{time:G},D[U][G][M.peg_name+"_Time2"]=M.value});const te={};return Object.keys(D).forEach(M=>{te[M]=Object.values(D[M]).sort((G,U)=>new Date(G.time.replace(" (T2)",""))-new Date(U.time.replace(" (T2)","")))}),te}},[e,a,V,me]);return p?(C("debug","로딩 상태 렌더링"),t.jsxs("div",{className:"space-y-6",children:[t.jsx(We,{loading:p,saving:N,settingsError:i,selectedPegs:b,chartStyle:R,enableTimeComparison:V,defaultNe:W,defaultCellId:ae,lastRefresh:m,onManualRefresh:pe}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:b.map(j=>t.jsx(we,{children:t.jsx(Se,{className:"pt-6",children:t.jsx("div",{className:"h-64 flex items-center justify-center",children:t.jsx("div",{className:"text-muted-foreground",children:"Loading..."})})})},j))})]})):(C("debug","Dashboard 메인 렌더링"),t.jsxs("div",{className:"space-y-6",children:[t.jsx(Jt,{defaultTimeRange:ye,enableTimeComparison:V,tempTimeSettings:O,inputCompleted:u,loading:p,onUpdateDefaultTimeRange:Ze,onUpdateEnableTimeComparison:Qe,onUpdateTempTimeSetting:et,onApplyTime1Settings:tt,onApplyTime2Settings:st,onToggleTime1Settings:rt,onToggleTime2Settings:at,onManualRefresh:pe}),t.jsx(We,{loading:p,saving:N,settingsError:i,selectedPegs:b,chartStyle:R,enableTimeComparison:V,defaultNe:W,defaultCellId:ae,lastRefresh:m,onManualRefresh:pe}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs(re,{variant:"default",children:["선택된 PEG: ",b.join(", ")]}),V&&t.jsx(re,{variant:"default",className:"bg-blue-100 text-blue-800",children:"Time1/Time2 비교 활성화"}),t.jsxs(re,{variant:"outline",children:["차트 스타일: ",R]}),!L&&t.jsx(re,{variant:"secondary",children:"범례 숨김"}),!T&&t.jsx(re,{variant:"secondary",children:"격자 숨김"})]}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:b.map((j,B)=>{C("debug","차트 렌더링 시작",{key:j,idx:B,selectedPegs:b,totalSelectedPegs:b.length});const I=nt(j);if(me==="byPeg"){const D=Array.isArray(I)?I:[];return C("debug","차트 데이터 생성 결과",{key:j,chartDataLength:D.length,builtType:Array.isArray(I)?"array":typeof I}),t.jsx(He,{chartKey:j,idx:B,title:j,chartData:D,chartStyle:R,chartLayout:me,enableTimeComparison:V,showGrid:T,showLegend:L,onZoom:v,loading:p,onRefresh:pe,error:null},`${j}-${B}`)}else{const D=I||{};return Object.keys(D).map((te,M)=>{const G=D[te];return t.jsx(He,{idx:B+M,title:te,chartData:G,chartStyle:R,chartLayout:me,enableTimeComparison:V,showGrid:T,showLegend:L,onZoom:v,loading:p,onRefresh:pe,error:null},`${j}-${te}-${M}`)})}})}),t.jsx(Ut,{open:f.open,onOpenChange:j=>v(B=>({...B,open:j})),children:t.jsxs(Bt,{className:"max-w-6xl",children:[t.jsx(Wt,{children:t.jsx(Vt,{children:f.title})}),t.jsx("div",{className:"h-[480px]",children:Array.isArray(f.data)&&f.data.length>0&&t.jsx(Xe,{chartData:f.data,idx:0,chartStyle:R,showGrid:T,showLegend:L,enableTimeComparison:V,loading:!1,onRefresh:null,error:null},"zoom")})]})}),b.length===0&&t.jsx(we,{children:t.jsx(Se,{className:"pt-6",children:t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Re,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"표시할 PEG가 선택되지 않았습니다"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Preference 메뉴에서 표시할 PEG 항목을 선택하세요."}),t.jsxs(le,{variant:"outline",onClick:()=>{console.log("Navigate to Preference menu")},children:[t.jsx(Re,{className:"h-4 w-4 mr-2"}),"Preference 설정"]})]})})}),p&&b.length>0&&t.jsx(we,{children:t.jsx(Se,{className:"pt-6",children:t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"animate-pulse",children:t.jsx(Le,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"})}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"데이터 로딩 중..."}),t.jsx("p",{className:"text-muted-foreground",children:"선택한 PEG의 데이터를 불러오고 있습니다."}),t.jsxs("div",{className:"flex justify-center space-x-1 mt-4",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})})]}))},ls=Object.freeze(Object.defineProperty({__proto__:null,default:Xt},Symbol.toStringTag,{value:"Module"}));export{Ut as D,ns as P,Kt as S,Z as a,Bt as b,Wt as c,Vt as d,is as e,ls as f,as as g,rs as t,Ae as u};
