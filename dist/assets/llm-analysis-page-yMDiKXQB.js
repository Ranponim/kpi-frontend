import{N as s,r as c,O as d}from"./vendor-Cw6wx6N3.js";import{C as Y}from"./utils-vendor-NSOZWQzV.js";import{c as y,C as m,b as u,d as x,e as h,L as v,I as b,a as S,B as M}from"./common-components-BsYW0TmQ.js";import{u as H,t as T,g as P}from"./dashboard-page-CxSfgQ35.js";import{B as I,D as k,S as B,L as F,P as z,f as O,k as R}from"./icon-vendor-1p3lj7wq.js";const E=Y("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function K({className:t,variant:a,...n}){return s.jsx("div",{"data-slot":"alert",role:"alert",className:y(E({variant:a}),t),...n})}function W({className:t,...a}){return s.jsx("div",{"data-slot":"alert-description",className:y("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}function X({className:t,...a}){return s.jsx("textarea",{"data-slot":"textarea",className:y("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}const V=()=>{var _;const{settings:t}=H(),a=c.useMemo(()=>(t==null?void 0:t.databaseSettings)||{host:"",port:5432,user:"postgres",password:"",dbname:"postgres",table:"summary"},[t==null?void 0:t.databaseSettings]),[n,D]=c.useState({n_minus_1:"",n:"",table:"summary",ne:"",cellid:"",preference:"",columns:{time:"datetime",peg_name:"peg_name",value:"value",ne:"ne",cellid:"cellid"}}),[p,$]=c.useState(null),[g,o]=c.useState(!1),[r,N]=c.useState(null),[L,w]=c.useState([]),C=c.useCallback(async()=>{if(!n.n_minus_1||!n.n){d.error("Î∂ÑÏÑù Í∏∞Í∞Ñ(N-1, N)ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");return}if((p==null?void 0:p.type)!=="success"){d.error("Î®ºÏ†Ä Database Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.");return}o(!0);try{console.log("üöÄ LLM Î∂ÑÏÑù ÏãúÏûë:",{dbConfig:a,analysisParams:n});const e=await T(a,n,"default");console.log("‚úÖ LLM Î∂ÑÏÑù Ìä∏Î¶¨Í±∞ ÏÑ±Í≥µ:",e),N({id:e.analysis_id,status:"processing",message:e.message,startTime:new Date}),d.success("LLM Î∂ÑÏÑùÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Í≤∞Í≥ºÎ•º ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§."),A(e.analysis_id)}catch(e){console.error("‚ùå LLM Î∂ÑÏÑù ÏöîÏ≤≠ Ïã§Ìå®:",e),d.error(`Î∂ÑÏÑù ÏöîÏ≤≠ Ïã§Ìå®: ${e.message}`),o(!1)}},[n,p,a]),A=e=>{const i=setInterval(async()=>{try{const l=await P(e);console.log("üìä Ìè¥ÎßÅ Í≤∞Í≥º:",l),(l.status==="completed"||l.status==="error")&&(clearInterval(i),o(!1),N(f=>({...f,status:l.status,result:l,endTime:new Date})),w(f=>[{id:e,status:l.status,startTime:new Date,params:n,result:l},...f]),l.status==="completed"?d.success("LLM Î∂ÑÏÑùÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!"):d.error("LLM Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§."))}catch(l){console.error("Ìè¥ÎßÅ Ïò§Î•ò:",l),clearInterval(i),o(!1)}},5e3);setTimeout(()=>{clearInterval(i),g&&(o(!1),d.error("Î∂ÑÏÑù ÏãúÍ∞ÑÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§. Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Î¨∏ÏùòÌïòÏÑ∏Ïöî."))},6e5)},j=(e,i)=>{D(l=>({...l,[e]:i}))};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs(m,{children:[s.jsx(u,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(I,{className:"h-5 w-5"}),"LLM Î∂ÑÏÑù Í¥ÄÎ¶¨Ïûê"]})}),s.jsx(h,{children:s.jsx("p",{className:"text-muted-foreground",children:"PostgreSQL DatabaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Ï°∞ÌöåÌïòÏó¨ LLM Í∏∞Î∞ò ÏÑ±Îä• Î∂ÑÏÑùÏùÑ ÏàòÌñâÌï©ÎãàÎã§."})})]}),s.jsxs(m,{children:[s.jsx(u,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(k,{className:"h-5 w-5"}),"Database ÏÑ§Ï†ï"]})}),s.jsxs(h,{children:[s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Database ÏÑ§Ï†ïÏùÄ Ïù¥Ï†ú ",s.jsx("strong",{children:"ÌôòÍ≤ΩÏÑ§Ï†ï > Database"})," ÌÉ≠ÏóêÏÑú ÌÜµÌï© Í¥ÄÎ¶¨Îê©ÎãàÎã§. Ïù¥ ÌôîÎ©¥ÏóêÏÑúÎäî PreferenceÏóê Ï†ÄÏû•Îêú ÏÑ§Ï†ïÏùÑ ÏÇ¨Ïö©Ìï©ÎãàÎã§."]}),s.jsxs("div",{className:"mt-3 text-sm",children:[s.jsxs("div",{children:["Host: ",s.jsx("span",{className:"font-mono",children:a.host||"-"})]}),s.jsxs("div",{children:["Port: ",s.jsx("span",{className:"font-mono",children:a.port||"-"})]}),s.jsxs("div",{children:["User: ",s.jsx("span",{className:"font-mono",children:a.user||"-"})]}),s.jsxs("div",{children:["DB: ",s.jsx("span",{className:"font-mono",children:a.dbname||"-"})]}),s.jsxs("div",{children:["Table: ",s.jsx("span",{className:"font-mono",children:a.table||"-"})]})]})]})]}),s.jsxs(m,{children:[s.jsx(u,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(B,{className:"h-5 w-5"}),"Î∂ÑÏÑù ÌååÎùºÎØ∏ÌÑ∞"]})}),s.jsxs(h,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(v,{htmlFor:"n_minus_1",children:"N-1 Í∏∞Í∞Ñ"}),s.jsx(b,{id:"n_minus_1",value:n.n_minus_1,onChange:e=>j("n_minus_1",e.target.value),placeholder:"YYYY-MM-DD_HH:mm~YYYY-MM-DD_HH:mm"})]}),s.jsxs("div",{children:[s.jsx(v,{htmlFor:"n",children:"N Í∏∞Í∞Ñ"}),s.jsx(b,{id:"n",value:n.n,onChange:e=>j("n",e.target.value),placeholder:"YYYY-MM-DD_HH:mm~YYYY-MM-DD_HH:mm"})]}),s.jsxs("div",{children:[s.jsx(v,{htmlFor:"table",children:"ÌÖåÏù¥Î∏îÎ™Ö"}),s.jsx(b,{id:"table",value:n.table,onChange:e=>j("table",e.target.value),placeholder:"summary"})]})]}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsx(S,{onClick:C,disabled:g,children:g?s.jsxs(s.Fragment,{children:[s.jsx(F,{className:"h-4 w-4 animate-spin mr-2"})," Î∂ÑÏÑù Ï§ë..."]}):s.jsxs(s.Fragment,{children:[s.jsx(z,{className:"h-4 w-4 mr-2"})," Î∂ÑÏÑù ÏãúÏûë"]})})})]})]}),r&&s.jsxs(m,{children:[s.jsx(u,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(O,{className:"h-5 w-5"}),"ÌòÑÏû¨ Î∂ÑÏÑù ÏÉÅÌÉú"]})}),s.jsxs(h,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"font-medium",children:["Î∂ÑÏÑù ID: ",r.id]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:r.message})]}),s.jsx(M,{variant:r.status==="processing"?"default":r.status==="completed"?"success":"destructive",children:r.status==="processing"?"Ï≤òÎ¶¨ Ï§ë":r.status==="completed"?"ÏôÑÎ£å":"Ïò§Î•ò"})]}),r.result&&r.status==="completed"&&s.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:[s.jsx("p",{className:"font-medium mb-2",children:"Î∂ÑÏÑù Í≤∞Í≥º"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[r.result.report_path&&s.jsxs("p",{children:["üìÑ Î¶¨Ìè¨Ìä∏: ",r.result.report_path]}),((_=r.result.results)==null?void 0:_.analysis)&&s.jsx("p",{children:"üß† LLM Î∂ÑÏÑù: ÏôÑÎ£å"})]})]})]})]}),L.length>0&&s.jsxs(m,{children:[s.jsx(u,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(R,{className:"h-5 w-5"}),"Î∂ÑÏÑù ÌûàÏä§ÌÜ†Î¶¨"]})}),s.jsx(h,{children:s.jsx("div",{className:"space-y-3",children:L.map((e,i)=>s.jsxs("div",{className:"border rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("p",{className:"font-medium text-sm",children:["Î∂ÑÏÑù #",i+1]}),s.jsx(M,{variant:e.status==="completed"?"success":"destructive",children:e.status==="completed"?"ÏôÑÎ£å":"Ïò§Î•ò"})]}),s.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[s.jsxs("p",{children:["Í∏∞Í∞Ñ: ",e.params.n_minus_1," vs ",e.params.n]}),s.jsxs("p",{children:["ÏãúÍ∞Ñ: ",e.startTime.toLocaleString()]}),s.jsxs("p",{children:["ID: ",e.id]})]})]},e.id))})})]})]})},Z=Object.freeze(Object.defineProperty({__proto__:null,default:V},Symbol.toStringTag,{value:"Module"}));export{K as A,Z as L,X as T,W as a};
