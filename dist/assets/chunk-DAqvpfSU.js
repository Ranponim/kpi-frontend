import{j as e,r as c,b as Z,g as oe}from"./chunk-CTtn32jH.js";import{c as $,u as Re,C as K,a as ae,b as te,B as z,d as Ie,e as ee,f as T,L as I,S as we,g as Le,h as Te,i as _e,j as Ge,k as ie,l as We,m as os,n as Se,o as ds}from"./chunk-DX3kcswl.js";import{o as ms,L as xs,p as us,q as hs,r as ps,s as gs,t as js,u as fs,v as vs,w as bs,x as Ns,y as ys,z as Ss,A as ws,B as Cs,E as ks,F as Ds}from"./chunk-BBx_fWpL.js";import{b as be,C as Ne,f as re,c as Qe,a as Ke,g as ze,h as Es,F as Ps,U as Os,i as As,j as Is,D as Fe,k as es,L as ss,l as pe,P as Fs,m as Ls,n as He,T as Ts,o as _s,X as Gs,p as ke,B as zs,q as Rs,e as $s,r as Bs,S as Ue,R as Vs,s as Ms}from"./chunk-M6kWLAXF.js";import{a as qs}from"./chunk-BziMVLSE.js";function Js({className:s,...r}){return e.jsx(ms,{"data-slot":"tabs",className:$("flex flex-col gap-2",s),...r})}function Zs({className:s,...r}){return e.jsx(xs,{"data-slot":"tabs-list",className:$("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",s),...r})}function je({className:s,...r}){return e.jsx(us,{"data-slot":"tabs-trigger",className:$("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...r})}function fe({className:s,...r}){return e.jsx(hs,{"data-slot":"tabs-content",className:$("flex-1 outline-none",s),...r})}function ve({className:s,type:r,...l}){return e.jsx("input",{type:r,"data-slot":"input",className:$("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...l})}function as({className:s,...r}){return e.jsx(ps,{"data-slot":"checkbox",className:$("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...r,children:e.jsx(gs,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(be,{className:"size-3.5"})})})}function $e({className:s,orientation:r="horizontal",decorative:l=!0,...v}){return e.jsx(js,{"data-slot":"separator-root",decorative:l,orientation:r,className:$("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",s),...v})}function ts({...s}){return e.jsx(fs,{"data-slot":"collapsible",...s})}function rs({...s}){return e.jsx(vs,{"data-slot":"collapsible-trigger",...s})}function ls({...s}){return e.jsx(bs,{"data-slot":"collapsible-content",...s})}const Hs=qs("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function ns({className:s,variant:r,...l}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:$(Hs({variant:r}),s),...l})}function cs({className:s,...r}){return e.jsx("div",{"data-slot":"alert-description",className:$("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...r})}const Ce={text:{placeholder:"텍스트를 입력하세요",maxLength:100},number:{placeholder:"숫자를 입력하세요",min:0,max:999999},select:{placeholder:"선택하세요",options:[]},multiselect:{placeholder:"하나 이상 선택하세요",options:[]},checkbox:{label:"활성화"},switch:{label:"켜기/끄기"}},Us=({field:s,value:r,onChange:l,error:v,disabled:d})=>{var p,b,S,E;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(I,{htmlFor:s.key,className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsx(ve,{id:s.key,type:s.type==="number"?"number":"text",value:r||"",onChange:x=>{const g=s.type==="number"?x.target.value===""?"":Number(x.target.value):x.target.value;l(g)},placeholder:s.placeholder||((p=Ce[s.type])==null?void 0:p.placeholder),maxLength:s.maxLength||((b=Ce[s.type])==null?void 0:b.maxLength),min:s.min||((S=Ce[s.type])==null?void 0:S.min),max:s.max||((E=Ce[s.type])==null?void 0:E.max),disabled:d,className:v?"border-destructive":""}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),v&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(re,{className:"h-3 w-3"}),v]})]})},Ys=({field:s,value:r,onChange:l,error:v,disabled:d})=>{var p;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(I,{htmlFor:s.key,className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsxs(Le,{value:r||"",onValueChange:l,disabled:d,children:[e.jsx(Te,{className:v?"border-destructive":"",children:e.jsx(_e,{placeholder:s.placeholder||Ce.select.placeholder})}),e.jsx(Ge,{children:(p=s.options)==null?void 0:p.map(b=>e.jsx(ie,{value:b.value,children:b.label},b.value))})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),v&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(re,{className:"h-3 w-3"}),v]})]})},Xs=({field:s,value:r,onChange:l,error:v,disabled:d})=>{var S,E;const p=Array.isArray(r)?r:[],b=x=>{const g=p.includes(x)?p.filter(j=>j!==x):[...p,x];l(g)};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(I,{className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),e.jsxs("div",{className:`border rounded-md p-3 space-y-2 ${v?"border-destructive":"border-input"}`,children:[(S=s.options)==null?void 0:S.map(x=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(as,{id:`${s.key}-${x.value}`,checked:p.includes(x.value),onCheckedChange:()=>b(x.value),disabled:d}),e.jsx(I,{htmlFor:`${s.key}-${x.value}`,className:"text-sm cursor-pointer",children:x.label})]},x.value)),((E=s.options)==null?void 0:E.length)===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"선택 가능한 옵션이 없습니다"})]}),p.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:p.map(x=>{var j;const g=(j=s.options)==null?void 0:j.find(C=>C.value===x);return g?e.jsx(z,{variant:"secondary",className:"text-xs",children:g.label},x):null})}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),v&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(re,{className:"h-3 w-3"}),v]})]})},Ws=({field:s,value:r,onChange:l,error:v,disabled:d})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs(I,{htmlFor:s.key,className:"text-sm font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]}),e.jsx(we,{id:s.key,checked:!!r,onCheckedChange:l,disabled:d})]}),v&&e.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(re,{className:"h-3 w-3"}),v]})]}),Oe=({title:s,description:r,settingKey:l,fields:v=[],defaultOpen:d=!1,disabled:p=!1,className:b="",onFieldChange:S,showSaveButton:E=!1,showResetButton:x=!1})=>{const[g,j]=c.useState(d),[C,B]=c.useState(!1),{settings:_,updateSettings:N,updateSectionLocal:L,saving:R,error:i,validationErrors:A,logInfo:y,saveImmediately:de,defaultSettings:W}=Re(),F=_[l]||{},U=c.useMemo(()=>{const D={};return Object.entries(A).forEach(([G,Y])=>{if(G.startsWith(`${l}.`)){const me=G.replace(`${l}.`,"");D[me]=Y}}),D},[A,l]),le=Object.keys(U).length>0,k=c.useCallback((D,G)=>{y(`SettingBox 필드 변경: ${l}.${D}`,{oldValue:F[D],newValue:G});const Y={...F,[D]:G};E?L(l,Y):N({[l]:Y}),S==null||S(D,G,Y),B(!0)},[l,F,N,S,y]),P=c.useCallback(async()=>{y(`SettingBox 즉시 저장: ${l}`),await de()},[de,y,l]),Q=c.useCallback(()=>{y(`SettingBox 초기화: ${l}`);const D=W[l]||{};N({[l]:D}),B(!1)},[l,N,W,y]),ne=c.useCallback(D=>{const G=F[D.key],Y=C?U[D.key]:null,ce={field:D,value:G,onChange:xe=>k(D.key,xe),error:Y,disabled:p||R};switch(D.type){case"text":case"number":return e.jsx(Us,{...ce},D.key);case"select":return e.jsx(Ys,{...ce},D.key);case"multiselect":return e.jsx(Xs,{...ce},D.key);case"switch":case"checkbox":return e.jsx(Ws,{...ce},D.key);default:return e.jsxs("div",{className:"text-sm text-muted-foreground",children:["지원하지 않는 필드 타입: ",D.type]},D.key)}},[F,U,C,p,R,k]);return e.jsx(K,{className:`w-full ${b}`,children:e.jsxs(ts,{open:g,onOpenChange:j,children:[e.jsx(rs,{asChild:!0,children:e.jsx(ae,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(te,{className:"text-lg flex items-center gap-2",children:[s,R&&e.jsxs(z,{variant:"secondary",className:"text-xs",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"저장 중"]}),C&&le&&e.jsxs(z,{variant:"destructive",className:"text-xs",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"오류"]}),C&&!le&&!R&&e.jsxs(z,{variant:"default",className:"text-xs",children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"유효"]})]}),r&&e.jsx(Ie,{children:r})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(z,{variant:"outline",className:"text-xs",children:[v.length,"개 설정"]}),g?e.jsx(Qe,{className:"h-4 w-4"}):e.jsx(Ke,{className:"h-4 w-4"})]})]})})}),e.jsx(ls,{children:e.jsxs(ee,{className:"space-y-6",children:[i&&e.jsxs(ns,{variant:"destructive",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(cs,{children:i})]}),v.length>0?e.jsx("div",{className:"space-y-4",children:v.map(ne)}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"설정할 수 있는 항목이 없습니다."}),(E||x||le)&&e.jsxs(e.Fragment,{children:[e.jsx($e,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:x&&e.jsxs(T,{variant:"outline",size:"sm",onClick:Q,disabled:p||R,children:[e.jsx(ze,{className:"h-4 w-4 mr-1"}),"초기화"]})}),e.jsx("div",{className:"flex items-center gap-2",children:E&&e.jsxs(T,{size:"sm",onClick:P,disabled:p||R||le,children:[e.jsx(Es,{className:"h-4 w-4 mr-1"}),"저장"]})})]})]})]})})]})})};function Qs({className:s,value:r,...l}){return e.jsx(Ns,{"data-slot":"progress",className:$("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...l,children:e.jsx(ys,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})})}const Ae=[{key:"dashboardSettings",label:"Dashboard 설정",description:"선택된 PEG, 차트 스타일, 새로고침 간격 등"},{key:"statisticsSettings",label:"Statistics 설정",description:"기본 날짜 범위, 비교 옵션, 소수점 자릿수 등"},{key:"derivedPegSettings",label:"Derived PEG 설정",description:"사용자 정의 수식, 활성화 상태, 계산 정밀도 등"},{key:"notificationSettings",label:"알림 설정",description:"토스트, 사운드, 알림 타입 설정"},{key:"generalSettings",label:"일반 설정",description:"언어, 시간대, 날짜 형식 등"}],Ks=({title:s="설정 백업 & 복원",description:r="설정을 JSON 파일로 내보내거나 가져올 수 있습니다",defaultOpen:l=!1,className:v=""})=>{const[d,p]=c.useState(l),[b,S]=c.useState(!1),[E,x]=c.useState(!1),[g,j]=c.useState(0),[C,B]=c.useState(!1),[_,N]=c.useState(null),[L,R]=c.useState(null),[i,A]=c.useState(Ae.reduce((a,t)=>({...a,[t.key]:!0}),{})),[y,de]=c.useState(""),W=c.useRef(null),{settings:F,exportSettings:U,importSettings:le,hasUnsavedChanges:k,saving:P,logInfo:Q,logError:ne}=Re(),D=c.useCallback(async(a="full")=>{x(!0),N(null);try{Q("설정 내보내기 시작",{exportType:a,customFileName:y});let t=F;if(a==="partial"){const h=Object.entries(i).filter(([q,X])=>X).map(([q])=>q);if(h.length===0){Z.error("내보낼 설정 섹션을 하나 이상 선택해주세요");return}t=h.reduce((q,X)=>(F[X]&&(q[X]=F[X]),q),{}),Q("부분 내보내기 선택된 섹션",h)}const n=new Date().toISOString().split("T")[0],m=y.trim()||(a==="partial"?`preference-settings-partial-${n}.json`:`preference-settings-${n}.json`);await U(m,t)&&(Z.success(`설정이 "${m}" 파일로 내보내졌습니다`),de(""))}catch(t){ne("설정 내보내기 실패",t),Z.error("설정 내보내기 실패: "+t.message)}finally{x(!1)}},[F,i,y,U,Q,ne]),G=c.useCallback(async a=>{if(a){S(!0),j(0),N(null);try{if(Q("설정 가져오기 시작",{fileName:a.name,fileSize:a.size}),!a.name.toLowerCase().endsWith(".json"))throw new Error("JSON 파일만 지원됩니다");if(a.size>5*1024*1024)throw new Error("파일 크기가 너무 큽니다 (최대 5MB)");j(20);const t=await le(a);j(80),R({name:a.name,size:a.size,importedAt:new Date,sectionsCount:Object.keys(t).length}),j(100),Q("설정 가져오기 완료",{fileName:a.name,sectionsImported:Object.keys(t).length}),Z.success(`"${a.name}"에서 설정을 성공적으로 가져왔습니다`)}catch(t){ne("설정 가져오기 실패",t),N(t.message),Z.error("설정 가져오기 실패: "+t.message)}finally{S(!1),setTimeout(()=>{j(0)},3e3)}}},[le,Q,ne]),Y=c.useCallback(a=>{const t=a.target.files[0];t&&(G(t),a.target.value="")},[G]),me=c.useCallback(a=>{a.preventDefault(),B(!0)},[]),ce=c.useCallback(a=>{a.preventDefault(),B(!1)},[]),xe=c.useCallback(a=>{a.preventDefault(),B(!1);const t=a.dataTransfer.files;t.length>0&&G(t[0])},[G]),ge=c.useCallback(a=>{A(t=>({...t,[a]:!t[a]}))},[]),ue=c.useCallback(()=>{const a=Object.values(i).every(Boolean),t=Ae.reduce((n,m)=>({...n,[m.key]:!a}),{});A(t)},[i]);return e.jsx(K,{className:`w-full ${v}`,children:e.jsxs(ts,{open:d,onOpenChange:p,children:[e.jsx(rs,{asChild:!0,children:e.jsx(ae,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(te,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ps,{className:"h-5 w-5"}),s,b&&e.jsxs(z,{variant:"secondary",className:"text-xs",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"가져오는 중"]}),E&&e.jsxs(z,{variant:"secondary",className:"text-xs",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"내보내는 중"]}),k&&e.jsxs(z,{variant:"outline",className:"text-xs",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"저장되지 않은 변경사항"]})]}),r&&e.jsx(Ie,{children:r})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[L&&e.jsxs(z,{variant:"default",className:"text-xs",children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"가져옴"]}),d?e.jsx(Qe,{className:"h-4 w-4"}):e.jsx(Ke,{className:"h-4 w-4"})]})]})})}),e.jsx(ls,{children:e.jsxs(ee,{className:"space-y-6",children:[_&&e.jsxs(ns,{variant:"destructive",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(cs,{children:_})]}),b&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"파일 가져오는 중..."}),e.jsxs("span",{children:[g,"%"]})]}),e.jsx(Qs,{value:g,className:"h-2"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(Os,{className:"h-4 w-4"}),"설정 가져오기"]}),e.jsx("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${C?"border-primary bg-primary/5":b?"border-muted bg-muted/20":"border-muted-foreground/25 hover:border-muted-foreground/50"}`,onDragOver:me,onDragLeave:ce,onDrop:xe,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(As,{className:`h-8 w-8 mx-auto ${C?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:`text-sm font-medium ${C?"text-primary":""}`,children:C?"파일을 여기에 놓으세요":"JSON 파일을 드래그하거나 클릭하여 선택하세요"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"최대 5MB, .json 파일만 지원"})]}),e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>{var a;return(a=W.current)==null?void 0:a.click()},disabled:b,className:"mt-2",children:[e.jsx(Is,{className:"h-4 w-4 mr-2"}),"파일 선택"]})]})}),e.jsx("input",{ref:W,type:"file",accept:".json",onChange:Y,style:{display:"none"}}),L&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(be,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium",children:"마지막 가져온 파일:"}),e.jsx("span",{children:L.name}),e.jsxs(z,{variant:"secondary",className:"text-xs",children:[L.sectionsCount,"개 섹션"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:L.importedAt.toLocaleString()})]})]}),e.jsx($e,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"설정 내보내기"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"fileName",className:"text-sm",children:"파일명 (선택사항)"}),e.jsx(ve,{id:"fileName",value:y,onChange:a=>de(a.target.value),placeholder:"preference-settings-custom.json",disabled:E}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"비워두면 자동으로 날짜가 포함된 파일명이 생성됩니다"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(I,{className:"text-sm font-medium",children:"내보낼 설정 선택"}),e.jsx(T,{variant:"outline",size:"sm",onClick:ue,disabled:E,children:Object.values(i).every(Boolean)?"전체 해제":"전체 선택"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:Ae.map(a=>e.jsxs("div",{className:"flex items-start space-x-2 p-2 rounded border",children:[e.jsx(as,{id:a.key,checked:i[a.key],onCheckedChange:()=>ge(a.key),disabled:E}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(I,{htmlFor:a.key,className:"text-sm font-medium cursor-pointer",children:a.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.description})]})]},a.key))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(T,{onClick:()=>D("full"),disabled:E||P,className:"flex-1",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"전체 설정 내보내기"]}),e.jsxs(T,{variant:"outline",onClick:()=>D("partial"),disabled:E||P||Object.values(i).every(a=>!a),className:"flex-1",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"선택된 설정만 내보내기"]})]}),Object.values(i).every(a=>!a)&&e.jsx("p",{className:"text-xs text-destructive",children:"내보낼 설정 섹션을 하나 이상 선택해주세요"})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"현재 설정 상태"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:Ae.map(a=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[a.label,":"]}),e.jsx("span",{className:"text-muted-foreground",children:F[a.key]?"설정됨":"기본값"})]},a.key))}),k&&e.jsxs("p",{className:"text-xs text-amber-600 mt-2 flex items-center gap-1",children:[e.jsx(re,{className:"h-3 w-3"}),"저장되지 않은 변경사항이 있습니다"]})]})]})})]})})};function ea({className:s,...r}){return e.jsx("textarea",{"data-slot":"textarea",className:$("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...r})}function Ye({className:s,children:r,...l}){return e.jsxs(Ss,{"data-slot":"scroll-area",className:$("relative",s),...l,children:[e.jsx(ws,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:r}),e.jsx(sa,{}),e.jsx(Cs,{})]})}function sa({className:s,orientation:r="vertical",...l}){return e.jsx(ks,{"data-slot":"scroll-area-scrollbar",orientation:r,className:$("flex touch-none p-px transition-colors select-none",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",s),...l,children:e.jsx(Ds,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}const H={IDLE:"idle",SAVING:"saving",SAVED:"saved",ERROR:"error"},Xe=({status:s=H.IDLE,message:r,error:l,className:v,variant:d="default",showIcon:p=!0,showText:b=!0,autoHide:S=!0,autoHideDuration:E=3e3,onHide:x})=>{const[g,j]=oe.useState(!0),[C,B]=oe.useState(!1);if(oe.useEffect(()=>{if(S&&s===H.SAVED&&g){B(!0);const R=setTimeout(()=>{j(!1),B(!1),x&&x()},E);return()=>clearTimeout(R)}},[s,S,E,g,x]),s===H.IDLE||!g)return null;const N=(()=>{switch(s){case H.SAVING:return{icon:ss,text:r||"저장 중...",variant:"secondary",iconClass:"animate-spin text-blue-600",bgClass:"bg-blue-50 border-blue-200"};case H.SAVED:return{icon:es,text:r||"저장 완료!",variant:"default",iconClass:"text-green-600",bgClass:"bg-green-50 border-green-200"};case H.ERROR:return{icon:re,text:r||l||"저장 실패",variant:"destructive",iconClass:"text-red-600",bgClass:"bg-red-50 border-red-200"};default:return{icon:Ne,text:r||"대기 중",variant:"outline",iconClass:"text-gray-600",bgClass:"bg-gray-50 border-gray-200"}}})(),L=N.icon;return d==="compact"?e.jsxs("div",{className:$("flex items-center gap-2 px-2 py-1 rounded-md text-sm",N.bgClass,C&&"animate-pulse",v),children:[p&&e.jsx(L,{className:$("h-3 w-3",N.iconClass)}),b&&e.jsx("span",{className:"text-xs font-medium",children:N.text})]}):d==="icon-only"?e.jsx("div",{className:$("flex items-center justify-center p-1 rounded-full",N.bgClass,C&&"animate-pulse",v),children:e.jsx(L,{className:$("h-4 w-4",N.iconClass)})}):e.jsxs(z,{variant:N.variant,className:$("flex items-center gap-2 px-3 py-1.5 transition-all duration-300",C&&"animate-pulse scale-105",v),children:[p&&e.jsx(L,{className:$("h-4 w-4",N.iconClass)}),b&&e.jsx("span",{className:"font-medium",children:N.text})]})},aa=(s=H.IDLE)=>{const[r,l]=oe.useState(s),[v,d]=oe.useState(""),[p,b]=oe.useState(""),S=oe.useCallback(j=>{l(H.SAVING),d(j||""),b("")},[]),E=oe.useCallback(j=>{l(H.SAVED),d(j||""),b("")},[]),x=oe.useCallback(j=>{l(H.ERROR),d(""),b(j||"")},[]),g=oe.useCallback(()=>{l(H.IDLE),d(""),b("")},[]);return{status:r,message:v,error:p,showSaving:S,showSaved:E,showError:x,reset:g,isSaving:r===H.SAVING,isSaved:r===H.SAVED,isError:r===H.ERROR,isIdle:r===H.IDLE}},ta=({className:s,variant:r="compact",showToast:l=!0,showInlineStatus:v=!0,position:d="top-right",autoHide:p=!0,customMessages:b={}})=>{const{saving:S,error:E,lastSaved:x,hasUnsavedChanges:g,localStorageAvailable:j,syncStatus:C}=We(),{status:B,message:_,error:N,showSaving:L,showSaved:R,showError:i,reset:A}=aa();if(c.useEffect(()=>{if(S){const y=b.saving||(C==="syncing"?"서버와 동기화 중...":"설정 저장 중...");L(y),l&&Z.loading(y,{id:"settings-save"})}else if(E){const y=b.error||E;i(y),l&&Z.error(y,{id:"settings-save",duration:5e3,action:j?void 0:{label:"새로고침",onClick:()=>window.location.reload()}})}else if(x&&!g&&!S){const y=b.saved||"설정이 저장되었습니다!";R(y),l&&Z.success(y,{id:"settings-save",duration:3e3})}},[S,E,x,g,C,j,L,R,i,l,b]),!v)return null;if(d!=="inline"){const y={"top-right":"fixed top-4 right-4 z-50","bottom-right":"fixed bottom-4 right-4 z-50","top-left":"fixed top-4 left-4 z-50","bottom-left":"fixed bottom-4 left-4 z-50"};return e.jsx("div",{className:$(y[d],s),children:e.jsx(Xe,{status:B,message:_,error:N,variant:r,autoHide:p,onHide:A})})}return e.jsx(Xe,{status:B,message:_,error:N,variant:r,autoHide:p,onHide:A,className:s})},ra=({derivedPegSettings:s,updateDerivedPegSettings:r,availablePegs:l=[],saving:v=!1,dashboardSettings:d,updateDashboardSettings:p})=>{var ue;const{saveSettings:b,hasUnsavedChanges:S,error:E,saving:x,lastSaved:g,settings:j}=We(),[C,B]=c.useState(!1),[_,N]=c.useState(g?new Date(g):null);c.useEffect(()=>{g&&!_&&N(new Date(g))},[g,_]);const[L,R]=c.useState(null),[i,A]=c.useState(null),[y,de]=c.useState(""),[W,F]=c.useState(null),[U,le]=c.useState(null),k=(s==null?void 0:s.formulas)||[],P=(s==null?void 0:s.settings)||{autoValidate:!1,showInDashboard:!1,showInStatistics:!1,evaluationPrecision:4};c.useEffect(()=>{console.log("[DerivedPegManager] 현재 설정 상태:",{formulasCount:k.length,settings:P,hasUnsavedChanges:S,saving:x,isAutoSaving:C,lastSavedAt:_==null?void 0:_.toISOString()})},[k.length,P,S,x,C,_]),c.useEffect(()=>{const t=setTimeout(async()=>{if(s&&Object.keys(s).length>0&&S){B(!0);try{const n={...j,derivedPegSettings:s},m="kpi-dashboard-preferences",f={settings:n,lastSaved:new Date().toISOString(),version:1};localStorage.setItem(m,JSON.stringify(f)),N(new Date)}catch(n){console.error("Auto-save failed:",n),Z.error("자동 저장 실패: "+n.message)}finally{B(!1)}}},1e3);return()=>clearTimeout(t)},[s,j,S]);const Q=[{id:"success_rate",name:"Success Rate (%)",formula:"(success_count / total_count) * 100",description:"성공률 계산 템플릿",category:"percentage"},{id:"efficiency",name:"Efficiency (%)",formula:"(good_values / all_values) * 100",description:"효율성 계산 템플릿",category:"percentage"},{id:"delta",name:"Delta Calculation",formula:"current_value - previous_value",description:"변화량 계산 템플릿",category:"difference"},{id:"ratio",name:"Simple Ratio",formula:"numerator / denominator",description:"단순 비율 계산 템플릿",category:"ratio"}],ne=[{symbol:"+",name:"더하기",example:"a + b"},{symbol:"-",name:"빼기",example:"a - b"},{symbol:"*",name:"곱하기",example:"a * b"},{symbol:"/",name:"나누기",example:"a / b"},{symbol:"%",name:"나머지",example:"a % b"},{symbol:"^",name:"거듭제곱",example:"a ^ 2"},{symbol:"()",name:"괄호",example:"(a + b) * c"},{symbol:"sqrt()",name:"제곱근",example:"sqrt(a)"},{symbol:"log()",name:"로그",example:"log(a)"},{symbol:"abs()",name:"절댓값",example:"abs(a)"},{symbol:"min()",name:"최솟값",example:"min(a, b)"},{symbol:"max()",name:"최댓값",example:"max(a, b)"}],D=c.useMemo(()=>y?k.filter(a=>{var t;return a.name.toLowerCase().includes(y.toLowerCase())||a.formula.toLowerCase().includes(y.toLowerCase())||((t=a.description)==null?void 0:t.toLowerCase().includes(y.toLowerCase()))}):k,[k,y]),G=c.useCallback(a=>{try{const t=[],n=[],m=(a.match(/\(/g)||[]).length,f=(a.match(/\)/g)||[]).length;m!==f&&t.push("괄호가 일치하지 않습니다");const h=a.replace(/\$\{[^}]+\}/g," ").match(/[a-zA-Z_][a-zA-Z0-9_]*/g)||[],q=[...l.map(J=>J.value),...k.filter(J=>J.active).map(J=>J.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase())],X=h.filter(J=>!q.includes(J)&&!["sqrt","log","abs","min","max","if"].includes(J));if(X.length>0&&n.push(`알 수 없는 PEG: ${X.join(", ")}`),i){const J=i.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase();h.includes(J)&&t.push("수식이 자기 자신을 참조할 수 없습니다 (순환 참조)")}const ye=a.replace(/\$\{[^}]+\}/g,"").match(/[^a-zA-Z0-9_+\-*/()^%.,\s]/g);ye&&t.push(`지원하지 않는 문자: ${ye.join(", ")}`);const De=h.filter(J=>l.some(he=>he.value===J)),Ee=h.filter(J=>k.some(he=>he.active&&he.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()===J));return{isValid:t.length===0,errors:t,warnings:n,dependencies:De,derivedDependencies:Ee}}catch{return{isValid:!1,errors:["수식 분석 중 오류가 발생했습니다"],warnings:[],dependencies:[],derivedDependencies:[]}}},[l,k,i]),Y=c.useCallback(a=>{try{const t={};l.forEach(f=>{t[f.value]=Math.random()*100+50});let n=a;Object.keys(t).forEach(f=>{const h=new RegExp(`\\b${f}\\b`,"g");n=n.replace(h,t[f].toString())}),n=n.replace(/sqrt\(([^)]+)\)/g,"Math.sqrt($1)"),n=n.replace(/log\(([^)]+)\)/g,"Math.log($1)"),n=n.replace(/abs\(([^)]+)\)/g,"Math.abs($1)"),n=n.replace(/\^/g,"**");const m=Function(`"use strict"; return (${n})`)();return{success:!0,result:Number(m).toFixed(P.evaluationPrecision||4),mockData:t}}catch(t){return{success:!1,error:t.message}}},[l,P.evaluationPrecision]),me=()=>{const a={id:`formula_${Date.now()}`,name:"새 수식",formula:"",description:"",active:!0,category:"custom",unit:"",dependencies:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};A(a),R(a.id)},ce=async()=>{if(!i)return;console.log("[handleSaveFormula] 저장 시작",{editingFormula:i});const a=G(i.formula);if(!a.isValid){Z.error(`수식 저장 실패: ${a.errors.join(", ")}`);return}const t={...i,dependencies:a.dependencies,derivedDependencies:a.derivedDependencies||[],updatedAt:new Date().toISOString()};console.log("[handleSaveFormula] 업데이트된 수식",{updatedFormula:t});const n=k.findIndex(h=>h.id===i.id);let m;n>=0?(m=[...k],m[n]=t,console.log("[handleSaveFormula] 기존 수식 업데이트",{existingIndex:n,updatedFormula:t})):(m=[...k,t],console.log("[handleSaveFormula] 새 수식 추가",{updatedFormula:t}));const f={...s,formulas:m};if(console.log("[handleSaveFormula] 새로운 설정",{newDerivedSettings:f}),r(f),P.showInDashboard&&t.active){const h=t.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),q=(d==null?void 0:d.selectedPegs)||[];q.includes(h)||(console.log("[handleSaveFormula] Dashboard selectedPegs 업데이트",{derivedPegName:h}),p({selectedPegs:[...q,h]}))}try{console.log("[handleSaveFormula] 즉시 localStorage 저장 시작");const h={...j,derivedPegSettings:f},q="kpi-dashboard-preferences",X={settings:h,lastSaved:new Date().toISOString(),version:1};localStorage.setItem(q,JSON.stringify(X)),console.log("[handleSaveFormula] localStorage에 직접 저장 완료",X),A(null),N(new Date),Z.success("수식이 저장되었습니다"),console.log("[handleSaveFormula] 저장 성공 및 편집 모드 종료")}catch(h){console.error("[handleSaveFormula] 저장 실패",h),Z.error("저장 실패: "+h.message)}},xe=async a=>{const t=k.find(m=>m.id===a),n=k.filter(m=>m.id!==a);if(r({...s,formulas:n}),t&&t.active){const m=t.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),f=(d==null?void 0:d.selectedPegs)||[],h=f.filter(q=>q!==m);h.length!==f.length&&p({selectedPegs:h})}L===a&&R(null),(i==null?void 0:i.id)===a&&A(null);try{const m={...j,derivedPegSettings:{...s,formulas:n}},f="kpi-dashboard-preferences",h={settings:m,lastSaved:new Date().toISOString(),version:1};localStorage.setItem(f,JSON.stringify(h)),N(new Date)}catch(m){console.error("Auto-save failed:",m)}Z.success("수식이 삭제되었습니다")},ge=a=>{i&&(A({...i,formula:a.formula,description:a.description,category:a.category}),Z.success(`템플릿 "${a.name}"이 적용되었습니다`))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(K,{children:[e.jsx(ae,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),"Derived PEG 관리",C&&e.jsxs(z,{variant:"secondary",className:"text-xs animate-pulse",children:[e.jsx(Loader2,{className:"h-3 w-3 mr-1 animate-spin"}),"자동 저장 중..."]})]}),_&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["마지막 저장: ",_.toLocaleString("ko-KR")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ta,{position:"inline",variant:"compact",showToast:!1,className:"mr-2"}),(S||x||C)&&e.jsx(T,{onClick:async()=>{try{const a={...j,derivedPegSettings:s},t="kpi-dashboard-preferences",n={settings:a,lastSaved:new Date().toISOString(),version:1};localStorage.setItem(t,JSON.stringify(n)),N(new Date),Z.success("Derived PEG 설정이 저장되었습니다")}catch(a){Z.error("저장 실패: "+a.message)}},disabled:x||C,size:"sm",className:"h-8",children:x||C?e.jsxs(e.Fragment,{children:[e.jsx(Loader2,{className:"h-3 w-3 mr-1 animate-spin"}),"저장 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"저장"]})}),!1]})]})}),e.jsx(ee,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{id:"auto-validate",checked:P.autoValidate,onCheckedChange:async a=>{const t={...s,settings:{...P,autoValidate:a}};r(t);try{const n={...j,derivedPegSettings:newDerivedSettings},m="kpi-dashboard-preferences",f={settings:n,lastSaved:new Date().toISOString(),version:1};localStorage.setItem(m,JSON.stringify(f)),N(new Date)}catch(n){console.error("Auto-save failed:",n)}}}),e.jsx(I,{htmlFor:"auto-validate",children:"실시간 검증"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{id:"show-dashboard",checked:P.showInDashboard,onCheckedChange:async a=>{const t={...s,settings:{...P,showInDashboard:a}};if(r(t),a){const n=k.filter(h=>h.active).map(h=>h.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()),m=(d==null?void 0:d.selectedPegs)||[],f=[...new Set([...m,...n])];p({selectedPegs:f})}else{const n=k.filter(h=>h.active).map(h=>h.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()),f=((d==null?void 0:d.selectedPegs)||[]).filter(h=>!n.includes(h));p({selectedPegs:f})}try{const n={...j,derivedPegSettings:t},m="kpi-dashboard-preferences",f={settings:n,lastSaved:new Date().toISOString(),version:1};localStorage.setItem(m,JSON.stringify(f)),N(new Date)}catch(n){console.error("Auto-save failed:",n)}}}),e.jsx(I,{htmlFor:"show-dashboard",children:"Dashboard에 표시"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{id:"show-statistics",checked:P.showInStatistics,onCheckedChange:async a=>{const t={...s,settings:{...P,showInStatistics:a}};r(t);try{const n={...j,derivedPegSettings:newDerivedSettings},m="kpi-dashboard-preferences",f={settings:n,lastSaved:new Date().toISOString(),version:1};localStorage.setItem(m,JSON.stringify(f)),N(new Date)}catch(n){console.error("Auto-save failed:",n)}}}),e.jsx(I,{htmlFor:"show-statistics",children:"Statistics에 표시"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"계산 정밀도"}),e.jsxs(Le,{value:(ue=P.evaluationPrecision)==null?void 0:ue.toString(),onValueChange:async a=>{const t={...s,settings:{...P,evaluationPrecision:parseInt(a)}};r(t);try{const n={...j,derivedPegSettings:newDerivedSettings},m="kpi-dashboard-preferences",f={settings:n,lastSaved:new Date().toISOString(),version:1};localStorage.setItem(m,JSON.stringify(f)),N(new Date)}catch(n){console.error("Auto-save failed:",n)}},children:[e.jsx(Te,{children:e.jsx(_e,{})}),e.jsxs(Ge,{children:[e.jsx(ie,{value:"2",children:"소수점 2자리"}),e.jsx(ie,{value:"4",children:"소수점 4자리"}),e.jsx(ie,{value:"6",children:"소수점 6자리"})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(K,{children:[e.jsxs(ae,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{children:"수식 목록"}),e.jsxs(T,{onClick:me,size:"sm",children:[e.jsx(Fs,{className:"h-4 w-4 mr-2"}),"새 수식"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ls,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ve,{placeholder:"수식 검색...",className:"pl-8",value:y,onChange:a=>de(a.target.value)})]})]}),e.jsx(ee,{children:e.jsx(Ye,{className:"h-96",children:e.jsx("div",{className:"space-y-2",children:D.map(a=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${L===a.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>R(a.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:a.name}),e.jsx(z,{variant:a.active?"default":"secondary",className:"text-xs",children:a.active?"활성":"비활성"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:a.formula}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(z,{variant:"outline",className:"text-xs",children:a.category}),a.unit&&e.jsx(z,{variant:"outline",className:"text-xs",children:a.unit})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx(T,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),A({...a})},children:e.jsx(He,{className:"h-3 w-3"})}),e.jsx(T,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),xe(a.id)},children:e.jsx(Ts,{className:"h-3 w-3"})})]})]})},a.id))})})})]}),e.jsxs(K,{children:[e.jsx(ae,{children:e.jsx(te,{children:i?"수식 편집":"수식 상세"})}),e.jsx(ee,{children:i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"formula-name",children:"수식 이름"}),e.jsx(ve,{id:"formula-name",value:i.name,onChange:a=>A({...i,name:a.target.value}),placeholder:"예: RACH Success Rate (%)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"formula-input",children:"수식"}),e.jsx(ea,{id:"formula-input",value:i.formula,onChange:a=>{A({...i,formula:a.target.value}),P.autoValidate&&F(G(a.target.value))},placeholder:"예: (randomaccesspremable / randomaccessresponse) * 100",className:"font-mono text-sm",rows:4}),W&&e.jsxs("div",{className:"space-y-2",children:[W.isValid?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(es,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"수식이 유효합니다"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:W.errors.join(", ")})]}),W.warnings.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:W.warnings.join(", ")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"formula-description",children:"설명"}),e.jsx(ve,{id:"formula-description",value:i.description,onChange:a=>A({...i,description:a.target.value}),placeholder:"수식에 대한 설명을 입력하세요"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"formula-category",children:"카테고리"}),e.jsxs(Le,{value:i.category,onValueChange:a=>A({...i,category:a}),children:[e.jsx(Te,{children:e.jsx(_e,{})}),e.jsxs(Ge,{children:[e.jsx(ie,{value:"percentage",children:"비율 (%)"}),e.jsx(ie,{value:"success_rate",children:"성공률"}),e.jsx(ie,{value:"efficiency",children:"효율성"}),e.jsx(ie,{value:"quality",children:"품질"}),e.jsx(ie,{value:"performance",children:"성능"}),e.jsx(ie,{value:"custom",children:"사용자 정의"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"formula-unit",children:"단위"}),e.jsx(ve,{id:"formula-unit",value:i.unit,onChange:a=>A({...i,unit:a.target.value}),placeholder:"예: %, ms, Mbps"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{id:"formula-active",checked:i.active,onCheckedChange:a=>{if(A({...i,active:a}),P.showInDashboard){const t=i.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),n=(d==null?void 0:d.selectedPegs)||[];if(a)n.includes(t)||p({selectedPegs:[...n,t]});else{const m=n.filter(f=>f!==t);m.length!==n.length&&p({selectedPegs:m})}}}}),e.jsx(I,{htmlFor:"formula-active",children:"수식 활성화"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{onClick:()=>{const a=G(i.formula);F(a);const t=Y(i.formula);le(t)},children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"테스트"]}),e.jsxs(T,{onClick:ce,disabled:x,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"저장"]}),e.jsxs(T,{variant:"outline",onClick:()=>A(null),children:[e.jsx(Gs,{className:"h-4 w-4 mr-2"}),"취소"]})]}),U&&e.jsxs("div",{className:"space-y-2",children:[e.jsx($e,{}),e.jsx("h4",{className:"font-medium",children:"테스트 결과"}),U.success?e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-700",children:e.jsxs("strong",{children:["결과: ",U.result]})}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"모의 데이터를 사용한 계산 결과입니다"})]}):e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700",children:["오류: ",U.error]})})]})]}):L?e.jsx("div",{className:"space-y-4",children:(()=>{const a=k.find(t=>t.id===L);return a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"수식"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg font-mono text-sm",children:a.formula})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{className:"text-xs",children:"카테고리"}),e.jsx("p",{className:"text-sm",children:a.category})]}),e.jsxs("div",{children:[e.jsx(I,{className:"text-xs",children:"단위"}),e.jsx("p",{className:"text-sm",children:a.unit||"없음"})]})]}),(a.dependencies&&a.dependencies.length>0||a.derivedDependencies&&a.derivedDependencies.length>0)&&e.jsxs("div",{className:"space-y-2",children:[a.dependencies&&a.dependencies.length>0&&e.jsxs("div",{children:[e.jsxs(I,{className:"text-xs flex items-center gap-1",children:[e.jsx(ke,{className:"h-3 w-3"}),"기본 PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:a.dependencies.map(t=>e.jsx(z,{variant:"outline",className:"text-xs",children:t},t))})]}),a.derivedDependencies&&a.derivedDependencies.length>0&&e.jsxs("div",{children:[e.jsxs(I,{className:"text-xs flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3"}),"Derived PEG 의존성"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:a.derivedDependencies.map(t=>e.jsx(z,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:t},t))})]})]}),e.jsxs(T,{onClick:()=>A({...a}),className:"w-full",children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"편집"]})]}):e.jsx("p",{children:"수식을 찾을 수 없습니다."})})()}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(pe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"수식을 선택하거나 새로 만들어보세요"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(K,{children:[e.jsx(ae,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"h-5 w-5"}),"템플릿 라이브러리"]})}),e.jsx(ee,{children:e.jsx("div",{className:"space-y-2",children:Q.map(a=>e.jsx("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>ge(a),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:a.name}),e.jsx("p",{className:"text-xs font-mono text-muted-foreground",children:a.formula}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),e.jsx(T,{variant:"ghost",size:"sm",children:e.jsx(Rs,{className:"h-3 w-3"})})]})},a.id))})})]}),e.jsxs(K,{children:[e.jsx(ae,{children:e.jsx(te,{children:"지원 연산자"})}),e.jsx(ee,{children:e.jsx(Ye,{className:"h-64",children:e.jsx("div",{className:"space-y-2",children:ne.map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("code",{className:"font-mono font-medium",children:a.symbol}),e.jsx("span",{className:"text-sm text-muted-foreground ml-2",children:a.name})]}),e.jsx("code",{className:"text-xs text-muted-foreground",children:a.example})]},t))})})})]})]}),e.jsxs(K,{children:[e.jsxs(ae,{children:[e.jsx(te,{children:"사용 가능한 PEG"}),e.jsx(Ie,{children:"수식에 사용할 수 있는 기본 PEG와 생성된 Derived PEG 목록입니다"})]}),e.jsx(ee,{children:e.jsxs("div",{className:"space-y-4",children:[l.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"기본 PEG (",l.length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.map(a=>e.jsx(T,{variant:"outline",size:"sm",onClick:()=>{i&&A({...i,formula:i.formula+a.value})},className:"text-xs",children:a.label||a.value},a.value))})]}),k.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Derived PEG (",k.filter(a=>a.active).length,"개)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.filter(a=>a.active).map(a=>e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>{if(i){const t=`${a.name.replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase()}`;A({...i,formula:i.formula+t})}},className:"text-xs bg-blue-50 border-blue-200 hover:bg-blue-100",title:a.description,children:[e.jsx(pe,{className:"h-3 w-3 mr-1"}),a.name,a.unit&&e.jsxs("span",{className:"ml-1 text-muted-foreground",children:["(",a.unit,")"]})]},a.id))}),k.filter(a=>a.active).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(pe,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"아직 생성된 Derived PEG가 없습니다"}),e.jsx("p",{className:"text-xs",children:"새 수식을 추가하고 활성화하면 여기에 표시됩니다"})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm text-blue-700 mb-1",children:"💡 사용법"}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"• 기본 PEG: 클릭하면 수식에 바로 삽입됩니다"}),e.jsx("li",{children:"• Derived PEG: 다른 수식에서 참조할 수 있는 계산된 값입니다"}),e.jsx("li",{children:"• 비활성화된 Derived PEG는 목록에 표시되지 않습니다"}),e.jsx("li",{children:"• Derived PEG끼리 순환 참조하지 않도록 주의하세요"})]})]})]})})]})]})},la=()=>{var xe,ge,ue,a,t,n,m,f,h,q,X,ye,De,Ee,J,he,Be,Ve,Me,qe,Je,Ze;const{settings:s,isLoading:r,isSaving:l,error:v,lastSaved:d,updateSettings:p,saveSettings:b,resetSettings:S}=Re(),{settings:E,updateSettings:x}=os(),[g,j]=c.useState([]),[C,B]=c.useState(!1),[_,N]=c.useState(null),L=c.useCallback(async()=>{var o,O,u;try{B(!0),console.info("[PreferenceManager] Fetching DB PEGs");const V=(s==null?void 0:s.databaseSettings)||{};if(!V.host){console.warn("[PreferenceManager] No DB config found");return}const w=((o=s==null?void 0:s.dashboardSettings)==null?void 0:o.pegLimit)||1e4,M=await Se.post("/api/master/pegs",{host:String(V.host).trim(),port:Number(V.port)||5432,user:String(V.user||"").trim(),password:String(V.password||"").trim(),dbname:String(V.dbname||"").trim(),table:String(V.table||"summary").trim(),limit:w}),Pe=((O=M==null?void 0:M.data)==null?void 0:O.pegs)||(Array.isArray((u=M==null?void 0:M.data)==null?void 0:u.items)?M.data.items.map(se=>({id:se,name:se})):Array.isArray(M==null?void 0:M.data)?M.data.map(se=>({id:se,name:se})):[]);console.info("[PreferenceManager] DB PEGs loaded:",Pe.length);const is=Pe.map(se=>({value:se.id||se.name||se.peg_name,label:String(se.name||se.id||se.peg_name)}));j(is),N(new Date)}catch(V){console.error("[PreferenceManager] Error fetching DB PEGs:",V)}finally{B(!1)}},[s==null?void 0:s.databaseSettings,(xe=s==null?void 0:s.dashboardSettings)==null?void 0:xe.pegLimit]),R=c.useCallback(()=>{const o=ds(g);return console.log("✅ 최종 PEG 옵션:",o),o},[g]),i=JSON.stringify({host:(ge=s==null?void 0:s.databaseSettings)==null?void 0:ge.host,port:(ue=s==null?void 0:s.databaseSettings)==null?void 0:ue.port,user:(a=s==null?void 0:s.databaseSettings)==null?void 0:a.user,dbname:(t=s==null?void 0:s.databaseSettings)==null?void 0:t.dbname,table:(n=s==null?void 0:s.databaseSettings)==null?void 0:n.table});c.useEffect(()=>{L()},[L,i]);const A=[{key:"selectedPegs",label:"Dashboard에 표시할 PEG 목록",type:"multiselect",required:!1,options:R(),placeholder:"Database PEG에서 선택하세요"},{key:"chartLayout",label:"그래프 정렬 방식",type:"select",options:[{value:"byPeg",label:"PEG별 (PEG마다 Cell/NE 시리즈)"},{value:"byEntity",label:"Cell/NE별 (엔터티마다 PEG 시리즈)"}]}],y=[{key:"pegLimit",label:"PEG 조회 제한 수",type:"number",required:!1,min:100,max:5e4,placeholder:"10000",description:"데이터베이스에서 조회할 최대 PEG 개수를 설정합니다. (기본값: 10000)"}],[de,W]=c.useState([]),[F,U]=c.useState([]),[le,k]=c.useState([]),[P,Q]=c.useState([]),[ne,D]=c.useState([]),[G,Y]=c.useState([]);c.useEffect(()=>{const o=(s==null?void 0:s.statisticsSettings)||{};U(Array.isArray(o.selectedHosts)?o.selectedHosts:[]),Q(Array.isArray(o.selectedNEs)?o.selectedNEs:[]),Y(Array.isArray(o.selectedCellIds)?o.selectedCellIds:[])},[s==null?void 0:s.statisticsSettings]),c.useEffect(()=>{(async()=>{var O;try{const u=(s==null?void 0:s.databaseSettings)||{};if(!u.host)return;const V={host:String(u.host||"").trim(),port:Number(u.port)||5432,user:String(u.user||"").trim(),password:String(u.password||"").trim(),dbname:String(u.dbname||"").trim(),table:String(u.table||"summary").trim()},w=await Se.post("/api/master/hosts",V);W(Array.isArray((O=w==null?void 0:w.data)==null?void 0:O.hosts)?w.data.hosts:[])}catch(u){console.error("[PreferenceManager] HOST 목록 조회 실패",u)}})()},[(m=s==null?void 0:s.databaseSettings)==null?void 0:m.host,(f=s==null?void 0:s.databaseSettings)==null?void 0:f.port,(h=s==null?void 0:s.databaseSettings)==null?void 0:h.user,(q=s==null?void 0:s.databaseSettings)==null?void 0:q.password,(X=s==null?void 0:s.databaseSettings)==null?void 0:X.dbname,(ye=s==null?void 0:s.databaseSettings)==null?void 0:ye.table]),c.useEffect(()=>{(async()=>{var O;try{const u=(s==null?void 0:s.databaseSettings)||{};if(!u.host||F.length===0){k([]);return}const V={host:String(u.host||"").trim(),port:Number(u.port)||5432,user:String(u.user||"").trim(),password:String(u.password||"").trim(),dbname:String(u.dbname||"").trim(),table:String(u.table||"summary").trim(),hosts:F},w=await Se.post("/api/master/nes-by-host",V);k(Array.isArray((O=w==null?void 0:w.data)==null?void 0:O.nes)?w.data.nes:[])}catch(u){console.error("[PreferenceManager] NE 목록 조회 실패",u)}})()},[F,s==null?void 0:s.databaseSettings]),c.useEffect(()=>{(async()=>{var O;try{const u=(s==null?void 0:s.databaseSettings)||{};if(!u.host||F.length===0||P.length===0){D([]);return}const V={host:String(u.host||"").trim(),port:Number(u.port)||5432,user:String(u.user||"").trim(),password:String(u.password||"").trim(),dbname:String(u.dbname||"").trim(),table:String(u.table||"summary").trim(),hosts:F,nes:P},w=await Se.post("/api/master/cells-by-host-ne",V);D(Array.isArray((O=w==null?void 0:w.data)==null?void 0:O.cellids)?w.data.cellids:[])}catch(u){console.error("[PreferenceManager] CellID 목록 조회 실패",u)}})()},[P,F,s==null?void 0:s.databaseSettings]);const me=[{key:"host",label:"Host",type:"text",placeholder:"예: 127.0.0.1"},{key:"port",label:"Port",type:"number",min:1,max:65535,placeholder:"5432"},{key:"user",label:"User",type:"text",placeholder:"postgres"},{key:"password",label:"Password",type:"text",placeholder:"비밀번호"},{key:"dbname",label:"DB Name",type:"text",placeholder:"postgres"},{key:"table",label:"기본 테이블명",type:"text",placeholder:"summary"}],ce=[{key:"enableNotifications",label:"알림 활성화",type:"switch"},{key:"emailNotifications",label:"이메일 알림",type:"switch"},{key:"soundEnabled",label:"소리 알림",type:"switch"},{key:"notificationFrequency",label:"알림 빈도",type:"select",options:[{value:"immediate",label:"즉시"},{value:"hourly",label:"매시간"},{value:"daily",label:"매일"},{value:"weekly",label:"매주"}]}];return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsxs(z,{variant:"secondary",className:"text-xs",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"로딩 중..."]})]}),e.jsx(K,{children:e.jsx(ee,{className:"pt-6",children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"설정을 불러오는 중입니다..."})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"환경설정"}),e.jsx("p",{className:"text-muted-foreground",children:"Dashboard와 Statistics의 동작을 설정할 수 있습니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l&&e.jsxs(z,{variant:"secondary",className:"text-xs",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"저장 중..."]}),v&&e.jsx(z,{variant:"destructive",className:"text-xs",children:"오류 발생"}),d&&e.jsxs(z,{variant:"outline",className:"text-xs",children:["마지막 저장: ",new Date(d).toLocaleTimeString()]})]})]}),e.jsxs(Js,{defaultValue:"dashboard",className:"w-full",children:[e.jsxs(Zs,{className:"grid w-full grid-cols-6",children:[e.jsxs(je,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx($s,{className:"h-4 w-4"}),"Dashboard"]}),e.jsxs(je,{value:"statistics",className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Statistics"]}),e.jsxs(je,{value:"database",className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Database"]}),e.jsxs(je,{value:"derived-peg",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Derived PEG"]}),e.jsxs(je,{value:"notifications",className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"h-4 w-4"}),"알림"]}),e.jsxs(je,{value:"backup",className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4"}),"백업/복원"]})]}),e.jsxs(fe,{value:"dashboard",className:"space-y-6",children:[e.jsxs(K,{children:[e.jsx(ae,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),"PEG 데이터 소스"]})}),e.jsx(ee,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"PEG 데이터 소스"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Database Settings에서 연결된 실제 PEG 목록을 사용합니다"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(T,{variant:"outline",size:"sm",onClick:L,disabled:C,children:[e.jsx(Vs,{className:`h-3 w-3 ${C?"animate-spin":""}`}),"새로고침"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"사용 가능한 PEG"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[g.length,"개"]})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"조회 제한"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((De=s==null?void 0:s.dashboardSettings)==null?void 0:De.pegLimit)||1e4,"개"]})]}),e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"마지막 업데이트"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:_?_.toLocaleTimeString():"없음"})]})]}),g.length===0&&!C&&e.jsx("div",{className:"p-3 border rounded-lg bg-amber-50 border-amber-200",children:e.jsx("p",{className:"text-sm text-amber-700",children:"⚠️ DB PEG를 불러올 수 없습니다. Database Settings에서 DB 연결을 확인하세요."})}),g.length>0&&e.jsx("div",{className:"p-3 border rounded-lg bg-green-50 border-green-200",children:e.jsxs("p",{className:"text-sm text-green-700",children:["✅ ",g.length,"개의 실제 DB PEG를 사용할 수 있습니다"]})})]})})]}),e.jsx(Oe,{title:"PEG 조회 설정",description:"데이터베이스에서 조회할 PEG 개수를 제한합니다",settingKey:"dashboardSettings",fields:y,defaultOpen:!0,showSaveButton:!1,onFieldChange:(o,O)=>{o==="pegLimit"&&console.log(`[PreferenceManager] PEG Limit 변경: ${O}`)}}),e.jsx(Oe,{title:"Dashboard 설정",description:"DB에서 연동된 PEG만 선택하여 표시합니다",settingKey:"dashboardSettings",fields:A,defaultOpen:!0,showResetButton:!0,showSaveButton:!1},`dashboard-settings-${g.length}-${_?_.getTime():0}`),e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx(T,{size:"sm",onClick:async()=>{try{await b(),alert("Dashboard 설정이 저장되었습니다")}catch(o){alert("저장 실패: "+((o==null?void 0:o.message)||"알 수 없는 오류"))}},disabled:l,children:l?"저장 중...":"저장"})})]}),e.jsx(fe,{value:"statistics",className:"space-y-6",children:e.jsxs(K,{children:[e.jsx(ae,{children:e.jsx(te,{children:"데이터 선택 (HOST → NE → CellID)"})}),e.jsxs(ee,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{className:"block mb-2",children:"HOST (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:F,onChange:o=>{const O=Array.from(o.target.selectedOptions).map(u=>u.value);U(O)},children:de.map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("div",{children:[e.jsx(I,{className:"block mb-2",children:"NE (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:P,onChange:o=>{const O=Array.from(o.target.selectedOptions).map(u=>u.value);Q(O)},children:le.map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("div",{children:[e.jsx(I,{className:"block mb-2",children:"CellID (다중 선택)"}),e.jsx("select",{multiple:!0,className:"w-full border rounded p-2 h-48",value:G,onChange:o=>{const O=Array.from(o.target.selectedOptions).map(u=>u.value);Y(O)},children:ne.map(o=>e.jsx("option",{value:o,children:o},o))})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("div",{className:"mb-1",children:["HOST: ",F.length,"개"]}),e.jsxs("div",{className:"mb-1",children:["NE: ",P.length,"개"]}),e.jsxs("div",{children:["CellID: ",G.length,"개"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(T,{size:"sm",onClick:async()=>{try{p({statisticsSettings:{...(s==null?void 0:s.statisticsSettings)||{},selectedHosts:F,selectedNEs:P,selectedCellIds:G}}),await b(),alert("Statistics 설정이 저장되었습니다")}catch(o){alert("저장 실패: "+((o==null?void 0:o.message)||"알 수 없는 오류"))}},disabled:l,children:l?"저장 중...":"저장"})})]})]})]})}),e.jsxs(fe,{value:"database",className:"space-y-6",children:[e.jsx(Oe,{title:"Database 설정",description:"LLM 분석과 Statistics에서 공통으로 사용할 PostgreSQL DB 설정입니다 (테이블명 포함).",settingKey:"databaseSettings",fields:me,defaultOpen:!0,showResetButton:!0,showSaveButton:!1}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(T,{size:"sm",onClick:async()=>{try{await b(),alert("Database 설정이 저장되었습니다")}catch(o){alert("저장 실패: "+((o==null?void 0:o.message)||"알 수 없는 오류"))}},disabled:l,children:l?"저장 중...":"저장"}),e.jsx(T,{size:"sm",onClick:async()=>{var o,O,u,V;try{const w=(s==null?void 0:s.databaseSettings)||{},M=await Se.post("/api/master/test-connection",{host:(w.host||"").trim(),port:Number(w.port)||5432,user:(w.user||"").trim(),password:(w.password||"").trim(),dbname:(w.dbname||"").trim(),table:(w.table||"summary").trim()}),Pe=(o=M==null?void 0:M.data)==null?void 0:o.success;alert(Pe?"DB 연결 성공. table_exists="+((O=M==null?void 0:M.data)==null?void 0:O.table_exists):"DB 연결 실패: 응답 형식 확인 필요")}catch(w){alert("DB 연결 실패: "+(((V=(u=w==null?void 0:w.response)==null?void 0:u.data)==null?void 0:V.detail)||(w==null?void 0:w.message)))}},children:"Test Connection"})]})]}),e.jsx(fe,{value:"derived-peg",className:"space-y-6",children:e.jsx(ra,{derivedPegSettings:(s==null?void 0:s.derivedPegSettings)||{formulas:[],settings:{autoValidate:!1,showInDashboard:!1,showInStatistics:!1,evaluationPrecision:4}},updateDerivedPegSettings:o=>{p({derivedPegSettings:o})},availablePegs:R(),saving:l,dashboardSettings:E,updateDashboardSettings:x})}),e.jsx(fe,{value:"notifications",className:"space-y-6",children:e.jsx(Oe,{title:"알림 설정",description:"이메일, 소리 알림 등 알림 관련 설정을 관리합니다",settingKey:"notificationSettings",fields:ce,defaultOpen:!0,showResetButton:!0,showSaveButton:!1})}),e.jsxs(fe,{value:"backup",className:"space-y-6",children:[e.jsx(Ks,{title:"설정 백업 및 복원",description:"모든 환경설정을 JSON 파일로 내보내거나 백업 파일에서 복원할 수 있습니다",defaultOpen:!0}),e.jsxs(K,{children:[e.jsxs(ae,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5 text-orange-500"}),"설정 초기화"]}),e.jsx(Ie,{children:"Dashboard, Statistics, Database 설정을 기본값으로 초기화합니다. 이 작업은 되돌릴 수 없습니다."})]}),e.jsxs(ee,{className:"space-y-4",children:[e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-md p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ms,{className:"h-5 w-5 text-orange-500 mt-0.5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-orange-800",children:"주의사항"}),e.jsxs("ul",{className:"text-sm text-orange-700 space-y-1",children:[e.jsx("li",{children:"• Dashboard의 선택된 PEG 목록이 초기화됩니다"}),e.jsx("li",{children:"• Statistics의 기본 설정이 초기화됩니다"}),e.jsx("li",{children:"• Database 연결 설정이 기본값으로 초기화됩니다"}),e.jsx("li",{children:"• 이 작업은 되돌릴 수 없습니다"})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"초기화할 설정"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dashboard, Statistics, Database 설정을 기본값으로 초기화"})]}),e.jsx(T,{variant:"destructive",size:"sm",onClick:async()=>{if(window.confirm(`정말로 Dashboard, Statistics, Database 설정을 초기화하시겠습니까?

이 작업은 되돌릴 수 없습니다.`))try{const O=await S(["dashboardSettings","statisticsSettings","databaseSettings"]);O.success?alert("✅ 설정이 성공적으로 초기화되었습니다!"):alert("❌ 설정 초기화 실패: "+(O.error||"알 수 없는 오류"))}catch(O){alert("❌ 설정 초기화 중 오류 발생: "+O.message)}},disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"h-4 w-4 mr-2 animate-spin"}),"초기화 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"설정 초기화"]})})]})]})]})]})]}),e.jsxs(K,{children:[e.jsx(ae,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-5 w-5"}),"현재 설정 요약"]})}),e.jsx(ee,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Dashboard"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["선택된 PEG:"," ",((J=(Ee=s==null?void 0:s.dashboardSettings)==null?void 0:Ee.selectedPegs)==null?void 0:J.length)||0,"개"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["PEG 소스:"," ",`DB (${g.length}개)`]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["차트 스타일:"," ",((he=s==null?void 0:s.dashboardSettings)==null?void 0:he.chartStyle)||"line"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Statistics"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["기본 기간:"," ",((Be=s==null?void 0:s.statisticsSettings)==null?void 0:Be.defaultDateRange)||7,"일"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소수점: ",((Ve=s==null?void 0:s.statisticsSettings)==null?void 0:Ve.decimalPlaces)||2,"자리"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["비교 옵션:"," ",(Me=s==null?void 0:s.statisticsSettings)!=null&&Me.showComparisonOptions?"활성":"비활성"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"알림"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["알림:"," ",(qe=s==null?void 0:s.notificationSettings)!=null&&qe.enableNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["이메일:"," ",(Je=s==null?void 0:s.notificationSettings)!=null&&Je.emailNotifications?"활성":"비활성"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["소리:"," ",(Ze=s==null?void 0:s.notificationSettings)!=null&&Ze.soundEnabled?"활성":"비활성"]})]})]})]})})]})]})},ma=Object.freeze(Object.defineProperty({__proto__:null,default:la},Symbol.toStringTag,{value:"Module"}));export{ts as C,ve as I,ma as P,Ye as S,rs as a,ls as b};
