import{r as n,N as e,O as L}from"./vendor-Cw6wx6N3.js";import{L as v,a as V,S as W,f as U,g as J,h as Y,i as X,I as E,o as F,C as H,b as Q,d as Z,e as ee,A as ce,D as he,B as A,E as ue,F as me,T as pe,q as xe,r as se,s as ae}from"./common-components-BsYW0TmQ.js";import{a as G,e as re,u as ye}from"./dashboard-page-CxSfgQ35.js";import{T as ne,g as M,P as ge}from"./icon-vendor-1p3lj7wq.js";import{R as je,l as fe,C as ve,X as Ce,Y as te,T as Se,L as be,m as Pe,d as le}from"./chart-vendor-C0DB73VJ.js";const ie=n.memo(({chartConfig:s,onConfigChange:l,kpiOptions:j,loading:C,onGenerate:P,useDbPegs:u,onToggleDbPegs:S,pegOptionsLoading:m,dbPegOptions:y})=>{const r=(a,T)=>{l(N=>({...N,[a]:T}))},c=()=>{var a,T;try{const N=localStorage.getItem("activePreference");if(!N)return;const f=JSON.parse(N),K=Array.isArray((a=f==null?void 0:f.config)==null?void 0:a.defaultNEs)?f.config.defaultNEs.map(String):[],o=Array.isArray((T=f==null?void 0:f.config)==null?void 0:T.defaultCellIDs)?f.config.defaultCellIDs.map(String):[];l(p=>({...p,ne:K.join(","),cellid:o.join(",")}))}catch{}},I=()=>u&&y.length>0?y:j;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(v,{className:"text-sm font-medium",children:"PEG 데이터 소스"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:u?"Database에서 실제 PEG 목록을 사용합니다":"기본 KPI 목록을 사용합니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{variant:u?"secondary":"default",size:"sm",onClick:()=>S(!1),children:"기본 KPI"}),e.jsx(V,{variant:u?"default":"secondary",size:"sm",onClick:()=>S(!0),disabled:m,children:m?"로딩 중...":"DB PEG"})]})]}),u&&y.length===0&&!m&&e.jsx("p",{className:"text-xs text-amber-600 mt-2",children:"⚠️ DB PEG를 불러올 수 없습니다. Database Settings를 확인하세요."}),u&&y.length>0&&e.jsxs("p",{className:"text-xs text-green-600 mt-2",children:["✅ ",y.length,"개의 DB PEG를 사용할 수 있습니다"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Primary KPI"}),e.jsxs(W,{value:s.primaryKPI,onValueChange:a=>r("primaryKPI",a),children:[e.jsx(U,{children:e.jsx(J,{})}),e.jsx(Y,{children:I().map(a=>e.jsx(X,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Secondary KPI (Dual Axis)"}),e.jsxs(W,{value:s.secondaryKPI,onValueChange:a=>r("secondaryKPI",a),disabled:!s.showSecondaryAxis,children:[e.jsx(U,{children:e.jsx(J,{})}),e.jsx(Y,{children:I().map(a=>e.jsx(X,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Period 1 Start"}),e.jsx(E,{type:"date",value:s.startDate1,onChange:a=>r("startDate1",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Period 1 End"}),e.jsx(E,{type:"date",value:s.endDate1,onChange:a=>r("endDate1",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Period 2 Start"}),e.jsx(E,{type:"date",value:s.startDate2,onChange:a=>r("startDate2",a.target.value),disabled:!s.showComparison})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Period 2 End"}),e.jsx(E,{type:"date",value:s.endDate2,onChange:a=>r("endDate2",a.target.value),disabled:!s.showComparison})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"NE"}),e.jsx(E,{placeholder:"e.g., nvgnb#10000 or nvgnb#10000,nvgnb#20000",value:s.ne,onChange:a=>r("ne",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Cell ID"}),e.jsx(E,{placeholder:"e.g., 2010 or 2010,2011",value:s.cellid,onChange:a=>r("cellid",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Use Preference (NE/Cell)"}),e.jsx(V,{type:"button",variant:"outline",onClick:c,children:"Load from Preference"})]})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"showComparison",checked:s.showComparison,onCheckedChange:a=>r("showComparison",a)}),e.jsx(v,{htmlFor:"showComparison",children:"Show Period Comparison"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"showSecondaryAxis",checked:s.showSecondaryAxis,onCheckedChange:a=>r("showSecondaryAxis",a)}),e.jsx(v,{htmlFor:"showSecondaryAxis",children:"Show Secondary Y-Axis"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"showThreshold",checked:s.showThreshold,onCheckedChange:a=>r("showThreshold",a)}),e.jsx(v,{htmlFor:"showThreshold",children:"Show Threshold Line"})]}),s.showThreshold&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{htmlFor:"threshold",children:"Threshold Value:"}),e.jsx(E,{id:"threshold",type:"number",step:"0.1",value:s.thresholdValue,onChange:a=>r("thresholdValue",parseFloat(a.target.value)),className:"w-24"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(V,{onClick:P,disabled:C,className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),C?"Generating...":"Generate Chart"]})})]})});ie.displayName="ChartControls";const oe=n.memo(({chartData:s,chartConfig:l,loading:j,kpiOptions:C,useDbPegs:P,dbPegOptions:u})=>{const S=n.useMemo(()=>{if(s.length===0)return{primary:[],secondary:[]};const r=Object.keys(s[0]).filter(a=>a!=="time"),c=r.filter(a=>a.endsWith("_period1")||a.endsWith("_period2")),I=r.filter(a=>a.endsWith("_secondary"));return{primary:c,secondary:I}},[s]),{primary:m,secondary:y}=S;return s.length===0?e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:j?"Generating chart...":'Click "Generate Chart" to create visualization'}):e.jsx("div",{className:"h-96",children:e.jsx(je,{width:"100%",height:"100%",children:e.jsxs(fe,{data:s,children:[e.jsx(ve,{strokeDasharray:"3 3"}),e.jsx(Ce,{dataKey:"time"}),e.jsx(te,{yAxisId:"left"}),l.showSecondaryAxis&&e.jsx(te,{yAxisId:"right",orientation:"right"}),e.jsx(Se,{}),e.jsx(be,{}),l.showThreshold&&e.jsx(Pe,{y:l.thresholdValue,stroke:"red",strokeDasharray:"5 5",yAxisId:"left"}),m.map((r,c)=>e.jsx(le,{yAxisId:"left",type:"monotone",dataKey:r,stroke:r.includes("period1")?`hsl(${c*60}, 70%, 40%)`:`hsl(${c*60}, 70%, 60%)`,strokeWidth:2,strokeDasharray:r.includes("period1")?"0":"5 5"},r)),l.showSecondaryAxis&&y.map((r,c)=>e.jsx(le,{yAxisId:"right",type:"monotone",dataKey:r,stroke:`hsl(${(c+m.length)*60}, 70%, 50%)`,strokeWidth:2,strokeDasharray:"10 5"},r))]})})})});oe.displayName="ChartDisplay";const z=[{value:"availability",label:"Availability (%)",threshold:99},{value:"rrc",label:"RRC Success Rate (%)",threshold:98.5},{value:"erab",label:"ERAB Success Rate (%)",threshold:99},{value:"sar",label:"SAR",threshold:2.5},{value:"mobility_intra",label:"Mobility Intra (%)",threshold:95},{value:"cqi",label:"CQI",threshold:8}],q=n.memo(()=>{var p,h;const[s,l]=n.useState({primaryKPI:"availability",secondaryKPI:"rrc",startDate1:new Date(Date.now()-12096e5).toISOString().split("T")[0],endDate1:new Date(Date.now()-6048e5).toISOString().split("T")[0],startDate2:new Date(Date.now()-6048e5).toISOString().split("T")[0],endDate2:new Date().toISOString().split("T")[0],ne:"",cellid:"",showSecondaryAxis:!0,showComparison:!0,showThreshold:!0,thresholdValue:99}),[j,C]=n.useState([]),[P,u]=n.useState(!1),[S,m]=n.useState(!1),[y,r]=n.useState(z),[c,I]=n.useState([]),[a,T]=n.useState(!1),N=n.useMemo(()=>a&&c.length>0?c:y,[a,c,y]),f=n.useCallback(async()=>{var i;try{m(!0),console.info("[AdvancedChart] Fetching DB PEGs");let d={};try{const t=localStorage.getItem("dbConfig");t&&(d=JSON.parse(t))}catch(t){console.error("Error parsing dbConfig from localStorage",t)}if(!d.host){console.warn("[AdvancedChart] No DB config found");return}const g=await G.post("/api/master/pegs",{db:d,table:d.table||"summary",limit:100}),x=((i=g==null?void 0:g.data)==null?void 0:i.pegs)||[];console.info("[AdvancedChart] DB PEGs loaded:",x.length);const D=x.map(t=>({value:t.id||t.name,label:`${t.name||t.id} (DB)`,threshold:0,isDbPeg:!0}));I(D)}catch(d){console.error("[AdvancedChart] Error fetching DB PEGs:",d)}finally{m(!1)}},[]),K=n.useCallback((i,d)=>{var R,$;if(!i||i.length===0)return[];const g=(($=(R=i[0])==null?void 0:R.data)==null?void 0:$.data)||[],x=d.showComparison&&i[1]?i[1].data.data:[],D=d.showSecondaryAxis&&i[2]?i[2].data.data:[],t={};function _(O,B){const b={};O.forEach(w=>{const k=new Date(w.timestamp).toLocaleString();b[k]||(b[k]={sum:0,cnt:0}),b[k].sum+=Number(w.value)||0,b[k].cnt+=1}),Object.keys(b).forEach(w=>{t[w]||(t[w]={time:w});const k=b[w].cnt>0?+(b[w].sum/b[w].cnt).toFixed(2):0;t[w][B]=k})}return _(g,`${d.primaryKPI}_period1`),d.showComparison&&_(x,`${d.primaryKPI}_period2`),d.showSecondaryAxis&&_(D,`${d.secondaryKPI}_secondary`),Object.values(t).sort((O,B)=>new Date(O.time)-new Date(B.time)).slice(0,200)},[]),o=n.useCallback(async()=>{try{u(!0),console.info("[AdvancedChart] Generate with config:",s,"useDbPegs:",a);const i=[];i.push(G.post("/api/kpi/query",{start_date:s.startDate1,end_date:s.endDate1,kpi_type:s.primaryKPI,ne:s.ne,cellid:s.cellid,ids:2})),s.showComparison&&i.push(G.post("/api/kpi/query",{start_date:s.startDate2,end_date:s.endDate2,kpi_type:s.primaryKPI,ne:s.ne,cellid:s.cellid,ids:2})),s.showSecondaryAxis&&s.secondaryKPI!==s.primaryKPI&&i.push(G.post("/api/kpi/query",{start_date:s.startDate2,end_date:s.endDate2,kpi_type:s.secondaryKPI,ne:s.ne,cellid:s.cellid,ids:2}));const d=await Promise.all(i);console.info("[AdvancedChart] API responses:",d.map(x=>{var D,t;return((t=(D=x==null?void 0:x.data)==null?void 0:D.data)==null?void 0:t.length)??0}));const g=K(d,s);C(g)}catch(i){console.error("[AdvancedChart] Error generating advanced chart:",i)}finally{u(!1)}},[s,a,K]);return n.useEffect(()=>{var i;try{const d=localStorage.getItem("activePreference");if(d){const g=JSON.parse(d),x=Array.isArray((i=g==null?void 0:g.config)==null?void 0:i.availableKPIs)&&g.config.availableKPIs.length>0?g.config.availableKPIs.map(t=>({value:String((t==null?void 0:t.value)||""),label:String((t==null?void 0:t.label)||(t==null?void 0:t.value)||""),threshold:Number((t==null?void 0:t.threshold)??0)})):z;r(x);const D=x.map(t=>t.value);l(t=>{var _,R,$,O;return{...t,primaryKPI:D.includes(t.primaryKPI)?t.primaryKPI:((_=x[0])==null?void 0:_.value)||"availability",secondaryKPI:D.includes(t.secondaryKPI)?t.secondaryKPI:((R=x[1])==null?void 0:R.value)||(($=x[0])==null?void 0:$.value)||"rrc",thresholdValue:((O=x.find(B=>{var b;return B.value===(D.includes(t.primaryKPI)?t.primaryKPI:((b=x[0])==null?void 0:b.value)||"availability")}))==null?void 0:O.threshold)??t.thresholdValue}})}}catch{r(z)}},[]),n.useEffect(()=>{a&&c.length===0&&f()},[a,c.length,f]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Advanced Chart Configuration"]})}),e.jsx(ee,{children:e.jsx(ie,{chartConfig:s,onConfigChange:l,kpiOptions:y,loading:P,onGenerate:o,useDbPegs:a,pegOptionsLoading:S,dbPegOptions:c})})]}),e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(Z,{children:[((p=N.find(i=>i.value===s.primaryKPI))==null?void 0:p.label)||"KPI"," Analysis",s.showSecondaryAxis&&` vs ${(h=N.find(i=>i.value===s.secondaryKPI))==null?void 0:h.label}`]})}),e.jsx(ee,{children:e.jsx(oe,{chartData:j,chartConfig:s,loading:P,kpiOptions:y,useDbPegs:a,dbPegOptions:c})})]})]})});q.displayName="AdvancedChart";const Ke=Object.freeze(Object.defineProperty({__proto__:null,default:q},Symbol.toStringTag,{value:"Module"})),de=()=>{const{settings:s}=re();ye();const[l,j]=n.useState({period1:{startDate:"",endDate:"",preset:"last7days"},period2:{startDate:"",endDate:"",preset:"last14days"},selectedPegs:["availability","rrc","erab"],includeOutliers:!0,decimalPlaces:4,showComparison:!0,showSecondaryAxis:!1,showThreshold:!1,thresholdValue:99,ne:"",cellid:""}),[C,P]=n.useState(null),[u,S]=n.useState(!1),[m,y]=n.useState(null),[r,c]=n.useState(null),[I,a]=n.useState(new Set);n.useEffect(()=>{const o=new Date,p=new Date(o),h=new Date(o.getTime()-10080*60*1e3),i=new Date(h),d=new Date(h.getTime()-10080*60*1e3);j(g=>({...g,period1:{startDate:h.toISOString().split("T")[0],endDate:p.toISOString().split("T")[0],preset:"last7days"},period2:{startDate:d.toISOString().split("T")[0],endDate:i.toISOString().split("T")[0],preset:"custom"}}))},[]),n.useEffect(()=>{s.defaultPegs&&j(o=>({...o,selectedPegs:s.defaultPegs})),s.decimalPlaces!==void 0&&j(o=>({...o,decimalPlaces:s.decimalPlaces})),s.includeOutliers!==void 0&&j(o=>({...o,includeOutliers:s.includeOutliers}))},[s]);const T=n.useCallback(o=>{j(o)},[]),N=n.useCallback(async()=>{console.log("🔄 PEG 옵션 새로고침");try{const o=await G.get("/api/master/pegs");if(o.data&&Array.isArray(o.data)){const p=o.data.map(h=>({value:h.peg_name||h.value||h.id,label:h.display_name||h.label||`${h.peg_name} (${h.unit||"N/A"})`}));console.log("✅ PEG 옵션 새로고침 완료:",p.length,"개")}}catch(o){console.error("❌ PEG 옵션 새로고침 실패:",o),L.error("PEG 옵션 새로고침에 실패했습니다.")}},[]),f=async()=>{var o;if(!l.period1.startDate||!l.period1.endDate||!l.period2.startDate||!l.period2.endDate){L.error("두 기간의 날짜를 모두 설정해주세요");return}if(l.selectedPegs.length===0){L.error("분석할 PEG를 최소 1개 이상 선택해주세요");return}S(!0),y(null);try{console.log("🔍 Statistics 비교 분석 시작:",l);const p={period1:{start_date:`${l.period1.startDate}T00:00:00`,end_date:`${l.period1.endDate}T23:59:59`},period2:{start_date:`${l.period2.startDate}T00:00:00`,end_date:`${l.period2.endDate}T23:59:59`},peg_names:l.selectedPegs,include_outliers:l.includeOutliers,decimal_places:l.decimalPlaces,ne_filter:l.ne?[l.ne]:null,cell_id_filter:l.cellid?[l.cellid]:null};console.log("📤 API 요청 페이로드:",p);const h=await G.post("/api/statistics/compare",p);console.log("📥 API 응답:",h.data),P(h.data),c(new Date),L.success(`비교 분석 완료! ${((o=h.data.analysis_results)==null?void 0:o.length)||0}개 PEG 분석됨`)}catch(p){console.error("❌ 비교 분석 실패:",p),y(p),L.error("비교 분석 중 오류가 발생했습니다")}finally{S(!1)}},K=l.period1.startDate&&l.period1.endDate&&l.period2.startDate&&l.period2.endDate&&l.selectedPegs.length>0;return u?e.jsx(ce,{message:"Statistics 비교 분석을 진행하고 있습니다...",analysisType:"statistics",estimatedTime:"약 30-60초",size:"large"}):m?e.jsx(he,{error:m,analysisType:"statistics",onRetry:f,showDetails:!0}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Basic 비교 분석"}),e.jsx("p",{className:"text-muted-foreground",children:"두 기간의 KPI 데이터를 비교하여 성능 변화를 분석합니다"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r&&e.jsxs(A,{variant:"outline",className:"text-xs",children:["마지막 분석: ",r.toLocaleTimeString("ko-KR")]}),e.jsxs(V,{onClick:f,disabled:!K,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"비교 분석 실행"]})]})]}),e.jsx(ue,{config:l,onConfigChange:T,analysisType:"statistics",onPegOptionsRefresh:N,compact:!1}),C&&e.jsx(me,{results:C,analysisType:"statistics",title:"비교 분석 결과",displayType:"mixed",showSelection:!0,selectedItems:I,onSelectionChange:a,showExport:!0,onExport:async(o,p)=>{console.log(`📤 ${o.toUpperCase()} 내보내기:`,p)}}),!C&&!u&&!m&&e.jsxs("div",{className:"text-center py-12 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsx(M,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"비교 분석 준비"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"두 기간과 분석할 PEG를 선택한 후 '비교 분석 실행' 버튼을 클릭하세요"}),e.jsx(A,{variant:"outline",children:K?"분석 준비 완료":"설정 필요"})]})]})},Ee=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"})),De=()=>{const{settings:s}=re(),l=n.useMemo(()=>({defaultDateRange:s.defaultDateRange||7,defaultNe:s.defaultNe||"",defaultCellId:s.defaultCellId||"",decimalPlaces:s.decimalPlaces||2,showComparisonOptions:s.showComparisonOptions!==!1,autoCalculateStats:s.autoCalculateStats!==!1}),[s]),{defaultDateRange:j,defaultNe:C,defaultCellId:P,decimalPlaces:u,showComparisonOptions:S,autoCalculateStats:m}=l;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Statistics"}),e.jsxs("p",{className:"text-muted-foreground",children:["기본 날짜 범위: ",j,"일 • 소수점: ",u,"자리",C&&` • 기본 NE: ${C}`,P&&` • 기본 Cell: ${P}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m&&e.jsxs(A,{variant:"outline",className:"text-xs",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),"자동 통계 계산"]}),S&&e.jsxs(A,{variant:"outline",className:"text-xs",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"비교 옵션 활성"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(A,{variant:"default",children:["기본 기간: ",j,"일"]}),e.jsxs(A,{variant:"outline",children:["소수점: ",u,"자리"]}),m&&e.jsx(A,{variant:"secondary",children:"자동 통계 계산"}),S&&e.jsx(A,{variant:"secondary",children:"비교 옵션"})]}),e.jsxs(pe,{defaultValue:"basic",className:"w-full",children:[e.jsxs(xe,{className:"grid w-full grid-cols-2",children:[e.jsx(se,{value:"basic",children:"Basic Analysis"}),e.jsx(se,{value:"advanced",children:"Advanced Analysis"})]}),e.jsx(ae,{value:"basic",className:"space-y-6",children:e.jsx(de,{})}),e.jsx(ae,{value:"advanced",className:"space-y-6",children:e.jsx(q,{})})]})]})},_e=Object.freeze(Object.defineProperty({__proto__:null,default:De},Symbol.toStringTag,{value:"Module"}));export{Ke as A,Ee as B,_e as S};
